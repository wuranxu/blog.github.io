(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{570:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("大家好~我是"),t("code",[s._v("米洛")]),s._v("！"),t("br"),t("br"),s._v("\n我在从0到1打造一个开源平台, 也在编写一套完整的"),t("code",[s._v("接口测试平台系列教程")]),s._v("，希望大家能够多多支持。"),t("br"),s._v(" "),t("br"),s._v("\n欢迎关注我的公众号"),t("code",[s._v("米洛的测开日记")]),s._v("，获取最新文章教程!")])]),s._v(" "),t("h2",{attrs:{id:"回顾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[s._v("#")]),s._v(" 回顾")]),s._v(" "),t("p",[s._v("上节内容我们编写好了"),t("code",[s._v("数据驱动相关")]),s._v("的接口，但却有"),t("code",[s._v("很多困扰")]),s._v("随之而来。接着就来说说我们提出这些困扰，并解决之。")]),s._v(" "),t("h3",{attrs:{id:"问题汇总"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题汇总"}},[s._v("#")]),s._v(" 问题汇总")]),s._v(" "),t("p",[s._v("由于"),t("code",[s._v("数据驱动")]),s._v("的改造，可能会引发以下几个问题:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("原先的执行用例的方式需要变化")]),s._v(" "),t("p",[s._v("数据驱动以后，我们批量执行case的时候需要带上环境字段了，否则"),t("code",[s._v("数据驱动")]),s._v("没法使用。")])]),s._v(" "),t("li",[t("p",[s._v("原先能够直接调试case，也就是单条case在线执行")]),s._v(" "),t("p",[s._v("现在由于环境的关系+多数据的情况，我们只能把这块进行调整，让单个case的调试变为"),t("code",[s._v("单条测试数据")]),s._v("的调试。")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632234797491-image.png",alt:"可以看到现在执行case的时候会提示没有env参数，因为我们支持了数据驱动，必须带上执行环境"}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行测试用例逻辑的变化")]),s._v(" "),t("p",[s._v("之前我们执行测试用例的时候，举个例子: "),t("code",[s._v("登录接口")]),s._v("，我们是在前置条件里面写好了具体的登录"),t("strong",[s._v("用户名")]),s._v("和"),t("strong",[s._v("密码")]),s._v("。但在"),t("strong",[s._v("数据驱动")]),s._v("的情况下，又不一样了。")]),s._v(" "),t("p",[s._v("我们得把用例里面变化的数据全部"),t("code",[s._v("抽离出来")]),s._v("，其实这么做的目的是为了让数据更灵活，也为了以后能支持"),t("code",[s._v("数据工厂")]),s._v("。")]),s._v(" "),t("p",[s._v("所以这就会导致我们执行case的整套逻辑会发生"),t("code",[s._v("剧烈变化")]),s._v("，让人头大！！！")])]),s._v(" "),t("li",[t("p",[s._v("断言逻辑的改造")]),s._v(" "),t("p",[s._v("细心的朋友可能会发现，断言部分之前没有很好地支持"),t("code",[s._v("变量")]),s._v("，但现在不一样，我们要根据不同的参数完成不同的断言操作，所以我们也得支持。")])])]),s._v(" "),t("h2",{attrs:{id:"迎接挑战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#迎接挑战"}},[s._v("#")]),s._v(" 迎接挑战")]),s._v(" "),t("p",[s._v("虽然这些挑战比较麻烦，但好在"),t("code",[s._v("大多")]),s._v("是体力活儿。因为以前的逻辑和现在逻辑的"),t("strong",[s._v("区别")]),s._v("引发，只要耐心，就能逐一击破。而且之前埋下的坑比如"),t("code",[s._v("断言变量")]),s._v("没替换等等都可以随之解决。")]),s._v(" "),t("h3",{attrs:{id:"改造报告"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#改造报告"}},[s._v("#")]),s._v(" 改造报告")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("PityTestResult新增字段")]),s._v(" "),t("p",[s._v("之前我们编写报告的时候，都是一条case一条数据，那现在有了数据驱动，我们的报告就需要做出一定的"),t("code",[s._v("改变")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632553978935-image.png",alt:"数据驱动的2个核心字段，数据+标识"}})]),s._v(" "),t("p",[s._v("现在我们需要把数据的标识和数据的内容都"),t("code",[s._v("写入报告")]),s._v("，这样的话在查看报告的时候就能清楚地看到每条数据的执行结果，可以"),t("code",[s._v("对号入座")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("PityTestResult初始化方法新增字段")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632554091261-image.png",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("同理，插入测试结果的时候也要调整")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632554139335-image.png",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("查询报告的时候也要相继调整")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632554198504-image.png",alt:"按照用例id+用例开始执行时间的顺序排列"}})]),s._v(" "),t("h3",{attrs:{id:"改造用例执行器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#改造用例执行器"}},[s._v("#")]),s._v(" 改造用例执行器")]),s._v(" "),t("p",[s._v("我们之前的执行器有许多不完善的地方，比如不支持断言里面的数据变化，再者只替换了一次数据，而现在我们要做的是什么呢？")]),s._v(" "),t("p",[t("code",[s._v("每当有新的变量生成，我们都要去寻找变量去替换，这样做虽然显得工作量很重复，但是完整地保证了生成的变量不会漏掉。")])]),s._v(" "),t("ul",[t("li",[s._v("编写replace_args方法")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632554922140-image.png",alt:"要替换的地方有4个，用例，前置条件，后置条件，断言"}})]),s._v(" "),t("p",[s._v("因为没法"),t("code",[s._v("度量")]),s._v("变量什么时候生成，所以要做的就是每当有新的变量产生就"),t("code",[s._v("替换变量")]),s._v("。")]),s._v(" "),t("ul",[t("li",[s._v("replace方法")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632555108180-image.png",alt:""}})]),s._v(" "),t("p",[s._v("可以看到他们都调用了核心方法: replace_cls，也就是替换一个对象，通过属性+值的形式。")]),s._v(" "),t("p",[s._v("我们来看一下replace_cls方法")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632555193644-image.png",alt:""}})]),s._v(" "),t("p",[s._v("剖析一下: 遍历参数字典，接着去指定的对象"),t("code",[s._v("字段")]),s._v("里面查询是否有这个变量，什么意思呢？假设有这样一个对象:")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Student")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    \n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t    self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name\n\t\tself"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" age\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("假设此时学生的name和age分别是"),t("code",[s._v("${student_name}")]),s._v("和"),t("code",[s._v("18")]),s._v("。")]),s._v(" "),t("p",[s._v("我们这边有个参数字典为:")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("params "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"student_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"miro"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("很显然，我们要做的效果就是:")]),s._v(" "),t("ol",[t("li",[s._v("遍历params，此时key=student_name, value=miro")]),s._v(" "),t("li",[s._v("根据指定的字段: "),t("code",[s._v("name")]),s._v("和"),t("code",[s._v("age")]),s._v("（注意是个列表）")]),s._v(" "),t("li",[s._v("先找name，发现name的值是"),t("code",[s._v("${student_name}")]),s._v("（我们pity内部约定的变量形式），和student_name吻合，所以我们要把${student_name} 替换为 "),t("code",[s._v("miro")])]),s._v(" "),t("li",[s._v("调用setattr方法，把student_name替换成它应该变成的值: miro")]),s._v(" "),t("li",[s._v("由于age字段的值是18，并不是一个变量，所以循环结束")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("就是上面这个思路，不知道大家有没有看明白。")]),s._v(" "),t("ul",[t("li",[s._v("replace_params")])]),s._v(" "),t("p",[s._v("这块是变量替换的"),t("code",[s._v("精髓")]),s._v("所在，也是最难弄懂的地方。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632555683408-image.png",alt:"这里的request_headers是特殊情况，做的特殊处理"}})]),s._v(" "),t("p",[s._v("这个方法具体的处理逻辑就是从JSON字符串中找到对应的值，并能支持字段取值。")]),s._v(" "),t("p",[s._v("比如"),t("code",[s._v('a = \'{"human": {"age": 1}}\'')]),s._v("这个json字符串，如果我们要取到age，我们需要这么写"),t("code",[s._v("${res.human.age}")]),s._v(".")]),s._v(" "),t("p",[s._v("这个方法做到的事情就是，从res获取human，接着获取age，最终返回一个字段，用于替换:")]),s._v(" "),t("p",[t("code",[s._v('new_data = {"human.age": 1}')])]),s._v(" "),t("p",[s._v("完成上述操作，接着就能够从字符串中拿到human.age的值（1）了，从而能够将所有用例产生的"),t("code",[s._v("变量")]),s._v("分配到其他case或者其他数据。")]),s._v(" "),t("p",[s._v("这块之所以"),t("code",[s._v("有一些改动")]),s._v("，是因为我们把response里面的所有数据都改成了字符串，以前比如response可能是"),t("code",[s._v("字典")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"改造数据构造器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#改造数据构造器"}},[s._v("#")]),s._v(" 改造数据构造器")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632556032288-image.png",alt:"数据构造器，势必会产生变量，产生变量则要进行一次替换操作（哪怕没产生变量）"}})]),s._v(" "),t("h3",{attrs:{id:"run方法改造"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run方法改造"}},[s._v("#")]),s._v(" run方法改造")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params_pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request_param"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"主case"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        开始执行测试用例\n        """')]),s._v("\n        response_info "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化case全局变量, 只存在于case生命周期 注意 它与全局变量不是一套逻辑")]),s._v("\n        case_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" params_pool\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" case_params "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            case_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        req_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request_param\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" req_params "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            req_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" TestCaseDao"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("async_query_test_case"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err\n\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"case_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n            method "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request_method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"request_method"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" method\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step1: 替换全局变量")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse_gconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"解析全局变量"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step2: 获取构造数据")]),s._v("\n            constructors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_constructor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step3: 获取断言")]),s._v("\n            asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" TestCaseAssertsDao"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("async_list_test_case_asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step4: 替换参数")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace_args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" constructors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step5: 执行构造方法")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute_constructors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" req_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" constructors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step6: 获取后置操作")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TODO")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step7: 批量改写主方法参数")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request_headers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                headers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" json"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request_headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                headers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application/json; charset=UTF-8"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step5: 替换请求参数")]),s._v("\n            body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace_body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_param"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step6: 完成http请求")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"form"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                request_obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AsyncRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" headers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                           data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" body "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" body "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" json"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                request_obj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AsyncRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" headers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            res "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" request_obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("invoke"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"http请求过程\\n\\nRequest Method: ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request_method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\\n\\n"')])]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"Request Headers:\\n')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\\n\\nUrl: ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("case_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"\\n\\nBody:\\n')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\\n\\nResponse:\\n")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'response'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'未获取到返回值'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行完成进行断言")]),s._v("\n            asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ans "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("my_assert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("asserts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"asserts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" asserts\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志输出, 如果不是开头用例则不记录")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ans\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            Executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"执行用例失败: ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"执行用例失败: ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"执行用例失败: ')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br")])]),t("p",[s._v("方法比较长，我就直接贴代码了。改造点主要有以下几处:")]),s._v(" "),t("ol",[t("li",[s._v("新增env参数")]),s._v(" "),t("li",[s._v("replace_args替换掉replace_params")]),s._v(" "),t("li",[s._v("打印完整的http请求")]),s._v(" "),t("li",[s._v("在执行异常的时候，返回尽可能多的信息")])]),s._v(" "),t("h3",{attrs:{id:"改造执行方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#改造执行方法"}},[s._v("#")]),s._v(" 改造执行方法")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632556920186-image.png",alt:""}})]),s._v(" "),t("p",[s._v("在执行之前呢，先获取这个case在对应环境的测试数据，然后将数据解析为"),t("strong",[s._v("json")]),s._v(".")]),s._v(" "),t("p",[s._v("接着就是用异步的方式，挨个儿执行。")]),s._v(" "),t("p",[s._v("其他的比如批量执行，也和这个细节差不多，因为篇幅的问题就不讲了。")]),s._v(" "),t("p",[s._v("大家有兴趣可以看看request/http.py文件。")])])}),[],!1,null,null,null);t.default=e.exports}}]);