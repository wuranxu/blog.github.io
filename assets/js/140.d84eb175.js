(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{552:function(t,a,s){"use strict";s.r(a);var v=s(2),_=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好，我是米洛，一位踩坑人！")])]),t._v(" "),a("p",[t._v("欢迎大家关注我的公众号: "),a("strong",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),a("p",[a("s",[t._v("硬货预警！！！这篇文章主要讲如何在FastApi整合React静态资源（vue同理）。")])]),t._v(" "),a("h3",{attrs:{id:"回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),a("p",[t._v("上次我们说了hash路由和browser路由。今天聊聊Flask，Django，FastApi都通用的路由。")]),t._v(" "),a("h3",{attrs:{id:"路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[t._v("#")]),t._v(" 路由")]),t._v(" "),a("p",[t._v("人们总说url，url，那url到底是什么呢？为什么给你一个url你就不会调到别人的接口了呢？")]),t._v(" "),a("p",[t._v("很明显，"),a("code",[t._v("URL（Uniform Resource Locator,统一资源定位器）")]),t._v("是一个便于我们定位到某一个具体资源的简称。")]),t._v(" "),a("p",[t._v("那路由又是什么鬼？简单点说，"),a("code",[t._v("路由就是url到你对应执行方法之间的映射")]),t._v("。")]),t._v(" "),a("p",[t._v("熟悉django的同学（不包括我）可能都知道，django编写接口的时候是可以通过正则表达式去匹配你的url规则，然后映射到对应的执行函数的。")]),t._v(" "),a("p",[t._v("所以"),a("code",[t._v("从这里")]),t._v("我们就可以知道，你给了我url，通过ip和port（端口）找到了我的服务，但是我服务里面有"),a("code",[t._v("辣么多")]),t._v("的函数，我咋知道"),a("code",[t._v("匹配哪一个，执行哪一个")]),t._v("呢？怎么还不会串呢？")]),t._v(" "),a("p",[t._v("所以出现了上面说的，路由规则（django）,Flask中的"),a("code",[t._v("@app.route")]),t._v("，FastApi中的"),a("code",[t._v("@app.get")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"再聊串串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#再聊串串"}},[t._v("#")]),t._v(" 再聊串串")]),t._v(" "),a("p",[t._v("回到上篇文章说的串串，前端我们定义了自己的路由，后端也有自己的路由。为什么hash路由就不会串了呢？那是因为咱们后端定义路由的时候，没什么人会这样定义:")]),t._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/haha/#/nihaihaoma"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样定义的都是卧龙凤雏，起码"),a("code",[t._v("在座的各位")]),t._v("都不是。所以路由匹配不上，会怎么样？就不会串了呀！")]),t._v(" "),a("h3",{attrs:{id:"打包静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包静态资源"}},[t._v("#")]),t._v(" 打包静态资源")]),t._v(" "),a("p",[t._v("我们在pityWeb目录运行")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("等待打包完成后，把dist里的所有内容全部放到statics目录中去，这里为什么是"),a("code",[t._v("statics")]),t._v("而不是"),a("code",[t._v("static")]),t._v("，稍后再说。")]),t._v(" "),a("h3",{attrs:{id:"fastapi中的静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fastapi中的静态资源"}},[t._v("#")]),t._v(" FastApi中的静态资源")]),t._v(" "),a("p",[t._v("我们看官网给的例子:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628329285820-image.png",alt:"草草几句就完事了"}})]),t._v(" "),a("p",[t._v("我们以Flask进行对照开发，我记得flask是可以设置静态资源目录的，其实这里是一个意思。大致就是把static文件夹下的内容当做了静态资源。")]),t._v(" "),a("h3",{attrs:{id:"操练起来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操练起来"}},[t._v("#")]),t._v(" 操练起来")]),t._v(" "),a("p",[t._v("好家伙，我按照"),a("code",[t._v("官方文档")]),t._v("历练，直接给我沉痛打击。")]),t._v(" "),a("p",[t._v("我想象中的样子:")]),t._v(" "),a("p",[t._v("进入http://localhost7777，就能给咱返回登录页面。")]),t._v(" "),a("p",[t._v("实际上的样子:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628329457687-image.png",alt:"官网一句话，其他全靠自己"}})]),t._v(" "),a("p",[t._v("也许这就是FastApi的魅力吧，快到让你追不上，你就骂不了他了。你的刀虽然长"),a("code",[t._v("40米")]),t._v("，但他已经跑了"),a("code",[t._v("100米")]),t._v("了！")]),t._v(" "),a("h2",{attrs:{id:"尝试解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#尝试解决"}},[t._v("#")]),t._v(" 尝试解决")]),t._v(" "),a("p",[t._v("既然它不给力，咱们已经"),a("code",[t._v("上了贼船")]),t._v("，那总不能临阵脱逃吧！于是我开启了大海捞针模式，好在让我找到了解决方案。")]),t._v(" "),a("p",[t._v("一一分析，首先，为什么他会说"),a("code",[t._v("not found")]),t._v("!那肯定是路由规则没有匹配到！")]),t._v(" "),a("p",[t._v("我们确实没有写"),a("code",[t._v("/")]),t._v("的路由规则，所以合情合理。但我们现在想要，用户进入首页的时候，自动加载我们打包后的index.html文件，也就是说我们要直接返回这个html（也就是前端首页）。")]),t._v(" "),a("p",[t._v("所以我们要加上这个:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628329784348-image.png",alt:"也就是首页路由"}})]),t._v(" "),a("p",[t._v("加好了之后重启服务看看效果:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628329835433-image.png",alt:"可以看到路由随我们心意了，其他的还不太如意"}})]),t._v(" "),a("p",[t._v("别慌，我们继续排查，打开F12:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628329876013-image.png",alt:"可以看到，这些文件都找不到呀"}})]),t._v(" "),a("p",[t._v("继续回忆我们的路由匹配规则，我们没有写: "),a("code",[t._v("/{filename}")]),t._v("这样的路由，所以我们要为这样的路由做个"),a("code",[t._v("匹配")]),t._v("。")]),t._v(" "),a("p",[t._v("因为我们在设计之初，后端路由都是"),a("code",[t._v("业务")]),t._v("加"),a("code",[t._v("名称")]),t._v("，所以不会串。比如: /request/http, /auth/login。（这就体现了一个好的设计的作用了）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330013581-image.png",alt:"我们补充一下这个路由"}})]),t._v(" "),a("p",[t._v("这个路由会匹配到刚才我们找不到的文件，并判断是不是文件，不是就直接给他个"),a("code",[t._v("404")]),t._v("。如果是，我们就打开文件并读内容，再猜出文件的类型，返回对应类型的Response。")]),t._v(" "),a("p",[t._v("这样的好处就是css就返回xxx.css，js就是xxx.js，不会乱套。")]),t._v(" "),a("p",[t._v("再来试试:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330129044-image.png",alt:"诶，你别说，效果还不错"}})]),t._v(" "),a("p",[t._v("但是发现个问题没？logo又没了！！！继续看F12:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330165159-image.png",alt:"这个文件不按套路出牌呀"}})]),t._v(" "),a("p",[t._v("他的url是/static/xxxx，这样我们的路由规则匹配不到的。")]),t._v(" "),a("p",[t._v("所以我们还得再写个路由: "),a("code",[t._v("/static/{filename}")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330232621-image.png",alt:"代码基本和上述一样，只是取文件的地儿不一样，从statics/static取"}})]),t._v(" "),a("p",[t._v("先前改名为statics也是这个原因，里头有重名文件，导致路由一开始进不来（这是我踩的坑，没让你们踩）。")]),t._v(" "),a("p",[t._v("最后试试，事不过三:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330311864-image.png",alt:"完美加载"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-7/1628330325265-image.png",alt:"后端也拿到了请求静态资源的信息"}})]),t._v(" "),a("p",[t._v("随便操作也没啥问题（因为改了路由为hash模式，非hash模式"),a("code",[t._v("刷新会报404")]),t._v("，这也是个坑）")]),t._v(" "),a("p",[t._v("同理，Flask也可以类似去整合"),a("code",[t._v("静态资源")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("遇到问题不可怕，慢慢找寻原因就好！不要慌乱~")])]),t._v(" "),a("p",[t._v("配合"),a("code",[t._v("部署方案文章")]),t._v("口感更佳哦。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://pity.readthedocs.io/deploy/%E9%83%A8%E7%BD%B2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pity.readthedocs.io/deploy/%E9%83%A8%E7%BD%B2/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("😄最后无耻来一波"),a("code",[t._v("求关注")]),t._v("，大家周末愉快~~")])])}),[],!1,null,null,null);a.default=_.exports}}]);