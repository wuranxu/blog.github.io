(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{576:function(t,v,_){"use strict";_.r(v);var a=_(2),s=Object(a.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("blockquote",[v("p",[t._v("大家好~我是"),v("code",[t._v("米洛")]),t._v("！"),v("br"),v("br"),t._v("\n这是一个完整的"),v("code",[t._v("接口测试平台系列教程")]),t._v("，希望能和大家一起学习，从0到1打造一个开源平台。"),v("br"),t._v(" "),v("br"),t._v("\n欢迎关注我的公众号"),v("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),v("h3",{attrs:{id:"回顾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),v("p",[t._v("上一节我们讲了"),v("code",[t._v("软删除")]),t._v("，一个看似无关紧要却又很严肃的问题。如今我们来填一下"),v("code",[t._v("之前的坑")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"之前埋的坑"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#之前埋的坑"}},[t._v("#")]),t._v(" 之前埋的坑")]),t._v(" "),v("p",[t._v("之前我们在用例详情页面，只是让用户可以"),v("code",[t._v("添加断言")]),t._v("，但是没有支持编辑和删除的功能，甚至连展示的页面"),v("code",[t._v("都冇")]),t._v("，那今天我们就来"),v("code",[t._v("好好填坑")]),t._v(":")]),t._v(" "),v("p",[t._v("完成这块的编辑和删除功能。")]),t._v(" "),v("h2",{attrs:{id:"老规矩"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#老规矩"}},[t._v("#")]),t._v(" 老规矩")]),t._v(" "),v("p",[t._v("做完之前，看下当前的效果图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630759259963-image.png",alt:"提供了一个小小的页面"}})]),t._v(" "),v("p",[t._v("其实就是在"),v("code",[t._v("断言")]),t._v(" tab下面写了个curd的"),v("code",[t._v("小页面")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"后端的改动"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#后端的改动"}},[t._v("#")]),t._v(" 后端的改动")]),t._v(" "),v("p",[t._v("之所以把这一节单独拉出来讲，是因为以往我们都是"),v("code",[t._v("新增/编辑数据")]),t._v("以后，去请求一次list接口，等于是请求了2次。")]),t._v(" "),v("p",[t._v("这次我们换个方向，请求后直接拿到最新的那条数据，然后整合到现有的table之中。")]),t._v(" "),v("p",[t._v("其实之所以这么做，是因为我这个页面很大，里面有case的很多信息，涉及到多个表，"),v("code",[t._v("局部数据")]),t._v("的刷新我又不想单独包装一个接口。")]),t._v(" "),v("p",[t._v("让我们看看怎么做吧！")]),t._v(" "),v("h2",{attrs:{id:"了解sqlalchemy的机制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#了解sqlalchemy的机制"}},[t._v("#")]),t._v(" 了解SqlAlchemy的机制")]),t._v(" "),v("p",[t._v("SqlAchemy是一款大家比较熟悉的"),v("code",[t._v("orm")]),t._v("库，在我的使用过程中发现一个特点:")]),t._v(" "),v("p",[t._v("比如我新建了一个"),v("code",[t._v("model")]),t._v("，使用session.add更新到db里面，如果是同步session则还需要commit操作。")]),t._v(" "),v("p",[t._v("但我们如今的需求是，insert到数据库之后拿到最新的数据。其实sqlalchemy会默认把之前插入过的数据销毁掉，也可能不是销毁，反正就是session结束了之后，数据将"),v("code",[t._v("不复存在")]),t._v("。")]),t._v(" "),v("p",[t._v("所以我们百度查了一下，有这样一个方法，可以保留原先的数据:")]),t._v(" "),v("div",{staticClass:"language-pYTHON line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-python"}},[v("code",[t._v("session"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expunge"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br")])]),v("h2",{attrs:{id:"编写新增断言的接口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写新增断言的接口"}},[t._v("#")]),t._v(" 编写新增断言的接口")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630759679629-image.png",alt:"新增的接口和之前的区别就在这了"}})]),t._v(" "),v("p",[t._v("首先用session.flush()等待数据更新，refresh可以帮助我们拿到insert之后的id。")]),t._v(" "),v("p",[t._v("最后我们用expunge方法，保留这个对象，再返回即可。")]),t._v(" "),v("h2",{attrs:{id:"编写编辑断言的接口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写编辑断言的接口"}},[t._v("#")]),t._v(" 编写编辑断言的接口")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630759797701-image.png",alt:"和新增类似"}})]),t._v(" "),v("p",[t._v("编辑和新增类似，但因为我们不需要"),v("code",[t._v("获取主键id")]),t._v("，因为咱们本来就有，所以只需要expunge即可。")]),t._v(" "),v("h2",{attrs:{id:"编写删除断言的接口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写删除断言的接口"}},[t._v("#")]),t._v(" 编写删除断言的接口")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630759845797-image.png",alt:"删除也是一种update"}})]),t._v(" "),v("p",[t._v("因为软删除的缘故，我们实际上执行的也是"),v("code",[t._v("update")]),t._v("操作。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630760024827-image.png",alt:"这样断言的编辑/删除就完成了"}})]),t._v(" "),v("h3",{attrs:{id:"新增执行用例的功能"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#新增执行用例的功能"}},[t._v("#")]),t._v(" 新增执行用例的功能")]),t._v(" "),v("p",[t._v("其实很简单，调用一下之前的"),v("code",[t._v("接口")]),t._v("即可。看看图吧~")]),t._v(" "),v("h2",{attrs:{id:""}},[v("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")]),t._v(" "),v("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630760148151-case%E6%8B%96%E6%8B%BD2.gif",alt:"执行下看看效果"}})]),t._v(" "),v("p",[t._v("至此，一个case的百分之80的执行流程就已经完毕了。接下来还是有"),v("code",[t._v("很多事情")]),t._v("需要做的:")]),t._v(" "),v("ul",[v("li",[t._v("定时任务执行case")]),t._v(" "),v("li",[t._v("用例变量/全局变量目前应该还没应用到断言之中")]),t._v(" "),v("li",[t._v("断言还不支持JSON对比等等")]),t._v(" "),v("li",[t._v("用例评分系统")]),t._v(" "),v("li",[t._v("用户操作记录")]),t._v(" "),v("li",[t._v("工作台未完成")]),t._v(" "),v("li",[t._v("用户资料修改")]),t._v(" "),v("li",[t._v("用户管理功能")]),t._v(" "),v("li",[t._v("七牛云/阿里云oss接入")]),t._v(" "),v("li",[t._v("其他前置条件类型")]),t._v(" "),v("li",[t._v("后置条件")])]),t._v(" "),v("h2",{attrs:{id:"-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#-2"}},[t._v("#")]),t._v(" ......")]),t._v(" "),v("p",[t._v("就以上已经有很多内容了，更别说未来的:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("数据工厂")])]),t._v(" "),v("li",[v("p",[t._v("精准测试等等")]),t._v(" "),v("p",[t._v("不过话说回来，这个平台希望的就是"),v("code",[t._v("真正从0到1做成一个完全体的平台")]),t._v("，慢慢填坑吧~")])])])])}),[],!1,null,null,null);v.default=s.exports}}]);