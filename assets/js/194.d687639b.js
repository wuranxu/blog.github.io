(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{606:function(t,v,_){"use strict";_.r(v);var a=_(2),e=Object(a.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h3",{attrs:{id:"回顾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),v("p",[t._v("上一节我们狠狠"),v("code",[t._v("操练")]),t._v("了一番oss，但我们的任务还很长久，所以我们需要继续打磨我们的功能。")]),t._v(" "),v("p",[t._v("那今天就让我们来思考下，如何在"),v("code",[t._v("前置条件")]),t._v("支持python脚本，多的不说，我们也暂时不考虑其他语言，因为光考虑支持python，已经够呛啦。")]),t._v(" "),v("p",[v("strong",[t._v("本文旨在探讨一些思路的可行性，不会实际着手编写。")])]),t._v(" "),v("h3",{attrs:{id:"究竟缺什么"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#究竟缺什么"}},[t._v("#")]),t._v(" 究竟缺什么")]),t._v(" "),v("p",[t._v("因为我们只考虑Python脚本，所以我们必须"),v("code",[t._v("认真考虑")]),t._v("我们的需求。")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("能够通过python脚本构建数据")]),t._v(" "),v("p",[t._v("我举个例子，我可以用python脚本实现一些很复杂的功能，而这些功能在当前条件下都不大可能支持。比方说，我想获取当前月的第一天的日期，又或者我想做一些加解密/base64的运算，尽管"),v("code",[t._v("pity")]),t._v("可以默认帮助实现这些功能，但总会有意想不到的场景出现。为了解决这些困难，我们可以适当编写脚本完成这些工作。")])]),t._v(" "),v("li",[v("p",[t._v("能够支持参数")]),t._v(" "),v("p",[t._v("这里的参数指的是"),v("code",[t._v("pity")]),t._v("内置的参数${参数}")])]),t._v(" "),v("li",[v("p",[t._v("能够获取到"),v("code",[t._v("返回值")])]),t._v(" "),v("p",[t._v("这个需求大家都能理解，有时候我是想触发一个功能，比如给某些人发邮件，我不需要知道过程，我只要完成这个功能即可。而有时候呢，我需要的是执行过程，并得到"),v("code",[t._v("确切的结果")]),t._v("。所以这个功能是必不可少的。")])])]),t._v(" "),v("h3",{attrs:{id:"思索方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#思索方案"}},[t._v("#")]),t._v(" 思索方案")]),t._v(" "),v("p",[t._v("要想在python web中执行动态的python脚本，我们可以怎么做呢？")]),t._v(" "),v("h4",{attrs:{id:"exec"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#exec"}},[t._v("#")]),t._v(" exec")]),t._v(" "),v("p",[t._v("exec是一个能够"),v("code",[t._v("执行给定python代码")]),t._v("的系统方法，可能也不是很被推荐。它接受的参数是"),v("code",[t._v("python代码")]),t._v("，举个例子:")]),t._v(" "),v("div",{staticClass:"language-python line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-python"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行原生python脚本print了一条语句")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你在肝什么"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br")])]),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04dab6e48a844e70b161a65c68c887fb~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),v("p",[t._v("接着我们试试在exec中定义一个方法main，并试试能不能调用。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/692109072b424b2396aacc712b7b1cf8~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),v("p",[t._v("可以看到是能的，这个我只能说"),v("code",[t._v("肥肠牛批")]),t._v("！因为我也基本是没用过，只是知道，今天也是和大家一起尝试下。")]),t._v(" "),v("p",[t._v("至于为什么不被推荐，可能是因为危险性过高，毕竟你传入的啥人家都能给你执行掉。")]),t._v(" "),v("p",[t._v("不过好在exec的数据可以拿到方法执行的返回值，也可以通过"),v("code",[t._v("字符串替换")]),t._v("的方式获得对应的返回值。")]),t._v(" "),v("h4",{attrs:{id:"自建python项目"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自建python项目"}},[t._v("#")]),t._v(" 自建python项目")]),t._v(" "),v("p",[t._v("由于代码都是python，我们完全可以用git维护一套python工具库。接着通过"),v("code",[t._v("动态导入")]),t._v("来执行对应的方法，这样做的好处是更灵活，但也伴随着更高的成本。")]),t._v(" "),v("p",[t._v("我们得去更新代码（包括监听git push钩子，或者定时拉取以及手动更新），还得提供一个编辑页面，可以让用户更改对应的代码。")]),t._v(" "),v("p",[t._v("但最烦人的还是有扩展包的时候，我们的web项目甚至都需要去"),v("code",[t._v("安装扩展包")]),t._v("。")]),t._v(" "),v("p",[t._v("说起原理倒不难，简单的说就是内嵌了一个python文件目录，通过import导入对应的方法并执行。")]),t._v(" "),v("h4",{attrs:{id:"http的方式-不推荐"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#http的方式-不推荐"}},[t._v("#")]),t._v(" http的方式(不推荐)")]),t._v(" "),v("p",[t._v("新启动一个服务，里面提供了一个api，通过传入method，param等信息，实现调用方法并"),v("code",[t._v("拿到返回值")]),t._v("的效果。")]),t._v(" "),v("p",[t._v("缺点就是代价比较大，起了新服务，如果服务挂掉影响较大。优点是能够跨语言，但是还是偏"),v("code",[t._v("重")]),t._v("了。")]),t._v(" "),v("h4",{attrs:{id:"mq"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mq"}},[t._v("#")]),t._v(" mq")]),t._v(" "),v("p",[t._v("有http就可以有mq的方式，通过生产者和消费者去解耦A系统依赖B系统的逻辑，用消息队列来处理相关逻辑，可以用rabbitmq完成这样的工作。")]),t._v(" "),v("h4",{attrs:{id:"grpc"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#grpc"}},[t._v("#")]),t._v(" grpc")]),t._v(" "),v("p",[t._v("虽然grpc很强大，但是不推荐，虽然跨语言是个非常诱人的"),v("code",[t._v("特性")]),t._v("，但是对于新人不太友好，有一定的学习成本，底层虽然改用rpc调用，序列化升级为protobuf会更高效，但学习成本高，官方也没有好的负载均衡/服务注册发现方案，对于不同语言甚至要实现不同的一套逻辑，开发成本也不低。")]),t._v(" "),v("h3",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),v("p",[t._v("上面大概列举了5种方式，我个人比较相对推荐的还是exec，内置python包和mq的形式。")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("方案")]),t._v(" "),v("th",[t._v("多语言")]),t._v(" "),v("th",[t._v("成本")]),t._v(" "),v("th",[t._v("稳定性")]),t._v(" "),v("th",[t._v("额外组件")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("exec")]),t._v(" "),v("td",[t._v("否")]),t._v(" "),v("td",[t._v("低")]),t._v(" "),v("td",[t._v("高")]),t._v(" "),v("td",[t._v("否")])]),t._v(" "),v("tr",[v("td",[t._v("import")]),t._v(" "),v("td",[t._v("否")]),t._v(" "),v("td",[t._v("中")]),t._v(" "),v("td",[t._v("高")]),t._v(" "),v("td",[t._v("否")])]),t._v(" "),v("tr",[v("td",[t._v("http")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("高")]),t._v(" "),v("td",[t._v("低")]),t._v(" "),v("td",[t._v("否")])]),t._v(" "),v("tr",[v("td",[t._v("mq")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("高")]),t._v(" "),v("td",[t._v("中")]),t._v(" "),v("td",[t._v("是")])]),t._v(" "),v("tr",[v("td",[t._v("grpc")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("非常高")]),t._v(" "),v("td",[t._v("中")]),t._v(" "),v("td",[t._v("是")])])])]),t._v(" "),v("h2",{attrs:{id:"mq的缺点就是需要实现不同语言的消费者以及需要引入额外的组件。由于我们暂时只支持python-所以我们优先选择第一种exec的方式-至于第二种-我是有计划也一并加入的。"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mq的缺点就是需要实现不同语言的消费者以及需要引入额外的组件。由于我们暂时只支持python-所以我们优先选择第一种exec的方式-至于第二种-我是有计划也一并加入的。"}},[t._v("#")]),t._v(" mq的缺点就是需要实现不同语言的消费者以及需要引入额外的组件。由于我们暂时只支持python，所以我们优先选择第一种exec的方式，至于第二种，我是有计划也一并加入的。")]),t._v(" "),v("p",[t._v("本节内容就介绍到这里，欢迎大家给出其他想法或者建议，也可以一起讨论。")]),t._v(" "),v("p",[t._v("后端代码仓库: "),v("a",{attrs:{href:"http://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://github.com/wuranxu/pity"),v("OutboundLink")],1)]),t._v(" "),v("p",[t._v("前端代码仓库: "),v("a",{attrs:{href:"http://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://github.com/wuranxu/pityWeb"),v("OutboundLink")],1)])])}),[],!1,null,null,null);v.default=e.exports}}]);