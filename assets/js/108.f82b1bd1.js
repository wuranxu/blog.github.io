(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{519:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"回顾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[s._v("#")]),s._v(" 回顾")]),s._v(" "),t("p",[s._v("很久没有更新文章了，此时已经是23:23了，有些愧疚，因为自己最近交接的事情+生活的事情还是比较多的，所以到了晚上就没有力气来更新了。这里就更加佩服WQRF这个"),t("strong",[s._v("神一样的男人")]),s._v("！")]),s._v(" "),t("p",[s._v("记得上次说到，我们制作了一个简易的支持"),t("strong",[s._v("HTTP")]),s._v("请求的页面，实际上我们却"),t("code",[s._v("没有把它用到用例之中")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"用例设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用例设计"}},[s._v("#")]),s._v(" 用例设计")]),s._v(" "),t("p",[s._v("我这个人有个很大的缺点，想到啥就做啥，经常是事先设计一个简版，然后后续进行"),t("strong",[s._v("打磨")]),s._v("，其实这样对一个成熟的系统来说太不友好了，很多东西可能在设计的时候就太过于局限了。这里不扯废话了，直接进入主题吧。")]),s._v(" "),t("h3",{attrs:{id:"关于用例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于用例"}},[s._v("#")]),s._v(" 关于用例")]),s._v(" "),t("p",[s._v("思考过很多次，目前在公司制作的测试平台有个特点，就是不需要写代码就可以完成"),t("strong",[s._v("接口测试用例")]),s._v("的编写，只不过碍于对大家的成长没有太大的"),t("code",[s._v("提升")]),s._v("，所以我这次打算做到"),t("strong",[s._v("兼容")]),s._v("，如果你愿意写代码，那么你可以"),t("strong",[s._v("导入代码")]),s._v("或者在线编写代码，如果不想看到代码，也可以采用"),t("strong",[s._v("无码模式")]),s._v("，并且还要做到随时转换。")]),s._v(" "),t("h3",{attrs:{id:"用例的生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用例的生命周期"}},[s._v("#")]),s._v(" 用例的生命周期")]),s._v(" "),t("p",[s._v("从设计上来说，用例以链路的形式执行，一个用例会有很多个"),t("strong",[s._v("临时变量")]),s._v("，通过它们，我们可以解决数据依赖，完成对整个流程的测试。由于笔者"),t("strong",[s._v("画图能力")]),s._v("有限，所以这里就不上图了。一个用例分为几个部分:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("前置setUp操作")])]),s._v(" "),t("li",[t("p",[s._v("用例执行")])]),s._v(" "),t("li",[t("p",[s._v("后置tearDown操作")])])]),s._v(" "),t("p",[s._v("其中每个操作里面都拥有很多个步骤(step)，每个step产生的数据都会在主用例的生命周期中保存，达到数据互通的效果。")]),s._v(" "),t("p",[s._v("这里的步骤可以是"),t("code",[s._v("http请求")]),s._v("，"),t("code",[s._v("redis操作")]),s._v("，"),t("code",[s._v("sql语句")]),s._v("，"),t("code",[s._v("python代码片段")]),s._v("等等，每个步骤都可以拥有一个返回值，通过返回值解决数据依赖问题。")]),s._v(" "),t("h3",{attrs:{id:"举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#举例"}},[s._v("#")]),s._v(" 举例")]),s._v(" "),t("p",[s._v("如果我们需要获取用户的"),t("strong",[s._v("余额")]),s._v("，那么我们的用例将这样去编写:")]),s._v(" "),t("ol",[t("li",[s._v("先设计一个登录的测试用例:")])]),s._v(" "),t("p",[s._v("用例名称: 用户登录")]),s._v(" "),t("p",[s._v("前置条件: 无")]),s._v(" "),t("p",[s._v("用例执行: 发送http请求，获取token")]),s._v(" "),t("p",[s._v("后置条件: 无")]),s._v(" "),t("p",[s._v("断言语句: 校验http状态码等")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("编写获取用户余额的测试用例(主用例):")])]),s._v(" "),t("p",[s._v("用例名称: 获取用户余额\n前置条件:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("step1: 用户登录")]),s._v(" "),t("p",[s._v("记录返回值为step1，通过step1.token获取到登录接口中的token数据")])])]),s._v(" "),t("p",[s._v("用例执行:\n把body中的${step1.token}替换为真实的token，发送http请求。")]),s._v(" "),t("p",[s._v("后置条件:无")]),s._v(" "),t("p",[s._v("断言语句: 校验code和msg以及data字段中的信息")]),s._v(" "),t("p",[t("em",[s._v("初期看不懂不要紧，大概方向是这个样子。主要也没有图片，这是一个流程化的东西。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-4-1/1617208246794-image.png",alt:"补充一下图片"}})]),s._v(" "),t("h2",{attrs:{id:"公用组件包pity-basic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#公用组件包pity-basic"}},[s._v("#")]),s._v(" 公用组件包pity_basic")]),s._v(" "),t("p",[s._v("主要内容有:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("存储用例生命周期产生的变量")])]),s._v(" "),t("li",[t("p",[s._v("寻找请求字段中的变量并替换成真实数据")])]),s._v(" "),t("li",[t("p",[s._v("redis相关操作")])]),s._v(" "),t("li",[t("p",[s._v("sql相关操作")])]),s._v(" "),t("li",[t("p",[s._v("http相关操作")])]),s._v(" "),t("li",[t("p",[s._v("python代码块相关操作")]),s._v(" "),t("p",[s._v("上述的代码相关的操作都是为了能将"),t("strong",[s._v("数据和代码")]),s._v("进行互相转换，具体的构思还没有完全想好。我喜欢边写边想，不然我想得肯定不全，只有写的时候遇到问题了才能想好要怎么做下一步。")]),s._v(" "),t("p",[s._v("给我思考的时间有限，我只能走一步算一步了！")]),s._v(" "),t("p",[t("em",[s._v("其实这里我也觉得自己说的云里雾里，还是等后续成品出来了，回过头来看或者修改这篇文章吧！")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-31/1617206100945-image.png",alt:"目录大致结构"}})])])]),s._v(" "),t("h3",{attrs:{id:"编写变量查找相关方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写变量查找相关方法"}},[s._v("#")]),s._v(" 编写变量查找相关方法")]),s._v(" "),t("p",[s._v("这边我们自己内定一套规则，凡是"),t("code",[s._v("${变量}")]),s._v("这种数据，都是需要替换的变量，可能由其他前置或常量产生，需要随时替换。这个规则要求变量尽量简单，不要搞特殊符号。")]),s._v(" "),t("div",{staticClass:"language-Python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" re\n\nel_exp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('r"\\$\\{(.+)\\}"')]),s._v("\npattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" re"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("compile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("el_exp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_el_expression")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    获取el表达式\n    :param string:\n    :return:\n    """')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" re"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("findall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"select * from xxx where name = '${mygod}'\"")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("get_el_expression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://static.pity.fun/picture/2021-4-1/1617206852101-image.png",alt:"验证输出无误，成功找到变量"}})]),s._v(" "),t("p",[s._v("我们用正则提取变量，这样如果我们的sql语句里面有变量的情况下，可以做到动态sql语句，如上图。不过基于这，我们还需要提供一个变量池，用来存放这个用例的所有"),t("code",[s._v("临时变量")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"编写变量池相关方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写变量池相关方法"}},[s._v("#")]),s._v(" 编写变量池相关方法")]),s._v(" "),t("div",{staticClass:"language-Python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\npity变量池\n变量池的生命周期与用例保持一致\n"""')]),s._v("\n__author__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xiaoke"')]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VarPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" case_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n\n        :param case_id: 用来标识变量所处的主生命周期case\n        """')]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("case_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" case_id\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" default_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" default_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h2",{attrs:{id:"这里创建了一个变量池类-实际上维护了一个map-当然由于复杂场景下-可能会有变量冲突的情况-所以我们会在web页面层去控制-去保证用户不使用重复的变量。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#这里创建了一个变量池类-实际上维护了一个map-当然由于复杂场景下-可能会有变量冲突的情况-所以我们会在web页面层去控制-去保证用户不使用重复的变量。"}},[s._v("#")]),s._v(" 这里创建了一个变量池类，实际上维护了一个map，当然由于复杂场景下，可能会有"),t("strong",[s._v("变量冲突")]),s._v("的情况，所以我们会在web页面层去控制，去保证用户"),t("strong",[s._v("不使用重复的变量")]),s._v("。")]),s._v(" "),t("p",[s._v("今天的内容就先到这里了，主要还是一个构思的问题。后面慢慢补全这些概念，使它越来越明朗。因为我现在也很懵逼，如果疑惑的话，可以等整个用例流程打通了再来"),t("strong",[s._v("回顾")]),s._v("一下。")]),s._v(" "),t("p",[s._v("后续的话pity_basic会作为一个"),t("strong",[s._v("tar包")]),s._v("，可在pypi下载，单独抽出这个包的主要原因还是为了支持"),t("strong",[s._v("代码")]),s._v("和"),t("strong",[s._v("无码")]),s._v("模式的切换。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/wuranxu/pity_basic",target:"_blank",rel:"noopener noreferrer"}},[s._v("pity_basic代码地址"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);