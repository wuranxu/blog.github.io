(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{626:function(v,_,t){"use strict";t.r(_);var s=t(2),a=Object(s.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("blockquote",[_("p",[v._v("大家好，我是米洛，一个"),_("code",[v._v("卷王加班仔")]),v._v("。求三连！求关注"),_("code",[v._v("米洛的测开日记")]),v._v("!")])]),v._v(" "),_("p",[v._v("正则表达式，一个熟悉又陌生的"),_("code",[v._v("词汇")]),v._v("。说他熟悉，因为刚工作就接触到了。说他陌生，因为我今天"),_("code",[v._v("翻了车")]),v._v("。")]),v._v(" "),_("h3",{attrs:{id:"故事"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#故事"}},[v._v("#")]),v._v(" 故事")]),v._v(" "),_("p",[v._v("下午6点，在我打算去吃完饭的前一秒，我的"),_("code",[v._v("老板")]),v._v("跟我发来一条消息:")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629375742321-image.png",alt:""}})]),v._v(" "),_("p",[v._v("我心里想，这有嘛，给我不分分钟搞定吗？还是先"),_("code",[v._v("吃饭")]),v._v("要紧！在干完一大碗水饺后，我回到了座位上，开始调试这条SQL。")]),v._v(" "),_("p",[v._v("可能有人会问了，为什么我要解析SQL，这个不是"),_("code",[v._v("SQL解释器")]),v._v("做的事情吗，你来凑什么热闹！")]),v._v(" "),_("p",[v._v("其实是这样的，开发提供了一款cud(增删改)的接口，主要是针对一些分库分表的数据，只要告诉他，你要改什么字段，主键是啥，分分钟完成: "),_("code",[v._v("shard + cud")]),v._v("的操作，比较方便。但唯一的缺点就是，咱们测试如果写SQL，需要把SQL给转换为JSON请求体。")]),v._v(" "),_("p",[v._v("第一是转换过程比较麻烦，第二是大家也都习惯写"),_("code",[v._v("SQL语句")]),v._v("了。")]),v._v(" "),_("p",[v._v("但作为"),_("code",[v._v("团队提效小能手")]),v._v("的我，便提供了这样一款工具。可以让他们在页面上写SQL，我在暗处"),_("code",[v._v("悄悄给转为json请求体")]),v._v("，并发送给开发的接口，合着我就是一中间人。")]),v._v(" "),_("p",[v._v("其实核心原理就是通过"),_("code",[v._v("正则表达式")]),v._v("去处理用户输入的SQL，拼凑出想要的数据。")]),v._v(" "),_("h2",{attrs:{id:"之前的正则-可以留言吐槽我写的烂"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#之前的正则-可以留言吐槽我写的烂"}},[v._v("#")]),v._v(" 之前的正则(可以留言吐槽我写的烂)")]),v._v(" "),_("p",[_("strong",[v._v("因为整个项目都是用Java编写，所以本文以Java为主，但是结尾有Python解法。")])]),v._v(" "),_("p",[v._v("先来看看我之前写的sql，匹配"),_("code",[v._v("insert")]),v._v("操作的:")]),v._v(" "),_("div",{staticClass:"language-Java line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-java"}},[_("code",[_("span",{pre:!0,attrs:{class:"token class-name"}},[v._v("String")]),v._v(" insert "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v('"insert\\\\s*into\\\\s+(.+)\\\\s*\\\\((.+)\\\\)\\\\s*values\\\\s*\\\\((.+)\\\\)"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br")])]),_("p",[v._v("可以看出，我用了3个()去分别筛选出3个数据:")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("表名: 这个紧挨着"),_("code",[v._v("insert into")]),v._v("的数据")])]),v._v(" "),_("li",[_("p",[v._v("字段名: 在表名后面，在()里面")])]),v._v(" "),_("li",[_("p",[v._v("字段值: 在values后面的()里面")]),v._v(" "),_("p",[v._v("详细解释一下:")]),v._v(" "),_("p",[v._v("insert + 至少0个空格 + into+至少1个空格 + ("),_("code",[v._v("表名")]),v._v(") + 至少0个空格 ("),_("code",[v._v("字段名")]),v._v(") + 至少0个空格 + values + 至少0个空格 + ("),_("code",[v._v("字段值")]),v._v(")")]),v._v(" "),_("p",[v._v("注: "),_("code",[v._v("\\\\s代表空格")])])])]),v._v(" "),_("h2",{attrs:{id:"找到问题"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#找到问题"}},[v._v("#")]),v._v(" 找到问题")]),v._v(" "),_("p",[v._v("其实问题很简单，这个正则也存在一个很大的问题: 我用"),_("code",[v._v("(.+)")]),v._v("去匹配表是没问题的，但是在字段之间，有的"),_("code",[v._v("小可爱")]),v._v("是会给你加上换行符号(\\n)的，因为正则默认.是"),_("code",[v._v("无法匹配换行符号")]),v._v("的，这就导致(.+)没法匹配到下一行的数据了，从而导致执行失败。")]),v._v(" "),_("p",[v._v("确实，这个没得洗，我才是"),_("code",[v._v("小可爱(辣鸡)")]),v._v("。")]),v._v(" "),_("p",[v._v("有人问了，你还有个地方没注意啊，你的insert是小写的，我要是大写的"),_("code",[v._v("INSERT")]),v._v("你也匹配不到哦！其实不然，在Java里面，可以在正则匹配的时候提供一个参数：")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629377189915-image.png",alt:"没错，就是这个CASE_INSENSITIVE"}})]),v._v(" "),_("p",[v._v("这个参数代表我"),_("code",[v._v("忽略大小写")]),v._v("，所以我是这样玩的。")]),v._v(" "),_("h2",{attrs:{id:"解决问题"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#解决问题"}},[v._v("#")]),v._v(" 解决问题")]),v._v(" "),_("p",[v._v("经过我的一番搜索，终于俾我找到了"),_("code",[v._v("解决方案")]),v._v("！那就是正则匹配的时候，是有个"),_("code",[v._v("dotall")]),v._v("的选项的，注意这个选项不只是Java里面有哦。于是我找Pattern的参数，果然有个DOTALL变量:")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629377338401-image.png",alt:"试用了一下，果然搞定了"}})]),v._v(" "),_("p",[v._v("但是这样我的"),_("code",[v._v("大小写")]),v._v("就没法生效了，愁人！因为它只"),_("code",[v._v("接受一个参数")]),v._v("！！！")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629378248189-image.png",alt:""}})]),v._v(" "),_("p",[_("img",{attrs:{src:"https://img.soogif.com/pbQpRm1SKPxeK4ItYKkazRpAwrmHexGR.gif?scope=mdnice",alt:""}})]),v._v(" "),_("p",[v._v("那么有没有"),_("code",[v._v("两全其美")]),v._v("的办法呢？")]),v._v(" "),_("p",[v._v("其实是有的，只要多搜一搜就会找到:")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629377497524-image.png",alt:""}})]),v._v(" "),_("p",[v._v("有个哥们又想匹配特殊符号，又想忽略大小写，所以对我们来说也适用，于是我们可以这么写:")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629377550190-image.png",alt:"打完收工"}})]),v._v(" "),_("p",[v._v("不知道小伙伴们，你们知不知道正则的这些特点呢？")]),v._v(" "),_("ul",[_("li",[_("code",[v._v(".")]),v._v("不能匹配换行符号")]),v._v(" "),_("li",[v._v("正则在匹配时可以忽略大小写")]),v._v(" "),_("li",[v._v("可以让"),_("code",[v._v(".")]),v._v("匹配换行符号")])]),v._v(" "),_("h2",{attrs:{id:"python里面怎么做呢"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#python里面怎么做呢"}},[v._v("#")]),v._v(" Python里面怎么做呢？")]),v._v(" "),_("p",[v._v("毕竟咱们确实还是"),_("code",[v._v("Python")]),v._v("博主，I write Java, But I love Python!")]),v._v(" "),_("p",[v._v("不得不说，正则还是太强大了，各个语言都有对应的实现:")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629378037996-image.png",alt:""}})]),v._v(" "),_("p",[v._v("SQL语句:")]),v._v(" "),_("p",[_("code",[v._v("insert into ceshikaifaganhuo (name, \\nowner, \\nage) VAlues ('wang', 'wangz', 2);")])]),v._v(" "),_("p",[v._v("正则表达式:")]),v._v(" "),_("p",[_("code",[v._v("insert[\\s|\\r|\\n]*into[\\s|\\r|\\n]*(.+)[\\s|\\r|\\n]*\\((.+)\\)[\\s|\\r|\\n]*values[\\s|\\r|\\n]*\\((.+)\\)")])]),v._v(" "),_("p",[v._v("可以看到不管是单纯的DOTALL还是单纯的IGNORECASE都无法取到结果，但是Python我类比了一下，果然也可以通过"),_("code",[v._v("|")]),v._v("去同时传递2个参数，最终拿下(加班2小时的offer)！！！")]),v._v(" "),_("hr"),v._v(" "),_("p",[v._v("关注我，带你了解更多"),_("code",[v._v("加班知识")]),v._v("！👻👻👻所以，你学会了吗？")])])}),[],!1,null,null,null);_.default=a.exports}}]);