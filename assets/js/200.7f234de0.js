(window.webpackJsonp=window.webpackJsonp||[]).push([[200],{611:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("大家好~我是"),s("code",[t._v("米洛")]),t._v("！"),s("br"),t._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的"),s("code",[t._v("教程")]),t._v("，希望大家多多支持。"),s("br"),t._v("\n欢迎关注我的公众号"),s("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),s("h3",{attrs:{id:"回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),s("p",[t._v("上一节我们完成了"),s("code",[t._v("后置条件")]),t._v("功能。这样整个用例的生命周期，除了跟"),s("code",[t._v("yapi")]),t._v("（或其他接口文档工具）关联以外，用例的逻辑基本上算是告一段落了。")]),t._v(" "),s("p",[t._v("这一篇我们打算将目光放在用户上，接着我们需要做的是以下几件事，也不是说全部做这些，只是还需要做的有这些。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("完成"),s("code",[t._v("操作日志")]),t._v("功能")])]),t._v(" "),s("li",[s("p",[t._v("完成用户管理功能")])]),t._v(" "),s("li",[s("p",[t._v("完成个人设置页面")])]),t._v(" "),s("li",[s("p",[t._v("完成工作台功能")]),t._v(" "),s("p",[t._v("那这节我们就先完成"),s("code",[t._v("操作日志")]),t._v("相关的功能。")])])]),t._v(" "),s("h3",{attrs:{id:"思考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[t._v("#")]),t._v(" 思考")]),t._v(" "),s("p",[t._v("操作日志这玩意，和传统意义的日志要分开。我们要说的操作日志是"),s("code",[t._v("更可读的")]),t._v("日志，比如:")]),t._v(" "),s("p",[t._v("2021-12-19 22:15:00 "),s("code",[t._v("米洛")]),t._v(" "),s("strong",[t._v("发表")]),t._v("文章: "),s("code",[t._v("今天排位又坑了别人")]),t._v("。")]),t._v(" "),s("p",[t._v("我们需要的是"),s("code",[t._v("何时何人做了何事")]),t._v("，主要是3个要素。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("时间")])]),t._v(" "),s("li",[s("p",[t._v("人物")])]),t._v(" "),s("li",[s("p",[t._v("事件")]),t._v(" "),s("p",[t._v("对于详细的日志我们"),s("code",[t._v("暂时")]),t._v("不需要记录那么清楚(可能只需要到case的程度)。注意到，这里是暂时。")]),t._v(" "),s("p",[t._v("后续如果我们想知道case的具体改动，又或者说"),s("code",[t._v("我们想订阅某个服务下的case")]),t._v("，不论增删改，我们都想知道，那我们就得加上这些数据。")]),t._v(" "),s("p",[s("strong",[t._v("这功能说白了，就是个小型监视器。")])]),t._v(" "),s("p",[t._v("至于思路的话，我们用个装饰器，在方法执行前把操作记录塞到db即可，暂时先不用太复杂。")])])]),t._v(" "),s("h3",{attrs:{id:"设计表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计表"}},[t._v("#")]),t._v(" 设计表")]),t._v(" "),s("p",[t._v("我们把表分为以下几个字段, 新建app/models/operation_log.py")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" datetime "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" datetime\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DATETIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SMALLINT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TEXT\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Base\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PityOperationLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    用户操作记录表\n    """')]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pity_operation_log'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 操作人")]),t._v("\n    user_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 操作时间")]),t._v("\n    operate_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DATETIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 操作title")]),t._v("\n    title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 操作描述")]),t._v("\n    description "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TEXT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"操作描述"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tag")]),t._v("\n    tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"操作tag"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mode")]),t._v("\n    mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SMALLINT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"操作类型"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# key")]),t._v("\n    key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"关键id，可能是目录id，case_id或者其他id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user_id\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tag\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mode\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" title\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" key\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" description\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operate_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" datetime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br")])]),s("ul",[s("li",[s("p",[t._v("user_id: 操作人")])]),t._v(" "),s("li",[s("p",[t._v("operate_time: 操作时间")])]),t._v(" "),s("li",[s("p",[t._v("title: 操作标题")])]),t._v(" "),s("li",[s("p",[t._v("description: 改动细节")])]),t._v(" "),s("li",[s("p",[t._v("tag: 操作标签")])]),t._v(" "),s("li",[s("p",[t._v("mode: 操作模式")])]),t._v(" "),s("li",[s("p",[t._v("key: 操作关键id")]),t._v(" "),s("p",[t._v("这个key属于预留字段，是为了给case操作记录做的预留。如果某某某改动了某个case的前置条件，其实我们操作记录是只有"),s("code",[t._v("前置条件")]),t._v("的改动。所以遇到这种情况，我们就需要设置key为用例id，这样当我想查询用例改动的时候，就可以查到这条记录了。")]),t._v(" "),s("p",[s("strong",[t._v("当然，这暂时只是我的一个设想。")])])])]),t._v(" "),s("h3",{attrs:{id:"改造pitybase"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#改造pitybase"}},[t._v("#")]),t._v(" 改造PityBase")]),t._v(" "),s("p",[t._v("还记得之前我们设计的pity"),s("code",[t._v("基类")]),t._v("吗？里面包含了create_at等基本字段，在今天，我们还得额外给它加一些东西:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-12-25/1640419287270-image.png",alt:""}})]),t._v(" "),s("p",[t._v("这边添加了4个字段，但注意这些都不是数据表的真实字段，只是我们用来获取操作日志需要的4个字段")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("fields")]),t._v(" "),s("p",[t._v("默认展示的字段，举个例子，一个用户有"),s("code",[t._v("姓名")]),t._v("，"),s("code",[t._v("年龄")]),t._v("等字段，我们要展示哪些字段的改动呢？")]),t._v(" "),s("p",[t._v("明显id，"),s("code",[t._v("创建时间")]),t._v("这些我们是不需要的。")]),t._v(" "),s("p",[t._v("所以这个字段就用来规定我们对"),s("code",[t._v("变更")]),t._v("的展示.")])]),t._v(" "),s("li",[s("p",[t._v("tag")]),t._v(" "),s("p",[t._v("之前说了，表对应的tag，举个例子，在pity里面可以是"),s("code",[t._v("测试用例")]),t._v("，"),s("code",[t._v("测试计划")]),t._v("等。以后如果我们想看所有测试计划的改动，就可以根据tag来筛选。")])]),t._v(" "),s("li",[s("p",[t._v("alias")]),t._v(" "),s("p",[t._v("我们的操作记录，试想一下，如果用这样的方式:")])])]),t._v(" "),s("p",[s("strong",[s("code",[t._v("[数据库配置]")]),t._v(" 乌迪尔 编辑了 数据库: 本地数据库")])]),t._v(" "),s("p",[s("strong",[t._v("name: "),s("s",[t._v("老的redis")]),t._v(" -> 新的redis")])]),t._v(" "),s("p",[s("strong",[t._v("database: "),s("s",[t._v("user")]),t._v(" -> pity_user")])]),t._v(" "),s("p",[t._v("看上去是没啥毛病，但是对用户来说"),s("code",[t._v("不友好")]),t._v("啊!如果我们能把数据库的name换成"),s("code",[t._v("名称")]),t._v("，database换成"),s("code",[t._v("数据库名")]),t._v("会不会更好些?")]),t._v(" "),s("p",[t._v("这就是别名的目的。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("__show__")]),t._v(" "),s("p",[t._v("这个变量是用来"),s("code",[t._v("展示")]),t._v(" 乌迪尔 修改了 xxxx，因为有时候我们可能修改了XXX项目XXX项目角色:")]),t._v(" "),s("p",[s("strong",[t._v("乌迪尔添加了项目 abc -> 用户 李大嘴 -> 角色 管理员")])]),t._v(" "),s("p",[t._v("这里展示字段需要3个，分别是项目，用户和角色。这里根据__fields__联动，取前面N个字段。")])])]),t._v(" "),s("h3",{attrs:{id:"新增pityrelationfield类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增pityrelationfield类"}},[t._v("#")]),t._v(" 新增PityRelationField类")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-12-25/1640425493115-image.png",alt:""}})]),t._v(" "),s("p",[t._v("因为我们的字段名可能是xxx_id，需要关联到别的字段，要不就是"),s("code",[t._v("枚举")]),t._v("类，比如type是0代表用例，1代表sql，所以我们要建立0->1以及xxx_id到表字段的映射关系。")]),t._v(" "),s("p",[t._v("这么说可能很抽象，我们举个具体的例子:")]),t._v(" "),s("p",[t._v("Redis表有个env字段，他来自Environment表的id，所以我们需要把env换成Environment的name字段（比如fat），这样我们就能很好地识别出"),s("code",[t._v("变动")]),t._v("的数据。")]),t._v(" "),s("p",[t._v("init_relation则是建立此等关系，待会我们会说明。")]),t._v(" "),s("h3",{attrs:{id:"修改配置文件config-py"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件config-py"}},[t._v("#")]),t._v(" 修改配置文件config.py")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-12-25/1640426659076-image.png",alt:""}})]),t._v(" "),s("p",[t._v("设置这些变量是为了能够"),s("code",[t._v("很好地")]),t._v("获取对应的值，不然我把__fields__写为__field__就出大问题了。")]),t._v(" "),s("h3",{attrs:{id:"修改crud-init-py"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改crud-init-py"}},[t._v("#")]),t._v(" 修改crud/__init__.py")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-12-25/1640428880740-image.png",alt:""}})]),t._v(" "),s("p",[t._v("上面是动态导入包（建数据表用的），下面则是设置"),s("code",[t._v("映射关系")]),t._v("。")]),t._v(" "),s("p",[t._v("以Redis为例，可以看到Redis.env映射到了Environment.id，第二个字段则是替换成Environment.name。")]),t._v(" "),s("h3",{attrs:{id:"其他细节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他细节"}},[t._v("#")]),t._v(" 其他细节")]),t._v(" "),s("p",[t._v("具体的"),s("code",[t._v("细节")]),t._v("很多，很难一步一步写清楚，大家可以查看crud/__init__.py里的"),s("code",[t._v("insert_log")]),t._v("方法。")]),t._v(" "),s("p",[s("strong",[t._v("整体思路就是根据预设的字段，存放对应的字段改动，字段有别名则替换字段的别名，比如name->姓名，有其他表的数据则替换为其他表的数据。")])]),t._v(" "),s("h3",{attrs:{id:"具体效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体效果"}},[t._v("#")]),t._v(" 具体效果")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-12-25/1640430271576-image.png",alt:""}})]),t._v(" "),s("p",[t._v("本节内容比较多，感兴趣的朋友可以催更或者自己查看代码。感觉用文字的方式很难讲清楚。")]),t._v(" "),s("p",[t._v("参考链接: 美团分享的文章"),s("a",{attrs:{href:"https://juejin.cn/post/7009116644031070244",title:"https://juejin.cn/post/7009116644031070244",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.cn/post/7009116644031070244"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("对应git commit改动:")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/wuranxu/pity/commit/bf374ac4851ec24e1386b351549c15ebe26772df",title:"https://github.com/wuranxu/pity/commit/bf374ac4851ec24e1386b351549c15ebe26772df",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity/commit/bf374ac4851ec24e1386b351549c15ebe26772df"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"其他实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他实现"}},[t._v("#")]),t._v(" 其他实现")]),t._v(" "),s("h2",{attrs:{id:"如果简单记录的话-不用这么复杂-写出xxx修改了xxx即可。那个可以用装饰器完成。有兴趣的朋友可以自己实现。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果简单记录的话-不用这么复杂-写出xxx修改了xxx即可。那个可以用装饰器完成。有兴趣的朋友可以自己实现。"}},[t._v("#")]),t._v(" 如果简单记录的话，不用这么复杂，写出xxx修改了xxx即可。那个可以用"),s("code",[t._v("装饰器")]),t._v("完成。有兴趣的朋友可以自己实现。")]),t._v(" "),s("p",[t._v("本文由于篇幅问题，就讲到这里了，我去补"),s("code",[t._v("注释")]),t._v("去了~下一节我们把今天写的字段数据展示在"),s("code",[t._v("个人动态页面")]),t._v("中。")])])}),[],!1,null,null,null);s.default=e.exports}}]);