(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{574:function(t,a,s){"use strict";s.r(a);var e=s(2),_=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好~我是米洛，欢迎关注我的公众号"),a("code",[t._v("米洛的测开日记")]),t._v("!")])]),t._v(" "),a("h3",{attrs:{id:"回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),a("p",[t._v("上一节我们讲了"),a("code",[t._v("用例编辑页面")]),t._v("相关的调整，但因为我们的前置条件还不支持按顺序执行，所以我们今天来搞定它。")]),t._v(" "),a("h3",{attrs:{id:"思考一下该怎么做"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考一下该怎么做"}},[t._v("#")]),t._v(" 思考一下该怎么做")]),t._v(" "),a("p",[t._v("其实比较简单，我们给前置条件的表，加一个"),a("code",[t._v("index")]),t._v("的字段，这样的话它就有了自己的"),a("code",[t._v("顺序")]),t._v("，以后我们取"),a("code",[t._v("用例的前置条件")]),t._v("就可以根据index来获取顺序了，执行case的时候也不会错乱了。")]),t._v(" "),a("h3",{attrs:{id:"动起来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动起来"}},[t._v("#")]),t._v(" 动起来")]),t._v(" "),a("h2",{attrs:{id:"新增index字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增index字段"}},[t._v("#")]),t._v(" 新增index字段")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630726225740-image.png",alt:"加入index字段，INT类型"}})]),t._v(" "),a("h2",{attrs:{id:"编写获取最新索引的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写获取最新索引的方法"}},[t._v("#")]),t._v(" 编写获取最新索引的方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630726475449-image.png",alt:""}})]),t._v(" "),a("p",[t._v("先查询这个case下的所有前置条件，按index的倒序排列，如果没查到，则说明没有前置条件，直接返回0，否则返回index+1。")]),t._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")]),t._v(" "),a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630726515499-image.png",alt:"接着在插入前置条件的时候，给它赋予最新的index"}})]),t._v(" "),a("h2",{attrs:{id:"注意一个问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意一个问题"}},[t._v("#")]),t._v(" 注意一个问题")]),t._v(" "),a("p",[t._v("如果调整顺序的时候，可能"),a("code",[t._v("每个元素")]),t._v("都挪动了，那该怎么办呢？")]),t._v(" "),a("p",[t._v("所以我们需要一个批量更新index的方法:")]),t._v(" "),a("h2",{attrs:{id:"编写更新顺序的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写更新顺序的方法"}},[t._v("#")]),t._v(" 编写更新顺序的方法")]),t._v(" "),a("p",[t._v("在sqlalchemy里面，可以用"),a("code",[t._v("bulk_update_mappings")]),t._v("去批量更新一些数据，但前提是"),a("code",[t._v("必须带上id字段")]),t._v("。")]),t._v(" "),a("p",[t._v("遗憾的是，异步session不支持这方法。所以我们的方法编写起来很简单:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630730054304-image.png",alt:"拼接一个数组，里面存放id和index"}})]),t._v(" "),a("p",[t._v("直接更新后commit即可。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630730625155-case%E6%8B%96%E6%8B%BD.gif",alt:"会有一定的延迟，因为是真正去更新数据库了"}})]),t._v(" "),a("p",[t._v("之前的演示图是没去实际"),a("code",[t._v("更新数据库")]),t._v("的。")]),t._v(" "),a("h2",{attrs:{id:"编写更新和删除数据构造器的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写更新和删除数据构造器的方法"}},[t._v("#")]),t._v(" 编写更新和删除数据构造器的方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630735640109-image.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到更新和删除其实都是update的操作，因为咱们是"),a("code",[t._v("软删除")]),t._v("，所以其实就是把constructor的deleted_at改成了当前时间。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630735720239-image.png",alt:"接着编写删除和更新的接口"}})]),t._v(" "),a("h2",{attrs:{id:"前端进行适配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端进行适配"}},[t._v("#")]),t._v(" 前端进行适配")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630735894113-case%E6%8B%96%E6%8B%BD.gif",alt:"点击编辑按钮，可以弹出对应的数据构造器"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-4/1630736097515-case%E6%8B%96%E6%8B%BD2.gif",alt:"给个友好的提示，以免误删"}})]),t._v(" "),a("p",[t._v("好了，今天的内容就说到这里了。"),a("code",[t._v("其实")]),t._v("最花时间的还是在前端的交互上面，但大体上"),a("code",[t._v("数据构造器")]),t._v("算是可用了。")]),t._v(" "),a("p",[t._v("下一节我们讲讲"),a("code",[t._v("软删除之殇")]),t._v("~")])])}),[],!1,null,null,null);a.default=_.exports}}]);