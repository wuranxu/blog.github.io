(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{547:function(t,e,v){"use strict";v.r(e);var _=v(2),r=Object(_.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("blockquote",[e("p",[t._v("大家好，我是米洛，一个测试开发博主，world很大， 你应该去看看！")])]),t._v(" "),e("p",[t._v("欢迎大家关注我的公众号: "),e("code",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"回顾"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),e("p",[t._v("上周插播了一个github登录的内容，没啥反响。那我们这周就继续完善用例相关的内容。")]),t._v(" "),e("h2",{attrs:{id:"题外话"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#题外话"}},[t._v("#")]),t._v(" 题外话")]),t._v(" "),e("p",[t._v("其实虽然我在做这样一个测试平台，但其实就像饭哥说的，存在一些问题:")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("自己的平台没有落地")])]),t._v(" "),e("li",[e("p",[t._v("半成品")])]),t._v(" "),e("li",[e("p",[t._v("自己都没有亲身使用")]),t._v(" "),e("p",[t._v("确实，虽然上家公司支撑到了百分之90多的业务线，但是里面结合了很多公司的内容，比如"),e("code",[t._v("grpc")]),t._v("，"),e("code",[t._v("微服务自动寻址")]),t._v("，"),e("code",[t._v("yapi")]),t._v("，"),e("code",[t._v("内部发布系统，数据工厂")]),t._v("等相关的内容。")]),t._v(" "),e("p",[t._v("这个项目虽然和当时的内容如出一辙(换了一种语言实现)，但确又不太一样。")]),t._v(" "),e("p",[t._v("为了更好地支持平台的发展，加上时间关系，所以我打算挑选一个麻雀虽小，但又"),e("code",[t._v("五脏俱全")]),t._v("的项目来进行测试。")]),t._v(" "),e("p",[t._v("为了后续覆盖率相关的功能，我得找一个开源的Java项目，于是我发现了它，一个博客系统基于springboot+vue+element-ui:")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627795102659-image.png",alt:""}})]),t._v(" "),e("p",[t._v("一般这样开源的项目都差不多是个半成品，但只要他有完善的登录（token/cookie机制），加上有一部分crud功能就行。")]),t._v(" "),e("p",[t._v("这个地址我已经部署到我自己的服务器了，以后就可以直接来测试这个服务了，但第一步我们先要拎出里面的接口数据。")]),t._v(" "),e("p",[t._v("服务地址: http://47.112.32.195:8081/index.html")]),t._v(" "),e("h2",{attrs:{id:"开始研究"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始研究"}},[t._v("#")]),t._v(" 开始研究")]),t._v(" "),e("p",[t._v("大概翻阅了一下它的认证模块，采用的是"),e("code",[t._v("spring-security")]),t._v("，这是我"),e("code",[t._v("没接触")]),t._v("过的全新领域。")]),t._v(" "),e("p",[t._v("不过咱们不用慌，先看看他的登录是咋耍的。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627797582638-image.png",alt:"请求数据"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627797628200-image.png",alt:"返回数据"}})]),t._v(" "),e("p",[t._v("可以看到，它是一个form表单的POST请求，返回的内容"),e("code",[t._v("还没有token这样的信息")]),t._v("。这可如何是好？别怕，我们做这样的工具，不怕特例多，就怕特例少，导致"),e("code",[t._v("兼容性不好")]),t._v("！")]),t._v(" "),e("p",[t._v("咱们好像之前只支持了JSON，我们调试一下登录接口，确认一下:")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627797827904-image.png",alt:"header部分"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627797980180-image.png",alt:"可以看到登录失败了"}})]),t._v(" "),e("h3",{attrs:{id:"找下原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#找下原因"}},[t._v("#")]),t._v(" 找下原因")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627798030172-image.png",alt:"通过debug发现username是空字符串"}})]),t._v(" "),e("p",[t._v("项目地址: https://github.com/lenve/VBlog.git")]),t._v(" "),e("p",[t._v("我们把项目拉到本地"),e("a",{attrs:{href:"https://github.com/lenve/VBlog.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/lenve/VBlog.git"),e("OutboundLink")],1),t._v(" debug发现，username是空字符串。")]),t._v(" "),e("p",[t._v("大概率是我们的"),e("code",[t._v("requests")]),t._v("请求的姿势不对，那怎么办呢？")]),t._v(" "),e("p",[t._v("先看看我们现在的requests请求方法怎么封装的。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627798201006-image.png",alt:""}})]),t._v(" "),e("p",[t._v("可以看到是这样封装的，"),e("code",[t._v("然而")]),t._v("我们的body是个字符串，但是如果我们要请求form表单的时候，body需要是dict。")]),t._v(" "),e("p",[t._v("改造如下:")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627798287629-image.png",alt:""}})]),t._v(" "),e("p",[t._v("如果Content-Type里面带有form了，那我们把body要变成dict（通过json.loads）。")]),t._v(" "),e("p",[t._v("改造后实验一下:")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627798346288-image.png",alt:""}})]),t._v(" "),e("p",[t._v("如此，我们便支持了json还有form的http请求，至于file类型，我们遇到再继续研究。")]),t._v(" "),e("h2",{attrs:{id:"可是token呢"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可是token呢"}},[t._v("#")]),t._v(" 可是token呢？")]),t._v(" "),e("p",[t._v("别急，我们切换到"),e("code",[t._v("Cookie")]),t._v("tab，可以看到Cookie里面已带上了JSESSIONID，我们可通过这个，继续我们后面需要登录的请求。与token相差不大。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-1/1627798450820-image.png",alt:""}})]),t._v(" "),e("p",[t._v("记一下"),e("code",[t._v("优化点")]),t._v("，当请求类型切换到form/json的时候自动改变Content-Type，这样体验会更好一些！")]),t._v(" "),e("p",[t._v("下一篇，我们开始编写"),e("code",[t._v("数据初始化")]),t._v("相关的工作。比如我要查询一篇文章，需要先登录，那么需要初始化的数据就是上面提到的"),e("code",[t._v("JSESSIONID")]),t._v("。")]),t._v(" "),e("p",[t._v("在线演示地址: "),e("a",{attrs:{href:"http://47.112.32.195/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://47.112.32.195/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("前端代码仓库: "),e("a",{attrs:{href:"https://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pityWeb"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("后端代码仓库: "),e("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);