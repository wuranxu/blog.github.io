(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{430:function(t,s,n){"use strict";n.r(s);var a=n(2),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"老大难的跨域问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老大难的跨域问题"}},[t._v("#")]),t._v(" 老大难的跨域问题")]),t._v(" "),s("p",[t._v("我们在做"),s("code",[t._v("前后端分离")]),t._v("的项目，时常会听到"),s("strong",[t._v("跨域")]),t._v("问题。经常看到有人的文章标题写着: "),s("code",[t._v("前端支持跨域")]),t._v("，但显然也只是个噱头而已。")]),t._v(" "),s("p",[t._v("跨域的概念，本人才疏学浅，就不多说了。大家有兴趣可以搜搜相关的介绍。")]),t._v(" "),s("h3",{attrs:{id:"为什么来卷go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么来卷go"}},[t._v("#")]),t._v(" 为什么来卷go")]),t._v(" "),s("p",[t._v("由于Mdnice官方仓库已经很久没有维护了，个人的文章又多如"),s("code",[t._v("牛毛")]),t._v("，在没有目录和搜索功能，官方忽略文件夹相关issue的情况下，我决定自己做一个超级低配版的"),s("code",[t._v("mdnice")]),t._v(",虽然我厚颜无耻地叫它"),s("code",[t._v("mdnice-plus。")])]),t._v(" "),s("p",[t._v("加之也觉得自己2年左右没复习go了，需要再练练go，所以后端打算用gin+gorm来完成了。")]),t._v(" "),s("p",[t._v("今天就聊一聊在go的web框架gin里面怎么解决跨域问题，以及在实践过程中"),s("code",[t._v("踩的坑")]),t._v("。")]),t._v(" "),s("p",[t._v("大概已经抄了mdnice一小部分功能了，差个图床和目录就差不多好了。它大概长这样:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-20/1637408390196-image.png",alt:"还不太完善，有一些样式也没优化到位，说实话还是mdnice好用更多"}})]),t._v(" "),s("h3",{attrs:{id:"解决方案-如果不生效请直接看踩坑指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-如果不生效请直接看踩坑指南"}},[t._v("#")]),t._v(" 解决方案(如果不生效请直接看踩坑指南)")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("民间版本 ⭐⭐⭐⭐")]),t._v(" "),s("p",[t._v("民间版本指的是非官方的版本，其实解决跨域无非是需要设置response header中的allow相关数据，所以在官方没有支持的情况下出了个民间版。")]),t._v(" "),s("p",[t._v("来看看大概版的:")])])]),t._v(" "),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文章转自知乎: https://zhuanlan.zhihu.com/p/228881482")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" middleware\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gin-gonic/gin"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Cors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HandlerFunc "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmethod "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Method\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type,AccessToken,X-CSRF-Token, Authorization, Token"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST, GET, OPTIONS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Expose-Headers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Content-Type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Credentials"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OPTIONS"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AbortWithStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StatusNoContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\tcontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("p",[t._v("用法很简单，使用"),s("code",[t._v("app.Use(Cors())")]),t._v("。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("官方版本 ⭐⭐⭐⭐⭐")]),t._v(" "),s("p",[t._v("官方封装了一个gin-contrib/cors包，里面提供了cors.Config，可以让大家配置相关的跨域选项，简单用法如下:")])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('import (\n\t"github.com/gin-contrib/cors"\n\t"github.com/gin-gonic/gin"\n)\n\nfunc main() {\n\tapp := gin.New()\n\tapp.Use(cors.Default())\n\n}\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("比民间版本更推荐的原因，是代码量特别少，看起来和app.Use(log)这样的代码很接近。")]),t._v(" "),s("h3",{attrs:{id:"踩坑指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#踩坑指南"}},[t._v("#")]),t._v(" 踩坑指南")]),t._v(" "),s("p",[t._v("由于之前用的是iris这个web框架，所以对gin不是太了解。")]),t._v(" "),s("p",[t._v("如果app.Use(middleware)放在"),s("code",[t._v("路由注册")]),t._v("之后，那么这个接口将不为跨域接口，也就是说app.Use跨域的时候，也是有讲究的。")]),t._v(" "),s("p",[t._v("这点很多文章都没有说（可能大家都明白这个？）所以有时候我配置了发现跨域没生效。")]),t._v(" "),s("p",[t._v("比如我这样写代码:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-20/1637409687930-image.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-20/1637409653627-image.png",alt:""}})]),t._v(" "),s("p",[t._v("这样就会报错了，因为cors是最后才添加的。")]),t._v(" "),s("p",[s("strong",[t._v("但也有好处，如果我把需要登录的接口都放到app.Use(auth)之后，写接口的时候就方便许多，不需要额外处理了。")])]),t._v(" "),s("p",[t._v("由于博主的go水平一般般，虚心接受大家提出的建议/意见~大家也要来卷go的话遇到跨域问题，可以来参考参考这篇文章=3=")])])}),[],!1,null,null,null);s.default=e.exports}}]);