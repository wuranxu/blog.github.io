(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{488:function(t,e,s){"use strict";s.r(e);var a=s(2),_=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("blockquote",[e("p",[t._v("大家好~我是"),e("code",[t._v("米洛")]),t._v("！"),e("br"),t._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的"),e("code",[t._v("教程")]),t._v("，希望大家多多支持。"),e("br"),t._v("\n欢迎关注我的公众号"),e("code",[t._v("米洛的测开日记")]),t._v("，一起交流学习!")])]),t._v(" "),e("h3",{attrs:{id:"回顾"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),e("p",[t._v("上一节我们讲了兼容postgresql的相关内容，这一节我们来改造下"),e("code",[t._v("测试报告")]),t._v("相关的内容。功能点很少，看完分分钟。")]),t._v(" "),e("h3",{attrs:{id:"熟悉需求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#熟悉需求"}},[t._v("#")]),t._v(" 熟悉需求")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/0ca0fa58-e717-4d76-82e3-e58c12446ea7.png",alt:""}})]),t._v(" "),e("p",[t._v("先看看图，报告的页面样式先不说，只看"),e("code",[t._v("功能")]),t._v("，有没有发现这个"),e("code",[t._v("更多")]),t._v("很多余，明明就是查看具体的执行日志，所以应该改为"),e("code",[t._v("日志")]),t._v("更合适。")]),t._v(" "),e("p",[t._v("如果我们想再次运行case，可以发现这里并不支持。虽然可以跳转回去，但是我就想在这个页面看看是不是真的还报错（排除网络等原因），所以我们就需要在此"),e("code",[t._v("添加")]),t._v("重试功能。")]),t._v(" "),e("p",[t._v("这里的重试指的是重新运行这一条数据，并展示最新的结果。在我之前公司，有同事提过这样的需求：为了排除掉网络影响，这里如果重试成了，也算case通过了（这样通过率数据好看），但这里我不太想这么做。")]),t._v(" "),e("h3",{attrs:{id:"思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[t._v("#")]),t._v(" 思路")]),t._v(" "),e("p",[t._v("其实这边我们只需要获取到对应的"),e("code",[t._v("case_id")]),t._v("，"),e("code",[t._v("测试数据id")]),t._v(", "),e("code",[t._v("对应的执行环境")]),t._v("就可以直接重新运行这一条case，但我们的"),e("code",[t._v("测试结果表")]),t._v("，目前没有data_id这个字段，所以我们要做一些调整。")]),t._v(" "),e("p",[t._v("而且我们也没有根据测试数据直接执行case的接口，所以我们要编写一个这样的接口。")]),t._v(" "),e("h3",{attrs:{id:"字段改造"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字段改造"}},[t._v("#")]),t._v(" 字段改造")]),t._v(" "),e("p",[t._v("修改model和__init__方法，接着我们要去改动用到init的地方。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/f1b5e047-ec03-432f-a563-2ab97e15efed.png",alt:""}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/d159856b-71f2-4894-9db5-2a08eae74f4d.png",alt:""}})]),t._v(" "),e("h3",{attrs:{id:"改动使用处"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动使用处"}},[t._v("#")]),t._v(" 改动使用处")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/a1207403-8329-4694-8af3-5533228530b4.png",alt:""}})]),t._v(" "),e("p",[t._v("修改TestResult.py的insert方法。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/8c15848d-06c0-40ad-8e44-5a18c84a3437.png",alt:""}})]),t._v(" "),e("p",[t._v("修改run_with_test_data方法。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/51fbf12f-f034-46af-aa69-958431ec2021.png",alt:""}})]),t._v(" "),e("p",[t._v("修改run_single方法。")]),t._v(" "),e("h3",{attrs:{id:"编写后端接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写后端接口"}},[t._v("#")]),t._v(" 编写后端接口")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/728b82ab-7809-4464-81fd-2c2abfe314c6.png",alt:""}})]),t._v(" "),e("p",[t._v("在http.py新增retry方法，首先根据id查到测试数据，接着调用执行case的方法，最后返回数据即可。")]),t._v(" "),e("h3",{attrs:{id:"调整前端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#调整前端"}},[t._v("#")]),t._v(" 调整前端")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修改model/service")]),t._v(" "),e("p",[t._v("很显然我们要写一个model方法和一个service方法，如下：")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/b24d1ed4-6158-4f02-9ee4-daf96725247d.png",alt:""}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/3104469e-693a-4760-ae0a-ca166421c64c.png",alt:""}})]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修改编辑栏")]),t._v(" "),e("p",[t._v("操作这里给出2个a标签（按钮），第一个是日志，第二个是重试。")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/8179fd24-c48c-4d27-9167-1f6fc7e51666.png",alt:""}})]),t._v(" "),e("p",[t._v("具体的重试方法：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/2745a9a2-f216-480a-9f8c-689a58635d56.png",alt:""}})]),t._v(" "),e("p",[t._v("先调用重试方法，拿到返回值以后，把case运行结果写入response，这个response与普通查看日志的窗口共用。")]),t._v(" "),e("h3",{attrs:{id:"看看效果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#看看效果"}},[t._v("#")]),t._v(" 看看效果")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://files.mdnice.com/user/11504/c4986589-01f8-44c9-bffe-c0d7a6a07b3b.gif",alt:""}})]),t._v(" "),e("p",[t._v("重试只是"),e("code",[t._v("再执行case")]),t._v("一次，并不会做更多"),e("code",[t._v("额外")]),t._v("的操作。")]),t._v(" "),e("blockquote",[e("p",[t._v("我是米洛，一直陪伴各位学习！免费的"),e("code",[t._v("小黄心")]),t._v("，帮我点一个吧！")]),t._v(" "),e("p",[t._v("项目地址: "),e("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=_.exports}}]);