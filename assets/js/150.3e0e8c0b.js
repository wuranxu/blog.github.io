(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{555:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"与前端联调注册-登录接口-part-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#与前端联调注册-登录接口-part-2"}},[t._v("#")]),t._v(" 与前端联调注册/登录接口(part 2)")]),t._v(" "),s("h3",{attrs:{id:"回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),s("p",[t._v("上篇我们说啥来着，噢对说要跟"),s("strong",[t._v("前端联调")]),t._v("来着。这期呢，咱们就开始着手写这块内容。")]),t._v(" "),s("p",[t._v("这里如果前端不太擅长的呢，代码你就别仔细看了，因为你肯定也不太理解(虽然我还是会讲讲)。")]),t._v(" "),s("p",[s("code",[t._v("你只需要搬个小板凳，看看具体解决了哪些问题就行，不需要想着怎么去写前端代码，直接copy一下就完事了！（好家伙，我直呼好家伙！）")])]),t._v(" "),s("h3",{attrs:{id:"前端ide配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端ide配置"}},[t._v("#")]),t._v(" 前端IDE配置")]),t._v(" "),s("p",[t._v("这里我推荐"),s("strong",[t._v("Webstorm")]),t._v("，至于vscode本人确实不太感冒，虽然会轻量级一点。(我就是喜欢jetbrains全家桶)")]),t._v(" "),s("p",[t._v("如果没有的话，可以用Pycharm下载Webstorm插件进行开发。")]),t._v(" "),s("h3",{attrs:{id:"建立配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建立配置文件"}},[t._v("#")]),t._v(" 建立配置文件")]),t._v(" "),s("p",[t._v("首先我们第一步先建立配置文件: "),s("code",[t._v("pityWeb\\src\\consts\\config.js")])]),t._v(" "),s("div",{staticClass:"language-JavaScript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:7777'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ROLE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'superAdmin'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("存储我们的后端地址和用户角色信息。")]),t._v(" "),s("h3",{attrs:{id:"查看antd-pro的登录model-pityweb-src-models-login-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看antd-pro的登录model-pityweb-src-models-login-js"}},[t._v("#")]),t._v(" 查看Antd pro的登录model(pityWeb\\src\\models\\login.js)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615303470153-image.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到默认采用的fakeAccountLogin方法(这里被我注释掉了)，我们找到他:")]),t._v(" "),s("h3",{attrs:{id:"改造登录接口-pityweb-src-services-login-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#改造登录接口-pityweb-src-services-login-js"}},[t._v("#")]),t._v(" 改造登录接口(pityWeb\\src\\services\\login.js)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304641841-image.png",alt:""}})]),t._v(" "),s("p",[t._v("代码很简单，由于antd pro给我们封装好了"),s("strong",[t._v("基本的Request方法")]),t._v("，所以我们可以直接按部就班，依葫芦画瓢写出请求"),s("code",[t._v("auth/login")]),t._v("的程序，完整代码:")]),t._v(" "),s("div",{staticClass:"language-JavaScript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/consts/config'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/auth/login")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" params\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h3",{attrs:{id:"修改用户的登录状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改用户的登录状态"}},[t._v("#")]),t._v(" 修改用户的登录状态")]),t._v(" "),s("p",[t._v("仔细看model中的login方法，它做了2步:")]),t._v(" "),s("ol",[s("li",[t._v("登录（mock）")]),t._v(" "),s("li",[t._v("将登录成功/失败的信息传入changeLoginStatus方法")])]),t._v(" "),s("p",[t._v("我们看看"),s("code",[t._v("changeLoginStatus")]),t._v("方法做了什么:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615303859434-image.png",alt:""}})]),t._v(" "),s("ol",[s("li",[t._v("先设置用户的权限，这里我把ROLE已经带入进来")]),t._v(" "),s("li",[t._v("设置当前状态: ok代表登录成功 error代表未成功，由于咱们用的不是status状态判断用户是否登录成功，所以需要修改为三元表达式: "),s("code",[t._v("payload.code === 0 ? 'ok': 'error'")])])]),t._v(" "),s("p",[s("em",[t._v("上述具体返回信息可以从下图中看到")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615303975614-image.png",alt:""}})]),t._v(" "),s("p",[t._v("这里代码我们进行相应调整:")]),t._v(" "),s("div",{staticClass:"language-JavaScript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeLoginStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" payload "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setAuthority(payload.currentAuthority);")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAuthority")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ROLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("role"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304069300-image.png",alt:"注意这里也从mock替换成了真实接口"}})]),t._v(" "),s("h3",{attrs:{id:"尝试一下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#尝试一下"}},[t._v("#")]),t._v(" 尝试一下")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304123696-image.png",alt:"提示网络错误"}})]),t._v(" "),s("p",[t._v("别慌，我们F12（或者右键打开开发者工具）可以看到:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304173867-image.png",alt:""}})]),t._v(" "),s("p",[t._v("没错，我们遇到了"),s("strong",[t._v("跨域问题")]),t._v("。")]),t._v(" "),s("p",[t._v("跨域问题具体可以去百度一下，这里简单介绍一下，是说浏览器出于安全考虑，对于前后端域名不一致的情况下，会默认进行拦截，阻止你们进行交互。这多见于"),s("strong",[t._v("前后端分离的项目")]),t._v("中出现。")]),t._v(" "),s("p",[t._v("可以从前端也可以从后端的角度来处理，我们为了方便，直接改造我们的"),s("code",[t._v("Flask")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"使flask支持跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使flask支持跨域"}},[t._v("#")]),t._v(" 使Flask支持跨域")]),t._v(" "),s("p",[t._v("我们需要先安装一个包: "),s("code",[t._v("pip3 install flask-cors")])]),t._v(" "),s("p",[t._v("然后进行如下改造:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304379743-image.png",alt:"pity/app/init.py"}})]),t._v(" "),s("p",[t._v("注意这个是后端的项目哈，不要搞错了，前后端分离就是前端也搞后端也搞，需要切换。")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Flask\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask_cors "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CORS\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Config\n\npity "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Flask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__name__"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCORS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" supports_credentials"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\npity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("em",[t._v("贴心的我还是贴出了源代码。")])]),t._v(" "),s("h3",{attrs:{id:"再次尝试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#再次尝试"}},[t._v("#")]),t._v(" 再次尝试")]),t._v(" "),s("p",[s("code",[t._v("重启下后端服务哦记得")])]),t._v(" "),s("p",[t._v("输入错误的用户名密码，可以看到登录按钮转了一圈又回到了原点。但是登录接口又是正常响应的:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304670373-image.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304782811-image.png",alt:""}})]),t._v(" "),s("p",[t._v("仔细查看登录块的代码，原来是"),s("strong",[t._v("没有输出错误信息")]),t._v("。我们继续进行改造:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304752567-image.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304850044-image.png",alt:"加个else即可"}})]),t._v(" "),s("p",[t._v("message.error可以弹出错误信息: "),s("code",[t._v("用户名或密码错误")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304898686-image.png",alt:""}})]),t._v(" "),s("p",[t._v("目的达到了，接下来我们来试试正确的用户名和密码:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615304943971-image.png",alt:"可以看到提示成功后又报错了"}})]),t._v(" "),s("p",[t._v("我们去找到api/currentUser接口的调用地方:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-9/1615305010464-image.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到是这个方法在作祟，因为antd pro会mock一个用户，它有姓名等信息，但这些我们需要真实的，所以需要给他进行一次改造:")]),t._v(" "),s("h3",{attrs:{id:"改造获取当前用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#改造获取当前用户信息"}},[t._v("#")]),t._v(" 改造获取当前用户信息")]),t._v(" "),s("p",[t._v("还记得我们的登录接口返回的数据吗？我们每次登录后，把它写入浏览器缓存中，这样当用户登录以后，我们从浏览器缓存取出用户信息即可。")]),t._v(" "),s("ol",[s("li",[t._v("先将用户信息和token设置到缓存")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-10/1615307370787-image.png",alt:""}})]),t._v(" "),s("p",[t._v("localStorage可以操作浏览器缓存，但是只接受string和string的键值对，所以我们需要把user对象序列化为string。")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("从缓存中取出数据")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-10/1615307440826-image.png",alt:""}})]),t._v(" "),s("p",[t._v("记得数据需要反序列化")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("修改登录判断条件，这个坑找了我很久，因为咱们的字段是id不是userId，所以我刚才卡在一直登录了自动被退出:")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-10/1615307491653-image.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"保存后再次尝试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#保存后再次尝试"}},[t._v("#")]),t._v(" 保存后再次尝试")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-3-10/1615307570491-image.png",alt:"一次点亮"}})]),t._v(" "),s("p",[t._v("好了，今天的内容就到这了。前端代码已上传~")]),t._v(" "),s("p",[t._v("后端代码地址: "),s("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("前端代码地址: "),s("a",{attrs:{href:"https://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pityWeb"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("觉得有用的话可以帮忙点个Star哦QAQ")])])])}),[],!1,null,null,null);s.default=r.exports}}]);