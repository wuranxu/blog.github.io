(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{435:function(t,v,_){"use strict";_.r(v);var a=_(2),s=Object(a.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h3",{attrs:{id:"fastapi的隐形坑"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#fastapi的隐形坑"}},[t._v("#")]),t._v(" FastApi的隐形坑")]),t._v(" "),v("blockquote",[v("p",[t._v("大家好，这里是"),v("code",[t._v("米洛")]),t._v("，一个想和大家一起分享测试开发相关的技术，面试经验和成长经历的博主！")])]),t._v(" "),v("p",[t._v("欢迎大家关注我的公众号: "),v("code",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"事情起因"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#事情起因"}},[t._v("#")]),t._v(" 事情起因")]),t._v(" "),v("p",[t._v("今天写完了一部分功能，部署到"),v("code",[t._v("我的阿里云服务器")]),t._v("，使用官方的部署命令:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-17/1626534859819-image.png",alt:""}})]),t._v(" "),v("p",[t._v("也不知道是我的服务器问题还是啥，我的一个"),v("code",[t._v("测试登录接口")]),t._v("的用例，在http请求的时候会"),v("code",[t._v("卡住")]),t._v("。")]),t._v(" "),v("p",[t._v("这一卡不要紧呐，我发现我再开一个页面，其他接口都被"),v("code",[t._v("阻塞")]),t._v("了！！！！也就是说，此时整个服务都"),v("code",[t._v("不可用")]),t._v("了，我真的是"),v("code",[t._v("人都傻了")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"做个简单的测试"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#做个简单的测试"}},[t._v("#")]),t._v(" 做个简单的测试")]),t._v(" "),v("p",[t._v("因为FastApi很推崇大家用async的方式去写接口，所以我的代码里面基本上都是这种格式:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-17/1626535012326-image.png",alt:""}})]),t._v(" "),v("p",[t._v("当你这么写了接口，但你的接口内部阻塞了，比如我刚才说的（http请求一直卡在那），这个时候其他接口会访问不了的。用FastApi的朋友，"),v("code",[t._v("大家可以自测一下")]),t._v("!")]),t._v(" "),v("p",[t._v("我的测试方式是:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-17/1626535175062-image.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("随便改写一个接口，制造一个"),v("code",[t._v("同步等待")]),t._v("的场景，假设这时候你在读写文件，可能也需要花费一些时间的，所以我这里等待了1000秒，为了让大家看效果。")]),t._v(" "),v("li",[t._v("访问环境列表接口，这时候由于环境列表一直阻塞着，页面会处于pending状态。")]),t._v(" "),v("li",[t._v("访问其他接口，比如项目列表。")])]),t._v(" "),v("p",[t._v("多的不说，上gif！")]),t._v(" "),v("p",[t._v("而不sleep的时候会这样，那我有个很大的疑问。如果我在"),v("code",[t._v("下载一个文件")]),t._v("，用了async模式，岂不是要玩完儿？")]),t._v(" "),v("h3",{attrs:{id:"解决方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("把async去掉，改为正常的模式，即使这里sleep很久也不会影响其他线程")])]),t._v(" "),v("li",[v("p",[t._v("如果一定用async+sleep，可以用"),v("code",[t._v("asyncio.sleep()")]),t._v("这个方法")])])]),t._v(" "),v("p",[t._v("大家有兴趣的可以去测试下。")]),t._v(" "),v("h3",{attrs:{id:"最新展示"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#最新展示"}},[t._v("#")]),t._v(" 最新展示")]),t._v(" "),v("p",[t._v("展示一下最新的页面。")])])}),[],!1,null,null,null);v.default=s.exports}}]);