(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{579:function(t,_,v){"use strict";v.r(_);var a=v(2),e=Object(a.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("blockquote",[_("p",[t._v("大家好~我是"),_("code",[t._v("米洛")]),t._v("！"),_("br"),_("br"),t._v("\n这是一个完整的"),_("code",[t._v("接口测试平台系列教程")]),t._v("，希望能和大家一起学习，从0到1打造一个开源平台。"),_("br"),t._v(" "),_("br"),t._v("\n欢迎关注我的公众号"),_("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),_("h3",{attrs:{id:"回顾"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),_("p",[t._v("上一节我们讲了"),_("code",[t._v("怎么去设计")]),t._v("用例目录表，而因为之前我们的case是跟项目绑定的，所以我们这一节去改进case相关部分。")]),t._v(" "),_("h3",{attrs:{id:"理清关系"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#理清关系"}},[t._v("#")]),t._v(" 理清关系")]),t._v(" "),_("p",[t._v("之前"),_("code",[t._v("用例表")]),t._v("里面会有一个project_id和category字段，分别代表项目和目录。我们上节已经制造了目录表，所以需要先去掉之前的project_id字段和目录字段，改为"),_("code",[t._v("directory_id")]),t._v("字段。")]),t._v(" "),_("p",[t._v("其实我们可以简单点，把project_id直接换成"),_("code",[t._v("directory_id")]),t._v("，接着删除category字段。但这样的话，会影响到"),_("code",[t._v("项目列表")]),t._v("页面。")]),t._v(" "),_("p",[t._v("但没关系，本来我们就是要把项目列表页里的case页面剔除的。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630212456352-image.png",alt:"原来的project_id换成了directory_id并且注释掉了category"}})]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630212541620-image.png",alt:"form字段里面也做类似的事情"}})]),t._v(" "),_("h3",{attrs:{id:"改写查询项目的接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#改写查询项目的接口"}},[t._v("#")]),t._v(" 改写查询项目的接口")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630212597436-image.png",alt:"去掉原先查询case树的方法，不返回tree了"}})]),t._v(" "),_("p",[t._v("页面上的改动:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630212654064-image.png",alt:"去掉了左侧的用例列表"}})]),t._v(" "),_("h3",{attrs:{id:"规划一下列表页"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#规划一下列表页"}},[t._v("#")]),t._v(" 规划一下列表页")]),t._v(" "),_("p",[t._v("既然旧的列表页给干掉了，那么新的"),_("code",[t._v("列表页")]),t._v("应该怎么展示呢？")]),t._v(" "),_("p",[t._v("上节我们编写了case目录，那用例是跟目录关联起来的，所以我们大概设想一下这样一个页面:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630212777426-image.png",alt:"因为没画原型图，所以直接用做好的页面展示了"}})]),t._v(" "),_("p",[t._v("可以看到，"),_("code",[t._v("布局")]),t._v("是左右布局:")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("左侧")]),t._v(" "),_("p",[t._v("项目选择和目录树，目录树经过我们上一节的处理，可以"),_("code",[t._v("疯狂嵌套")]),t._v("。目前来看的话，目录"),_("code",[t._v("还不支持移动")]),t._v("，比较可惜。")])]),t._v(" "),_("li",[_("p",[t._v("右侧")]),t._v(" "),_("p",[t._v("右侧就是一个用例列表页，XXX目录下的用例列表，其中还能够根据"),_("code",[t._v("用例名称")]),t._v("和创建人来过滤case。")]),t._v(" "),_("p",[t._v("这边case就没有继续做分页了，单个目录下的case应该不会到几千条那么夸张。")])])]),t._v(" "),_("h3",{attrs:{id:"接下来干嘛"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#接下来干嘛"}},[t._v("#")]),t._v(" 接下来干嘛？")]),t._v(" "),_("p",[t._v("当然是为前端的展示"),_("code",[t._v("提供这些数据")]),t._v("。我们目前需要支持创建人+用例名称+目录的方式进行查询。")]),t._v(" "),_("p",[t._v("而目录又会嵌套，所以我们需要找出目录的"),_("code",[t._v("所有儿子")]),t._v("。又因为目录不可能会那么那么多，所以我们找出"),_("code",[t._v("待查目录")]),t._v("和"),_("code",[t._v("所有非根节点目录")]),t._v("。")]),t._v(" "),_("p",[t._v("比如我要查根目录A下的数据，那么其他根目录肯定不是A的儿子，而是A的兄弟。")]),t._v(" "),_("p",[t._v("如果用一层层for循环去"),_("code",[t._v("查询")]),t._v("数据的话，势必会很影响性能，当然我这里建议大家把查询的结果缓存到redis，一般来说目录咱们不会"),_("code",[t._v("轻易更换")]),t._v("，更换的时候"),_("code",[t._v("删除下缓存")]),t._v("即可，这样会事半功倍。")]),t._v(" "),_("h2",{attrs:{id:"开始行动"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#开始行动"}},[t._v("#")]),t._v(" 开始行动")]),t._v(" "),_("ul",[_("li",[t._v("编写获取A下面所有子目录的方法")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630216808252-image.png",alt:""}})]),t._v(" "),_("ol",[_("li",[t._v("首先找出所有parent 等于 directory_id 或者 不是根目录的数据")]),t._v(" "),_("li",[t._v("和之前一样，把他们塞到一个map里面去，这样建立parent -> son（也就是父亲到儿子之间的映射）")]),t._v(" "),_("li",[t._v("编写获取儿子的方法（递归），把所有的孩子节点都放到result之中")])]),t._v(" "),_("ul",[_("li",[t._v("调整list_testcase方法")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630217049935-image.png",alt:""}})]),t._v(" "),_("p",[t._v("首先获取所有directory_id下的目录，然后找出"),_("code",[t._v("未删除")]),t._v("且directory_id in这些目录的case。")]),t._v(" "),_("p",[t._v("之后如果有其他条件，比如name，create_user这样的，再加入"),_("code",[t._v("筛选条件")]),t._v("。")]),t._v(" "),_("p",[t._v("接着根据case名称排序即可。")]),t._v(" "),_("h2",{attrs:{id:"完善list接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#完善list接口"}},[t._v("#")]),t._v(" 完善list接口")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630217164877-image.png",alt:""}})]),t._v(" "),_("h2",{attrs:{id:"最终效果"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#最终效果"}},[t._v("#")]),t._v(" 最终效果")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-29/1630217283832-image.png",alt:""}})]),t._v(" "),_("p",[t._v("只看右侧的话，他就是一个"),_("code",[t._v("列表页")]),t._v("面，但这边的区别就是他和左侧目录树进行了"),_("code",[t._v("打通")]),t._v("。")]),t._v(" "),_("p",[t._v("拜了个拜，下篇讲下"),_("code",[t._v("如何部署")]),t._v("，至于用例的编辑/新增/执行这块，还需要一些时间。")])])}),[],!1,null,null,null);_.default=e.exports}}]);