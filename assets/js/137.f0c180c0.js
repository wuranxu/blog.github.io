(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{548:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("大家好，我是米洛，一位测试球迷！")])]),t._v(" "),s("p",[t._v("如果阅读完毕后想和作者有更多交流，可以点击"),s("code",[t._v("阅读原文")]),t._v("找到底部评论区，给作者留言啦！")]),t._v(" "),s("p",[t._v("欢迎大家关注我的公众号: "),s("strong",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),s("p",[t._v("（"),s("em",[t._v("本文如果有错误，请及时在公众号发消息指正，有错漏我就删了以免误导大家")]),t._v("！）")]),t._v(" "),s("h3",{attrs:{id:"回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),s("p",[t._v("上回我们搞定了一整套流程，关于"),s("code",[t._v("数据构造器")]),t._v("的，今天我们来引入aiohttp。")]),t._v(" "),s("p",[t._v("在此之前我们简单说下"),s("code",[t._v("预备知识")]),t._v(":")]),t._v(" "),s("h3",{attrs:{id:"python的异步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#python的异步"}},[t._v("#")]),t._v(" Python的异步")]),t._v(" "),s("p",[t._v("其实写这篇文章的时候我内心是很"),s("code",[t._v("纠结")]),t._v("的，因为我其实也不算太明白里头的门路。虽然看了很多文章，但感觉写起异步的代码还是会比较费劲。")]),t._v(" "),s("p",[s("code",[t._v("大家可以去搜索一些异步的文章，让我讲我还讲的不太透彻。")])]),t._v(" "),s("p",[t._v("参考:")]),t._v(" "),s("ul",[s("li",[t._v("异步io: "),s("a",{attrs:{href:"https://www.liaoxuefeng.com/wiki/1016959663602400/1017959540289152",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.liaoxuefeng.com/wiki/1016959663602400/1017959540289152"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"举个鲜活的例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#举个鲜活的例子"}},[t._v("#")]),t._v(" 举个鲜活的例子")]),t._v(" "),s("p",[t._v("比如去买早餐并打包回家。我早上要吃一碗汤面+一杯豆浆+2个油饼。很可惜的是，这3个摊子虽然在一起，但是都是要"),s("code",[t._v("排队")]),t._v("的。")]),t._v(" "),s("p",[t._v("Python同步场景:")]),t._v(" "),s("ol",[s("li",[t._v("我买豆浆，等豆浆打好。")]),t._v(" "),s("li",[t._v("我买汤面，等汤面做好。")]),t._v(" "),s("li",[t._v("我买油饼，等油饼做好。")])]),t._v(" "),s("p",[t._v("这就是一个个的同步任务，我只有"),s("code",[t._v("做完了一个")]),t._v("才能"),s("code",[t._v("去做下一个")]),t._v("。耗费总时间为3个步骤的耗时总和。")]),t._v(" "),s("p",[t._v("Python异步(asyncio)就类似这样的场景:")]),t._v(" "),s("ol",[s("li",[t._v("我先和老板说我要一碗汤面，这时候老板正在制作中或者排队中，但是他已经在处理我的需求了")]),t._v(" "),s("li",[t._v("我再去和包子铺的人说来杯豆浆")]),t._v(" "),s("li",[t._v("最后去油货铺子跟老板说要2个油饼")])]),t._v(" "),s("p",[t._v("如果1，2，3里面任意一个好了，都会通知我去拿，这样虽然我还是一个人，但是我效率更高了。耗时总时间仅仅是一个线程内部的切换+最慢的那个时间。")]),t._v(" "),s("p",[t._v("常规多线程场景:")]),t._v(" "),s("ol",[s("li",[t._v("我哥去帮我买豆浆，等豆浆打好。")]),t._v(" "),s("li",[t._v("我姐去帮我买汤面，等汤面做好。")]),t._v(" "),s("li",[t._v("我自己去买油饼，等油饼做好。")])]),t._v(" "),s("p",[t._v("等于是派出了3个人，去做3件事情。每件事情之间没有啥关系，耗费总时间"),s("code",[t._v("以最慢的那个为准")]),t._v("。")]),t._v(" "),s("p",[t._v("我们重点讲讲asyncio做的事情，其实他是有一个event_loop，你可以理解为管理线程中事件的东西没，它帮助我们进行事情的切换。")]),t._v(" "),s("p",[t._v("比如上面说的，"),s("code",[t._v("跟老板说完买豆浆了")]),t._v("，老板在那忙活了，这时候你就该让出资源，切换到下一个事件(去买汤面)，最后豆浆做好了，你怎么知道去拿呢？也是这个event_loop通知你，让你能够回去拿豆浆。")]),t._v(" "),s("p",[t._v("大致原理就是这样，我们还不需要掌握怎么切换事件，我们只需要告诉event_loop，我们的"),s("code",[t._v("买豆浆")]),t._v("是一个异步方法，其中"),s("code",[t._v("等待老板把包子做好的时间")]),t._v("，可以让出资源给其他事件。")]),t._v(" "),s("h3",{attrs:{id:"熟悉async和await"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#熟悉async和await"}},[t._v("#")]),t._v(" 熟悉async和await")]),t._v(" "),s("p",[t._v("当我们给一个方法，加上了"),s("code",[t._v("async")]),t._v("关键字之后，它就变成了一个异步方法，而我们的"),s("code",[t._v("await")]),t._v("关键字，只能在async方法中使用，意思是它"),s("code",[t._v("让出对当前线程的控制权")]),t._v("，可以让线程去执行其他内容。")]),t._v(" "),s("p",[t._v("一般来说我们自己编写的方法，不是在方法前加个"),s("code",[t._v("async")]),t._v("，调用方法的时候加个await就行得通的。比如我们用requests，他里头全是同步方法，我们就算给了async和await也没什么作用，所以我们需要一个"),s("code",[t._v("异步http")]),t._v("请求库。")]),t._v(" "),s("p",[t._v("以上面的例子来说，如果我去油饼摊，老板说不许走，马上就好了。那我就只能留在那边，先老老实实把油饼买了再去下一个地方。")]),t._v(" "),s("p",[t._v("不知道这样说，是不是比较好理解。")]),t._v(" "),s("h3",{attrs:{id:"aiohttp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aiohttp"}},[t._v("#")]),t._v(" aiohttp")]),t._v(" "),s("p",[t._v("aiohttp是一个异步的http框架，你可以把它理解为异步版的"),s("code",[t._v("requests")]),t._v("。我们还有许多这样的库比如"),s("code",[t._v("aiofile")]),t._v("，这些改造后的异步类库，以后会有更多的异步类库出现。")]),t._v(" "),s("p",[t._v("为什么我们要这么麻烦呢？是request不香了吗？其实也不是。Python一直被人诟病执行慢，这点在我上家公司使用时"),s("code",[t._v("深有感触")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"曾经的难题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#曾经的难题"}},[t._v("#")]),t._v(" 曾经的难题")]),t._v(" "),s("p",[t._v("有那么一个需求，当时是从别人的接口里面抓取公司所有服务的数据，并写入到我们本地数据库。大概几千个app，同步一次那是慢的很啊，写伪代码就是:")]),t._v(" "),s("div",{staticClass:"language-Python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"insert into xxx...."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("慢的原因主要是http过程比较耗时，我们在等待响应的时候，其他的任务没有同时进行。")]),t._v(" "),s("p",[t._v("就好像这里有100亩田，就1个人种，等他种完田都猴年马月了。有人会问，你咋不用threading，多开几个线程，也就是多叫几个人，比如叫100个人，一起种，那不就快了吗？")]),t._v(" "),s("p",[t._v("我也想，可是GIL实力不允许啊，虽然我没有亲自这样做，但是结局应该是可以预料的。"),s("code",[t._v("如果有兴趣的话，我以后可能会做这样的测试。")])]),t._v(" "),s("p",[t._v("那么会有人问，那你怎么搞定的？其实我是用了go去调整了代码，用几十个goroutine去完成了这个事情，速度大概快了个几百倍，一小会就"),s("code",[t._v("同步完了")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"试试aiohttp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#试试aiohttp"}},[t._v("#")]),t._v(" 试试aiohttp")]),t._v(" "),s("p",[t._v("想到了上述的难题，又想起自己以后要批量跑用例。所以我不禁神伤，决定尝试一下aiohttp吧。")]),t._v(" "),s("p",[t._v("在此之前，我也只是听过它的大名，并无实际经验。")]),t._v(" "),s("p",[t._v("相关文档: "),s("a",{attrs:{href:"https://docs.aiohttp.org/en/stable/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.aiohttp.org/en/stable/"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628179918880-image.png",alt:"看看demo"}})]),t._v(" "),s("h3",{attrs:{id:"改造之前的httpclient-py"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#改造之前的httpclient-py"}},[t._v("#")]),t._v(" 改造之前的HttpClient.py")]),t._v(" "),s("p",[t._v("我们新建一个文件，叫"),s("code",[t._v("AsyncHttpClient.py")]),t._v("。")]),t._v(" "),s("ul",[s("li",[t._v("编写好构造函数")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628179775768-image.png",alt:""}})]),t._v(" "),s("p",[t._v("和以前几乎一样，多了一个timeout，因为aiohttp的timeout不是int/float类型，而是aiohttp.ClientTimeout.")]),t._v(" "),s("ul",[s("li",[t._v("编写get_cookie方法")])]),t._v(" "),s("div",{staticClass:"language-pYTHON line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cookies "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie_jar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter_cookies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cookies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("通过session中的cookie_jar去获取cookie.")]),t._v(" "),s("ul",[s("li",[t._v("编写获取resp方法")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628180028587-image.png",alt:"当response是json我们给他反序列化为Python对象，否则返回字符串"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("编写collect方法")]),t._v(" "),s("p",[t._v("其实这个方法就是组装了请求的一些数据。")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628180077025-image.png",alt:"和之前的比较类似"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("编写invoke方法")]),t._v(" "),s("p",[t._v("（出于跟风，我在很多rpc框架都看到类似这样的叫法）")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628179853237-image.png",alt:""}})]),t._v(" "),s("p",[t._v("首先用async with获取了一个session，注意这里戴上了Cookie。其他地方没有什么区别，并额外计算了请求时间。")]),t._v(" "),s("h3",{attrs:{id:"如何使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[t._v("#")]),t._v(" 如何使用")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628180151909-image.png",alt:""}})]),t._v(" "),s("p",[t._v("先看看我们http测试这个接口，将方法改为async，request部分改为AsyncRequest，并await invoke返回的内容。")]),t._v(" "),s("h3",{attrs:{id:"试试request请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#试试request请求"}},[t._v("#")]),t._v(" 试试request请求")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628180595677-image.png",alt:"点亮，完美"}})]),t._v(" "),s("h3",{attrs:{id:"小测试代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小测试代码"}},[t._v("#")]),t._v(" 小测试代码")]),t._v(" "),s("div",{staticClass:"language-Python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncio\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" aiohttp\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n\nurl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.baidu.com"')]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchBaidu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" aiohttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClientSession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("encoding"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gather"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fetchBaidu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"花费时间:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    start "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    session "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"花费时间:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# main2()")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br")])]),s("p",[t._v("目前是200次测试，这是aiohttp的速度:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628181122110-image.png",alt:"aiohttp"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-6/1628181145137-image.png",alt:"普通的requests"}})]),t._v(" "),s("p",[t._v("循环太多的话，百度有点"),s("code",[t._v("不开心了")]),t._v("。")]),t._v(" "),s("p",[t._v("今天的内容就分享到这里了，大家可以拿着这个脚本玩玩，试试看，看看aiohttp屌在哪里！")])])}),[],!1,null,null,null);s.default=e.exports}}]);