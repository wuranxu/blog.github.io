(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{578:function(t,_,v){"use strict";v.r(_);var a=v(2),s=Object(a.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("blockquote",[_("p",[t._v("大家好~我是"),_("code",[t._v("米洛")]),t._v("！"),_("br"),_("br"),t._v("\n我在从0到1打造一个开源平台, 也在编写一套完整的"),_("code",[t._v("接口测试平台系列教程")]),t._v("，希望大家能够多多支持。"),_("br"),t._v(" "),_("br"),t._v("\n欢迎关注我的公众号"),_("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),_("h2",{attrs:{id:"上节回顾"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#上节回顾"}},[t._v("#")]),t._v(" 上节回顾")]),t._v(" "),_("p",[t._v("上一节我们稍微撩了一下"),_("code",[t._v("数据驱动")]),t._v("，就马上去写基础Model了，这节我们就来仔细探讨下数据驱动的"),_("code",[t._v("实现想法")]),t._v("。")]),t._v(" "),_("p",[t._v("先简单介绍一下"),_("code",[t._v("数据驱动")]),t._v("的概念，这里笔者找到了维基百科关于数据驱动的定义。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632231846274-image.png",alt:""}})]),t._v(" "),_("p",[t._v("简单阐述一下就是三个特点:")]),t._v(" "),_("ol",[_("li",[_("strong",[t._v("将变化的东西和测试逻辑分离")])])]),t._v(" "),_("p",[t._v("什么意思呢？我们比如在测试用户登录的接口，会制造各种各样的输入条件，这些体现到测试数据上的变化就是用户名/密码的变化，我们需要把测试逻辑（校验是否能够登录成功）和测试数据（诸多账号密码）分开。")]),t._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[t._v("根据测试数据的不同执行不同的测试逻辑")])]),t._v(" "),_("p",[t._v("通过不同的数据，去完成"),_("code",[t._v("多组测试数据")]),t._v("的测试。")]),t._v(" "),_("p",[t._v("以上面的例子来看，我们抽离"),_("code",[t._v("用户登录数据")]),t._v("和具体的输出（登录结果）的校验，数据越多，这样测试覆盖的场景就会越多，即"),_("code",[t._v("覆盖率")]),t._v("会得到提升。但对我们来说，仅仅只是多凑一些数据而已。")]),t._v(" "),_("h3",{attrs:{id:"pity打算怎么做"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#pity打算怎么做"}},[t._v("#")]),t._v(" Pity打算怎么做")]),t._v(" "),_("p",[t._v("pity本来还不想做这块功能，但由于"),_("code",[t._v("环境")]),t._v("各方面的关系，导致不得不提前准备好各个环境的测试数据，一来二去就不得已而为之了。")]),t._v(" "),_("p",[t._v("但"),_("code",[t._v("pity")]),t._v("引入"),_("code",[t._v("数据驱动")]),t._v("也只是一个抛砖引玉的过程，只是支持用例多数据化，用"),_("code",[t._v("相同的测试逻辑")]),t._v("进行测试。")]),t._v(" "),_("p",[t._v("所以简单的讲，笔者只打算让用例支持"),_("code",[t._v("多组数据")]),t._v("，并根据多组数据去运行用例。")]),t._v(" "),_("h2",{attrs:{id:"编写测试数据表的相关接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写测试数据表的相关接口"}},[t._v("#")]),t._v(" 编写测试数据表的相关接口")]),t._v(" "),_("h3",{attrs:{id:"编写测试数据表单"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写测试数据表单"}},[t._v("#")]),t._v(" 编写测试数据表单")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632232473203-image.png",alt:"app/models/schema/testcase_data.py"}})]),t._v(" "),_("p",[t._v("表单接受case_id，name，json_data等参数，目前来看的话我们支持的数据都是以"),_("code",[t._v("JSON")]),t._v("为主，如果后续有文件等内容，我们可以接受"),_("code",[t._v("文件的url")]),t._v("地址进行测试。如果是form的内容，json也可以转换为KEY-VALUE的形式。")]),t._v(" "),_("p",[t._v("所以核心就是: "),_("code",[t._v("json_data")]),t._v("和"),_("code",[t._v("name")]),t._v("，这2块属于一组测试数据，name只是让不同的测试数据有一个"),_("code",[t._v("标识")]),t._v("。")]),t._v(" "),_("h3",{attrs:{id:"编写增改方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写增改方法"}},[t._v("#")]),t._v(" 编写增改方法")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632232685032-image.png",alt:"app/dao/test_case/TestcaseDataDao.py"}})]),t._v(" "),_("p",[t._v("编写新增和修改方法，逻辑基本一致。")]),t._v(" "),_("p",[_("strong",[t._v("新增操作")]),t._v(":")]),t._v(" "),_("ol",[_("li",[t._v("查找对应的数据，有则抛出数据已存在的异常(为了避免重复数据，双重防护，代码层+数据库唯一索引)")]),t._v(" "),_("li",[t._v("如果没有则直接插入")]),t._v(" "),_("li",[t._v("返回新插入的数据，避免二次查询数据列表")])]),t._v(" "),_("p",[_("strong",[t._v("修改操作")]),t._v(":")]),t._v(" "),_("ol",[_("li",[t._v("查找对应的数据，无则抛出"),_("code",[t._v("数据不存在")]),t._v("的异常(这样是为了防止数据已经被删除，而用户仍然在修改的情况)")]),t._v(" "),_("li",[t._v("如果有这条数据则更新之")]),t._v(" "),_("li",[t._v("返回修改后的数据")])]),t._v(" "),_("h3",{attrs:{id:"编写查询方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写查询方法"}},[t._v("#")]),t._v(" 编写查询方法")]),t._v(" "),_("p",[t._v("查询方法我们打算编写2个核心方法:")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("通过case_id查询测试数据")]),t._v(" "),_("p",[t._v("这个方法是给"),_("code",[t._v("页面查询")]),t._v("这个case在不同的环境下的所有测试数据用的。")])]),t._v(" "),_("li",[_("p",[t._v("通过环境查询测试数据")]),t._v(" "),_("p",[t._v("这个是给用例执行时，快速拿到用例对应环境下的测试数据用的。")]),t._v(" "),_("p",[t._v("举个例子，我这时候在测试一个接口，如果以数据驱动的方式，我得快速找到这个接口对应的"),_("code",[t._v("csv或者json文件")]),t._v("，找到了以后还是会转换为"),_("code",[t._v("Python数组")]),t._v("，所以我们大概是这样的过程。")])])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632233106871-image.png",alt:"可以看到，二者的区别只是查询条件不同，前者未传入env，后者传入了env"}})]),t._v(" "),_("p",[t._v("前者返回了一个下图这样的测试数据，后者返回的是对应环境的"),_("code",[t._v("测试数据")]),t._v("列表。")]),t._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v('{"fat": [{"data": "测试数据1"}]}\n')])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br")])]),_("h3",{attrs:{id:"编写删除方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写删除方法"}},[t._v("#")]),t._v(" 编写删除方法")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632233225996-image.png",alt:"删除方法很简单，我们只需要把数据的deleted_at改为当前时间戳即可"}})]),t._v(" "),_("h3",{attrs:{id:"编写接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写接口"}},[t._v("#")]),t._v(" 编写接口")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632233754994-image.png",alt:"这边只有增删改的接口"}})]),t._v(" "),_("p",[t._v("查询接口我们把它放入"),_("code",[t._v("查询用例接口")]),t._v("里面:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632233816696-image.png",alt:"因为用例是一个整体，我们需要对整体进行数据返回，故没有开放专门的查询接口，后续有需要我们可以再放开"}})]),t._v(" "),_("h2",{attrs:{id:"前端改动"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#前端改动"}},[t._v("#")]),t._v(" 前端改动")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632233574356-image.png",alt:""}})]),t._v(" "),_("p",[t._v("前端的改动比较简单，即在用例tab页加入"),_("code",[t._v("数据管理")]),t._v("功能，并在最左侧加上环境tab（根据自己配置的环境），右侧则为对应的"),_("code",[t._v("测试数据表格")]),t._v("。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-21/1632234209348-image.png",alt:""}})]),t._v(" "),_("p",[t._v("关于数据驱动的增删改查编写就到此结束了，由于数据驱动有一些改造，所以下期我们会讲如何适配"),_("code",[t._v("数据驱动")]),t._v("的影响。")])])}),[],!1,null,null,null);_.default=s.exports}}]);