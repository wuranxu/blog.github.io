(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{536:function(t,v,_){"use strict";_.r(v);var e=_(2),a=Object(e.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"测试平台系列-35-编写全局变量管理页面"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#测试平台系列-35-编写全局变量管理页面"}},[t._v("#")]),t._v(" 测试平台系列(35) 编写全局变量管理页面")]),t._v(" "),v("blockquote",[v("p",[t._v("大家好，这里是米洛，一个想和大家一起分享测试开发相关的技术，面试经验和成长经历的博主！")])]),t._v(" "),v("p",[t._v("欢迎大家关注我的公众号: "),v("code",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"回顾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),v("p",[t._v("之前咱们编写了相关的后端接口，现在继续来写"),v("code",[t._v("前端")]),t._v("的页面。我换了个4k显示器，截图可能过于高清，流量党不建议立即观看。")]),t._v(" "),v("p",[v("code",[t._v("这句话是写完了再写的，本篇内容学习指数0颗星，代码比较晦涩，讲解也不够充分，适合回看。")])]),t._v(" "),v("h3",{attrs:{id:"布局"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#布局"}},[t._v("#")]),t._v(" 布局")]),t._v(" "),v("p",[t._v("先思考我们需要的组件:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("需要一个"),v("code",[t._v("环境选择")]),t._v("框，给用户选择当前所在的环境")])]),t._v(" "),v("li",[v("p",[t._v("需要一个"),v("code",[t._v("搜索框")]),t._v("，通过key去搜索对应的变量")])]),t._v(" "),v("li",[v("p",[t._v("需要一个"),v("code",[t._v("添加变量")]),t._v("的按钮")])]),t._v(" "),v("li",[v("p",[t._v("需要一个表格，展示当前的数据内容")]),t._v(" "),v("p",[t._v("对比前面的类似页面，我们新增的只有"),v("code",[t._v("环境选择框")]),t._v("，所以基本页面的样式还是不变，先来一张效果图。")])])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625757398695-image.png",alt:""}})]),t._v(" "),v("p",[t._v("可以看到还是分2栏，在"),v("code",[t._v("添加变量")]),t._v("按钮之前多了个环境选择框和label。")]),t._v(" "),v("h3",{attrs:{id:"开始编写基本的react样式组件-类html"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#开始编写基本的react样式组件-类html"}},[t._v("#")]),t._v(" 开始编写基本的React样式组件(类HTML)")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625757627023-image.png",alt:""}})]),t._v(" "),v("p",[t._v("黄色框和蓝色框分别是2个"),v("code",[t._v("Row")]),t._v("，将页面分割为上下2个部分。上面部分包含3个模块，对应3列:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("占二分之一屏幕宽度label + select 呈现环境选项框")])]),t._v(" "),v("li",[v("p",[t._v("占四分之一屏幕宽度的空列")])]),t._v(" "),v("li",[v("p",[t._v("占四分之一屏幕宽度的列，带一个Input输入框")])])]),t._v(" "),v("p",[t._v("其实大家阅读代码的话，可以把Row看做")]),v("div",[t._v("，Select这种看作小写的"),v("code",[t._v("<select>")]),t._v("，Input也是如此。至于Col，它也是个div，但是他不是占全部宽度的，你设置span属性为6，那就占6/24也就是四分之一的宽度。"),v("p"),t._v(" "),v("p",[t._v("至于下面的Table就更简单了，他一个表格占据了24的宽度，也就是100%的宽度，第二个div要和第一个div有一定高度差距，所以需要"),v("code",[t._v("margin-top: 8px")]),t._v("。")]),t._v(" "),v("p",[t._v("最后那个多出来的没有提及的FormForModal组件，是一个表单组件，用来填写变量信息，默认是隐藏的。")]),t._v(" "),v("h3",{attrs:{id:"编写交互部分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写交互部分"}},[t._v("#")]),t._v(" 编写交互部分")]),t._v(" "),v("p",[t._v("这次我采取了"),v("code",[t._v("dva")]),t._v("管理全局状态，这块内容相对来说比较深奥，对大家来说有点难度。但是如果照着写，就大概能学着写了。")]),t._v(" "),v("p",[t._v("dva分2个模块去管理数据:")]),t._v(" "),v("ul",[v("li",[t._v("models")]),t._v(" "),v("li",[t._v("service")])]),t._v(" "),v("p",[t._v("service目录存放所有和服务端打交道的方法，models以命名空间区分组件的变量，最终实现把组件所有变量搜集到一个大池子里面进行精细化管理。说的可能大家云里雾里，没关系，大概意思就是说，以前我们组件的状态都是在组件里面去"),v("code",[t._v("定义的变量")]),t._v("，但现在我们把它托管给dva，我们调用dva提供的方法去修改/获取这些值，这样不管我的组件嵌套多深，都没关系，我可以随时拿到这个命名空间下面的值。")]),t._v(" "),v("p",[t._v("所以我们需要先编写models里面的内容:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625758459820-image.png",alt:""}})]),t._v(" "),v("p",[t._v("首先导出一个字典，里面namespace定义为"),v("code",[t._v("gconfig")]),t._v("，接着定义state变量，把变量都维护在里面。"),v("code",[t._v("key_type")]),t._v("指的是数值和变量类型的关系。")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("reducers")]),t._v(" "),v("p",[t._v("这个是固定写法，基本上这里面写的方法都是用来更新状态的，也就是更新state里面的内容。")])]),t._v(" "),v("li",[v("p",[t._v("effects")])])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625758652488-image.png",alt:""}})]),t._v(" "),v("p",[t._v("这个是用来编写和后端交互的方法，也是很固定的写法。select可以从当前的状态里面拿到gconfig里面的state，call调用了后端方法，最后我们用put去调用"),v("code",[t._v("reducers")]),t._v("里面写的save方法，将状态更新，也就是更新data，pagination等数据。")]),t._v(" "),v("p",[v("strong",[t._v("这些大家暂时不明白没关系，dva是一种可选择的写法，也是一种状态管理的解决方案。看不明白是很正常的，我当时也是学着写，写了很久我才能不抄代码写出一个demo。")])]),t._v(" "),v("p",[t._v("同样类似地，我们写出其他的几个方法:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759580465-image.png",alt:""}})]),t._v(" "),v("p",[t._v("调用新增接口后，重新获取最新的Gconfig（根据当前的page和搜索选项）")]),t._v(" "),v("p",[t._v("update接口也是如此。")]),t._v(" "),v("h3",{attrs:{id:"完善交互部分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#完善交互部分"}},[t._v("#")]),t._v(" 完善交互部分")]),t._v(" "),v("ul",[v("li",[t._v("为代码编辑器准备语言，不同的语言如JSON和String有不同的效果")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759685499-image.png",alt:""}})]),t._v(" "),v("ul",[v("li",[t._v("编写环境的表格columns")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759746827-image.png",alt:""}})]),t._v(" "),v("p",[t._v("环境列如果是0代表全部环境，否则envMap里面没有的话，代表环境可能被删除了，给个"),v("code",[t._v("红色未知")]),t._v("的Tag展示。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759851433-image.png",alt:""}})]),t._v(" "),v("p",[t._v("操作栏还是一如既往，删除和编辑2个按钮。")]),t._v(" "),v("ul",[v("li",[t._v("fields是表单的字段")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759898588-image.png",alt:""}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-8/1625759979727-image.png",alt:""}})]),t._v(" "),v("ul",[v("li",[t._v("获取环境列表方法和获取变量方法")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760010028-image.png",alt:""}})]),t._v(" "),v("p",[t._v("dispatch代表调用models里面的方法，我现在调用namespace: gconfig下的fetchEnvList方法，拉取所有的环境。")]),t._v(" "),v("p",[t._v("getConfig通过page，size，env，key这4个参数，实现查询变量的功能。")]),t._v(" "),v("ul",[v("li",[t._v("初始化操作")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760117042-image.png",alt:""}})]),t._v(" "),v("p",[t._v("一开始，我们需要获取所有环境和获取当前变量，下面的useEffect，我们接受了第二个参数，一个数组:")]),t._v(" "),v("p",[t._v("意思是"),v("code",[t._v("当分页里面的current，name，当前环境发生变化时，重新获取全局变量")]),t._v("，这个功能很好用。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760248419-image.png",alt:""}})]),t._v(" "),v("p",[t._v("onFinish是表单提交的方法，老客户了。")]),t._v(" "),v("p",[t._v("save是修改state的方法，因为用的比较多，我把它抽成一个独立的方法。")]),t._v(" "),v("p",[t._v("演示一下useEffect的强大:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760317773-image.png",alt:""}})]),t._v(" "),v("p",[t._v("可以看到我们的选择框在变化的时候，只调用了修改currentEnv的方法，"),v("code",[t._v("并没有重新去获取全局变量")]),t._v("。但因为我们设置了useEffect，所以当环境发生变化的时候，我们依然会调用getConfig的方法。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760526725-xx.gif",alt:""}})]),t._v(" "),v("p",[t._v("最后的最后，我们把编写的Gconfig组件给connect起来，这步很难理解，不理解也没关系，反正会抄就行，"),v("code",[t._v("抄下来改改就可以用")]),t._v("。"),v("code",[t._v("其实loading也经过dva做了一层处理，不知道大家发现了没有呢？")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-9/1625760562913-image.png",alt:""}})]),t._v(" "),v("p",[t._v("前端代码仓库: "),v("a",{attrs:{href:"https://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pityWeb"),v("OutboundLink")],1)]),t._v(" "),v("p",[t._v("后端代码仓库: "),v("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=a.exports}}]);