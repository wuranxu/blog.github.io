(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{571:function(t,a,_){"use strict";_.r(a);var s=_(2),v=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好~我是"),a("code",[t._v("米洛")]),t._v("！"),a("br"),t._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的完整"),a("code",[t._v("教程")]),t._v("，希望大家多多支持。"),a("br"),t._v("\n欢迎关注我的公众号"),a("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),a("h2",{attrs:{id:"回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),a("p",[t._v("上节内容我们编写了非常恶心的"),a("code",[t._v("数据驱动")]),t._v("部分，而且有些东西笔者还讲的不清不楚的。接下来我们就来让数据构造器支持sql。")]),t._v(" "),a("p",[t._v("先看看之前的数据构造器:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632561174299-image.png",alt:"画了许多饼，要支持的大概是这么多"}})]),t._v(" "),a("ul",[a("li",[t._v("测试用例")]),t._v(" "),a("li",[t._v("sql")]),t._v(" "),a("li",[t._v("redis")]),t._v(" "),a("li",[t._v("http")]),t._v(" "),a("li",[t._v("python方法")])]),t._v(" "),a("p",[t._v("目前我们还只支持一种呢~所以我们要尽快支持起来，保证造数的"),a("code",[t._v("丰富性")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"sql构造器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql构造器"}},[t._v("#")]),t._v(" SQL构造器")]),t._v(" "),a("p",[t._v("其实sql构造器比较简单，我们之前的文章也已经写好了sql构造器的核心方法，详情可以看"),a("code",[t._v("在线执行sql")]),t._v("的文章。")]),t._v(" "),a("p",[t._v("那我们今天只需要稍微来点改造即可。")]),t._v(" "),a("h4",{attrs:{id:"编写获取sql配置的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写获取sql配置的方法"}},[t._v("#")]),t._v(" 编写获取sql配置的方法")]),t._v(" "),a("p",[t._v("之前我们编写的获取sql配置的方法，都是根据id来获取的，但因为我们存在"),a("code",[t._v("多环境")]),t._v("的情况。举个例子:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("fat")]),t._v(" "),a("th",[t._v("uat")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("id")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("2")])]),t._v(" "),a("tr",[a("td",[t._v("数据库名")]),t._v(" "),a("td",[t._v("blog")]),t._v(" "),a("td",[t._v("blog")])])])]),t._v(" "),a("p",[t._v("这样的数据，名称都是blog，但环境不同导致会有"),a("code",[t._v("多条数据")]),t._v("。我们的用例要支持"),a("code",[t._v("多环境")]),t._v("运行, 如果指定了id为1，那么就不能访问到uat下的blog了。")]),t._v(" "),a("p",[t._v("所以我们打算用环境+数据库名确定一个配置，这样当"),a("code",[t._v("env发生变化")]),t._v("的时候，我们的配置也会跟着变化。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632561378133-image.png",alt:"所以我们编写通过环境和名字查询数据库配置的方法"}})]),t._v(" "),a("h4",{attrs:{id:"编写执行sql的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写执行sql的方法"}},[t._v("#")]),t._v(" 编写执行sql的方法")]),t._v(" "),a("p",[t._v("这里和在线执行有所不同，主要体现在获取配置那块。并且把查询结果序列化为json字符串，方便进行变量替换。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632561714349-image.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"改造执行前置条件方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改造执行前置条件方法"}},[t._v("#")]),t._v(" 改造执行前置条件方法")]),t._v(" "),a("p",[t._v("执行前置条件的时候会判断"),a("code",[t._v("前置条件类型")]),t._v("，如果现在类型为1，说明是sql类型。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632561793591-image.png",alt:""}})]),t._v(" "),a("p",[t._v("我们先反序列化数据，拿到对应的数据库名称配置信息。")]),t._v(" "),a("p",[a("code",[t._v("注意，这里的反序列化是因为我们的前置条件表是用了一个TEXT字段存放所有类型的数据，由于用例和sql数据格式都不一致，所以我们需要反序列化为字典进一步取值。")])]),t._v(" "),a("h2",{attrs:{id:"拿到database-数据库名-和sql-sql语句-接着执行sql-把变量放入变量池。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拿到database-数据库名-和sql-sql语句-接着执行sql-把变量放入变量池。"}},[t._v("#")]),t._v(" 拿到database（数据库名）和sql（sql语句），接着执行sql，把变量放入"),a("code",[t._v("变量池")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"前端部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端部分"}},[t._v("#")]),t._v(" 前端部分")]),t._v(" "),a("p",[t._v("至此，我们后端的改动就完成了。来看看前端的变化:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562016782-image.png",alt:"数据编写页面"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562058732-image.png",alt:"左侧菜单可以切换编辑和调试模式，调试模式则是引入了在线执行sql的页面"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562181826-image.png",alt:"可以看到明显的类型区分"}})]),t._v(" "),a("h3",{attrs:{id:"怎么使用呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么使用呢"}},[t._v("#")]),t._v(" 怎么使用呢")]),t._v(" "),a("p",[t._v("自从改写了"),a("code",[t._v("数据驱动")]),t._v("以后，我们还没有跑过一个完整的例子。接着我们来看看:")]),t._v(" "),a("h4",{attrs:{id:"前置用例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置用例"}},[t._v("#")]),t._v(" 前置用例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562308735-image.png",alt:"先看看前置用例"}})]),t._v(" "),a("p",[t._v("前置用例是一个登录的case，里面的username和password都已经抽离出来，这个值要怎么传给它呢？这个依赖于我们"),a("code",[t._v("数据驱动")]),t._v("里面的数据。")]),t._v(" "),a("h4",{attrs:{id:"前置sql语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置sql语句"}},[t._v("#")]),t._v(" 前置SQL语句")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562590276-image.png",alt:"前置sql里面查询了昵称like name(这个是个变量)的数据"}})]),t._v(" "),a("p",[t._v("为什么要做这步，是为了后面"),a("code",[t._v("断言")]),t._v("的考虑。")]),t._v(" "),a("h4",{attrs:{id:"主体用例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主体用例"}},[t._v("#")]),t._v(" 主体用例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562410924-image.png",alt:""}})]),t._v(" "),a("p",[t._v("主体用例的逻辑一目了然:")]),t._v(" "),a("ol",[a("li",[t._v("替换全局变量，把blog_url变为真实请求地址")]),t._v(" "),a("li",[t._v("执行前置用例->登录case，并把username和password传入")]),t._v(" "),a("li",[t._v("取到前置用例的SESSIONID")]),t._v(" "),a("li",[t._v("执行测试SQL，取到nickname like name的用户信息")]),t._v(" "),a("li",[t._v("请求查询用户接口")]),t._v(" "),a("li",[t._v("断言，看结果是不是和数据库查出来的数量一致")])]),t._v(" "),a("h4",{attrs:{id:"断言部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#断言部分"}},[t._v("#")]),t._v(" 断言部分")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632564102609-image.png",alt:""}})]),t._v(" "),a("p",[t._v("断言里面把sql_data的count（数量）取出来，和response（提前知道返回一个json数组）的数量进行"),a("code",[t._v("长度对比")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"总结一下需要传入的变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结一下需要传入的变量"}},[t._v("#")]),t._v(" 总结一下需要传入的变量")]),t._v(" "),a("ul",[a("li",[t._v("username 登录用户名")]),t._v(" "),a("li",[t._v("password 登录密码")]),t._v(" "),a("li",[t._v("name 查询的用户")])]),t._v(" "),a("h4",{attrs:{id:"看看数据管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#看看数据管理"}},[t._v("#")]),t._v(" 看看数据管理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562779170-image.png",alt:"可以看到这些数据都已经在数据驱动配置好了"}})]),t._v(" "),a("h4",{attrs:{id:"执行用例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行用例"}},[t._v("#")]),t._v(" 执行用例")]),t._v(" "),a("p",[t._v("由于执行这块我们还没彻底修复，只修复了批量执行的，我们去批量执行一下。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562875944-image.png",alt:"这里执行的是指定的fat环境，后续会提供选项选择执行什么环境的case"}})]),t._v(" "),a("p",[t._v("看下报告:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632562973379-image.png",alt:"都报错了，看看日志"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632563026707-image.png",alt:"看看断言信息"}})]),t._v(" "),a("p",[t._v("看了下，断言里面预期结果应该是0，但实际结果有9条。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632563138255-image.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到返回了很多数据，其实我"),a("code",[t._v("查询的")]),t._v("的name是一个我瞎编的，但这个接口还是返回了9条数据，也就是说"),a("code",[t._v("测试失败")]),t._v("了。")]),t._v(" "),a("p",[t._v("我们再看看数据库的执行记录:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632564082229-image.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到变量已经"),a("code",[t._v("灵活转变")]),t._v("了。")]),t._v(" "),a("p",[t._v("再看看脑图部分:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-9-25/1632564251107-image.png",alt:""}})]),t._v(" "),a("p",[t._v("总体来说，"),a("code",[t._v("完整的流程")]),t._v("已经走完了。在参数替换部分，确实出现了一些性能损耗，但没有关系，总体来说还是不算慢的。")]),t._v(" "),a("p",[t._v("今天的内容就分享到这里了，下一节介绍我们刚才没有提到的断言部分: "),a("code",[t._v("长度等于")]),t._v("。")])])}),[],!1,null,null,null);a.default=v.exports}}]);