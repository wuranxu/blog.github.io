(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{537:function(t,a,s){"use strict";s.r(a);var e=s(2),p=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好，我是米洛，一个"),a("code",[t._v("测试开发")]),t._v("博主！")])]),t._v(" "),a("p",[t._v("如果阅读完毕后想和作者有更多交流，可以点击"),a("code",[t._v("阅读原文")]),t._v("找到底部评论区，给作者留言啦！")]),t._v(" "),a("p",[t._v("欢迎大家关注我的公众号: "),a("strong",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),a("p",[t._v("上篇已经编写了"),a("code",[t._v("添加数据构造器")]),t._v("的相关方法，现在我们就来运动到用例中去。")]),t._v(" "),a("h3",{attrs:{id:"编写根据case-id查询所有构造器方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写根据case-id查询所有构造器方法"}},[t._v("#")]),t._v(" 编写根据case_id查询所有构造器方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628004480735-image.png",alt:"这里是为了找出我要运行的case的所有数据构造方法"}})]),t._v(" "),a("h3",{attrs:{id:"编写查找数据构造器方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写查找数据构造器方法"}},[t._v("#")]),t._v(" 编写查找数据构造器方法")]),t._v(" "),a("ul",[a("li",[t._v("ConstructorDao添加static方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628004128293-image.png",alt:""}})]),t._v(" "),a("p",[t._v("不为别的，因为我们如果判断case有数据构造数据，那我们就要获取到这个数据呀！")]),t._v(" "),a("h3",{attrs:{id:"改造executor类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改造executor类"}},[t._v("#")]),t._v(" 改造Executor类")]),t._v(" "),a("ul",[a("li",[t._v("新增解析参数的方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628004534807-image.png",alt:""}})]),t._v(" "),a("p",[t._v("还记得之前我们"),a("code",[t._v("全局变量")]),t._v("替换变量的内容吗？当时是只替换headers，body等内容，其实不太全面。")]),t._v(" "),a("p",[t._v("一个TestCase类，里面有太多字段了。我们取数据以后，每个字段都需要check一遍，所以这里遍历一个testcase的所有字段，去里面挖掘变量，这样会最全面。（"),a("code",[t._v("效率也会比较低")]),t._v("，但是由于我们的数据构造器只告诉了返回，并没告诉具体在哪用，所以这样的过程是有必要的）")]),t._v(" "),a("p",[t._v("这里有个特例，request_header我们本身已经是处理为json字符串了，所以里面的数据天然是字符串，我们不需要进行一次"),a("code",[t._v("序列化")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("尽管装饰器自动生成了不少日志，但是还是不够")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628004825339-image.png",alt:"我们需要可以手动写入日志的功能，于是封装了append方法"}})]),t._v(" "),a("ul",[a("li",[t._v("新增获取构造数据和执行构造数据方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628004889176-image.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到，目前构造器只支持了type == 0也就是测试用例类型。如果是case类型，那么Executor会再次生成一个，去执行用例中的用例，最终拿到result信息，并根据我们设定的"),a("code",[t._v("value")]),t._v("，把case执行的数据全部塞给传递进来的params字典。")]),t._v(" "),a("p",[a("code",[t._v("这个过程就记录了所有构造条件里面的数据，为将来取数据做好了铺垫。")])]),t._v(" "),a("h3",{attrs:{id:"改造run方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改造run方法"}},[t._v("#")]),t._v(" 改造run方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005087701-image.png",alt:""}})]),t._v(" "),a("p",[t._v("新增了3个参数，分别是params_pool，request_param和path。")]),t._v(" "),a("p",[t._v("解释一下:")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("params_pool")]),t._v(" "),a("p",[t._v("这个是总体的全局的数据池，从第一个用例开始积累，所以我们约定，不要填写重复的"),a("code",[t._v("返回值")]),t._v("。")]),t._v(" "),a("p",[t._v("比如构造器1返回变量value1，构造器2返回变量value2，那最终这个params_pool的内容会是:")])])]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" value1返回数据"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" value2返回数据\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[a("p",[t._v("request_param")]),t._v(" "),a("p",[t._v("在上一篇漏掉了个内容，我们有一个动态参数的字段。因为我们用例参数如果写死会很难用，所以我们要让用例动起来，而不是死数据，但又不是"),a("code",[t._v("全局变量")]),t._v("那么刻板。")]),t._v(" "),a("p",[t._v("所以我们需要让用例能接受对应的数据去执行，比如一个登录用例，里面写了用户名是abc，这里我传入我这个场景需要的用户woody就可以达到"),a("code",[t._v("通过参数修改用例的目的")]),t._v("。")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005257058-image.png",alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("path")]),t._v(" "),a("p",[t._v("这个很好理解，我的case路径。比如我是A用例，在执行A的构造条件1->B用例，那么为了不让我凌乱，我会给出一个path:")]),t._v(" "),a("p",[t._v("A->B， 这样就会比较好区分。")]),t._v(" "),a("p",[t._v("再讲讲用例的细节，我们按照step（注释有写）将用例过程拆分，这样思路就很清晰了。")])])]),t._v(" "),a("h3",{attrs:{id:"回到最初的例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回到最初的例子"}},[t._v("#")]),t._v(" 回到最初的例子")]),t._v(" "),a("p",[t._v("我们还是得先登录，再通过JSESSIONID去请求"),a("code",[t._v("获取用户列表接口")]),t._v("的。")]),t._v(" "),a("p",[t._v("我们应该怎么做呢？")]),t._v(" "),a("ol",[a("li",[t._v("编写一个登录用例")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005662204-image.png",alt:"编写用例基本信息"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005684918-image.png",alt:"header信息"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005709167-image.png",alt:"body信息"}})]),t._v(" "),a("p",[t._v("测试一下:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005737828-image.png",alt:"测试成功，能够正常登录"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("把登录用例添加为查询所有用户列表的"),a("code",[t._v("数据构造器")])])]),t._v(" "),a("li",[a("p",[t._v("取数据")])])]),t._v(" "),a("p",[t._v("我们登录后，需要用到cookie里面的JSESSIONID。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628005946978-image.png",alt:""}})]),t._v(" "),a("p",[t._v("注意这里，我们把登录后的变量设置为了"),a("code",[t._v("blog_login")]),t._v("，通过cookies.JSESSIONID拿到对应的数据，并传递给当前用例。")]),t._v(" "),a("p",[t._v("看看效果:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-3/1628006014993-image.png",alt:"成功拿到response"}})]),t._v(" "),a("p",[t._v("由于日志不太友好，后续还得改造。断言也没有添加，还需努力呀！")]),t._v(" "),a("p",[t._v("如果修改或者"),a("code",[t._v("写错")]),t._v("这个变量:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-4/1628006841134-image.png",alt:"故意写错SESSIONID"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-4/1628006816489-image.png",alt:"可以看到变量替换失败了"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-4/1628006880163-image.png",alt:"登录凭证没有获取到，自然就登录失败了！"}})]),t._v(" "),a("p",[t._v("在线演示地址: "),a("a",{attrs:{href:"http://47.112.32.195/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://47.112.32.195/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("前端代码仓库: "),a("a",{attrs:{href:"https://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pityWeb"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("后端代码仓库: "),a("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=p.exports}}]);