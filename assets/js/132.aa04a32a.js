(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{533:function(t,a,v){"use strict";v.r(a);var _=v(2),s=Object(_.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好，这里是米洛，一个想和大家一起分享"),a("code",[t._v("测试开发")]),t._v("相关的技术，面试经验和成长经历的博主！")])]),t._v(" "),a("h2",{attrs:{id:"欢迎大家关注我的公众号-米洛的测开日记。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#欢迎大家关注我的公众号-米洛的测开日记。"}},[t._v("#")]),t._v(" 欢迎大家关注我的公众号: "),a("code",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"背景知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景知识"}},[t._v("#")]),t._v(" 背景知识")]),t._v(" "),a("p",[t._v("目前平台维系了自己的一套用户系统，但是"),a("code",[t._v("有没有觉得每次有新用户都需要手动注册会比较麻烦？")]),t._v("在企业中，如果大家所有系统都用一个账号去登录，会不会十分方便呢？")]),t._v(" "),a("p",[t._v("其实企业内部都会有这样的sso系统，实现一个账号共享所有平台。那我们有什么是比较通用的，大家都有的账号呢？")]),t._v(" "),a("p",[t._v("其实有许多，QQ/微信/支付宝这些基本大家都有。不过考虑到接入的难易程度，我这边选择了支持"),a("code",[t._v("github账号")]),t._v("接入。")]),t._v(" "),a("p",[t._v("如果不了解的话，可以搜索对应的关键词: 单点登录、SSO、OAuth")]),t._v(" "),a("h3",{attrs:{id:"构思"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构思"}},[t._v("#")]),t._v(" 构思")]),t._v(" "),a("p",[t._v("单点登录其实还包括session等部分，但是因为我们只是想"),a("code",[t._v("通过github拿到用户信息")]),t._v("，并不需要它帮我们管理用户登录状态。所以我们接入的话，通过获取"),a("code",[t._v("用户信息")]),t._v("，整合到我们的pity_user表即可。")]),t._v(" "),a("h3",{attrs:{id:"创建oauth-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建oauth-app"}},[t._v("#")]),t._v(" 创建OAuth app")]),t._v(" "),a("p",[t._v("github官方文档: "),a("a",{attrs:{href:"https://docs.github.com/v3/oauth/",title:"https://docs.github.com/v3/oauth/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.github.com/v3/oauth/"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("进入settings")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627092677067-image.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("选择Developer settings")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627092721011-image.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("切换到OAuth app")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627092755389-image.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到，我这里申请了2个，一个是local（本地调试用），另一个是线上地址。")]),t._v(" "),a("ul",[a("li",[t._v("点击New OAuth App")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627092924461-image.png",alt:""}})]),t._v(" "),a("p",[t._v("注册好了之后就可以查看了！")]),t._v(" "),a("ul",[a("li",[t._v("获取ClientID和ClientSecrets")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627093063239-image.png",alt:""}})]),t._v(" "),a("p",[t._v("这2个值记得保存好，"),a("code",[t._v("稍后会用到")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"详细接入流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细接入流程"}},[t._v("#")]),t._v(" 详细接入流程")]),t._v(" "),a("h2",{attrs:{id:"重定向到login页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重定向到login页面"}},[t._v("#")]),t._v(" 重定向到login页面")]),t._v(" "),a("p",[t._v("假设我们的首页是https://www.wqrf.com，我们访问首页的时候，由于"),a("code",[t._v("未登录")]),t._v("，会被重定向到登录页。")]),t._v(" "),a("p",[t._v("我们提供一个按钮或者链接叫: "),a("code",[t._v("用Github登录")]),t._v("，当用户点击这个按钮的时候，我们就跳转到:")]),t._v(" "),a("h2",{attrs:{id:"进入github认证页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入github认证页面"}},[t._v("#")]),t._v(" 进入github认证页面")]),t._v(" "),a("p",[t._v("https://github.com/login/oauth/authorize?client_id="),a("code",[t._v("你申请的clientid")])]),t._v(" "),a("p",[t._v("如果用户连github都没登录，那么这个页面会变成一个github的登录页，否则会变成一个授权页面，问你是不是要登录这个网站，见下图:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627093574732-image.png",alt:"图是未登录github的情况"}})]),t._v(" "),a("h2",{attrs:{id:"通过验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过验证"}},[t._v("#")]),t._v(" 通过验证")]),t._v(" "),a("p",[t._v("登录后Github会根据你的clientId生成一个"),a("code",[t._v("code")]),t._v("，重定向到你的主页并带入code参数:")]),t._v(" "),a("p",[t._v("https://www.wqrf.com?code="),a("code",[t._v("Github生成的code")])]),t._v(" "),a("h2",{attrs:{id:"获取token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取token"}},[t._v("#")]),t._v(" 获取token")]),t._v(" "),a("p",[t._v("接着我们就通过code+clientid+secret去拿到github的token。")]),t._v(" "),a("h2",{attrs:{id:"调用github接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用github接口"}},[t._v("#")]),t._v(" 调用github接口")]),t._v(" "),a("p",[t._v("拿到了之后就可以大摇大摆地调用github的接口"),a("code",[t._v("获取到用户信息")]),t._v("了。")]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("等不及的可以看看具体的github使用文档，虽然是英文的，但是很详细。等得及的，可以看我下一篇"),a("code",[t._v("实操")]),t._v("！")]),t._v(" "),a("p",[a("code",[t._v("github最近打开都很慢，会影响登录效果。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627093997897-github.gif",alt:""}})])])}),[],!1,null,null,null);a.default=s.exports}}]);