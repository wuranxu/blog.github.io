(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{561:function(t,_,v){"use strict";v.r(_);var e=v(2),a=Object(e.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("blockquote",[_("p",[t._v("大家好~我是"),_("code",[t._v("米洛")]),t._v("！"),_("br"),_("br"),t._v("\n我在从0到1打造一个开源平台, 也在编写一套完整的"),_("code",[t._v("接口测试平台系列教程")]),t._v("，希望大家能够多多支持。"),_("br"),t._v(" "),_("br"),t._v("\n欢迎关注我的公众号"),_("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),_("h3",{attrs:{id:"回顾"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),_("p",[t._v("上一篇我们"),_("code",[t._v("开了个小差")]),t._v("，去搞了下编辑器那块。为什么我"),_("code",[t._v("如此重视")]),t._v("编辑器的体验，那是因为后续我们需要用户在页面上补足"),_("code",[t._v("Python或其他脚本")]),t._v("，如果没有一个还算好用的编辑器，那将非常鸡肋。")]),t._v(" "),_("p",[t._v("但之前发现编辑器会略卡，找到了具体的原因: 我们每次在render过程中都会添加"),_("code",[t._v("代码补全")]),t._v("提示，这样是不合理的，所以我们需要对编辑器进行一下改造。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630115243532-image.png",alt:"在DidMount生命周期执行addCompleter方法，由于tables是可变的，所以不用担心自动补全的内容不更新"}})]),t._v(" "),_("h3",{attrs:{id:"思考现在的不足"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#思考现在的不足"}},[t._v("#")]),t._v(" 思考现在的不足")]),t._v(" "),_("p",[t._v("其实现在的情况比较复杂，我们在写用例的时候，必须要先"),_("code",[t._v("进入项目之中")]),t._v("，然后在项目里面找到"),_("code",[t._v("用例列表")]),t._v("tab页。")]),t._v(" "),_("p",[t._v("有没有觉得"),_("code",[t._v("这样不太好")]),t._v("~")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630116254435-image.png",alt:""}})]),t._v(" "),_("p",[t._v("我们如果左侧是目录，右侧是case列表，其实会好很多。而且随着业务的深入，目录分类肯定不能像目前一样"),_("code",[t._v("只有2级")]),t._v("。")]),t._v(" "),_("p",[t._v("不管怎么说，我们先试验一下吧~")]),t._v(" "),_("h3",{attrs:{id:"设计用例目录表"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#设计用例目录表"}},[t._v("#")]),t._v(" 设计用例目录表")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630119231729-image.png",alt:""}})]),t._v(" "),_("p",[t._v("抛开主键，更新/创建时间和用户这样的基础信息之后，其实核心只有3个字段:")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("project_id")]),t._v(" "),_("p",[t._v("我们的目录需要和项目挂钩，这样的话能对"),_("code",[t._v("目录")]),t._v("进行很好的分类，从而达到对case进行归类的目的。")])]),t._v(" "),_("li",[_("p",[t._v("name")]),t._v(" "),_("p",[t._v("目录名称，这个不需要多说了。")])]),t._v(" "),_("li",[_("p",[_("strong",[t._v("parent")])]),t._v(" "),_("p",[t._v("这个是很关键的字段，因为我们的目录是支持嵌套的，目录如果没有父级，那么它就是一个"),_("code",[t._v("根目录")]),t._v("。")]),t._v(" "),_("p",[_("code",[t._v("我们要展示一个树结构，可离不开这玩意儿")])])])]),t._v(" "),_("h3",{attrs:{id:"编写增删改接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写增删改接口"}},[t._v("#")]),t._v(" 编写增删改接口")]),t._v(" "),_("ul",[_("li",[t._v("insert")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630120271513-image.png",alt:"先判断是否有同级并且同项目同名的目录存在"}})]),t._v(" "),_("p",[t._v("有的人可能很疑惑，为什么明明设置了"),_("code",[t._v("唯一索引")]),t._v("，还要去先查询一次数据库呢？其实吧，唯一索引是咱们的兜底方案，是为了控制数据的"),_("code",[t._v("唯一性")]),t._v("。但我们更应该从业务的角度去规避掉重复数据出现的可能，所以有这样一层判断，这也只是"),_("code",[t._v("个人理解")]),t._v("哈。")]),t._v(" "),_("p",[t._v("可以看到代码比较清晰，通过with session.begin在session.add之后自动提交到数据库，完成对"),_("code",[t._v("数据的录入")]),t._v("。")]),t._v(" "),_("p",[t._v("在postman测试一下:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630120473360-image.png",alt:"首次创建"}})]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630120488667-image.png",alt:"再次创建"}})]),t._v(" "),_("ul",[_("li",[t._v("update和delete")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630121282177-image.png",alt:""}})]),t._v(" "),_("p",[t._v("基本上都是老一套，"),_("code",[t._v("这也就是为什么大家都说CRUD BOY很没意思，因为看起来技术含量确实一般。")])]),t._v(" "),_("p",[t._v("接着去完善修改和删除的接口:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630121780785-image.png",alt:"注意delete接口是get请求哦，因为我们只需要一个id即可"}})]),t._v(" "),_("h3",{attrs:{id:"重头戏"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#重头戏"}},[t._v("#")]),t._v(" 重头戏")]),t._v(" "),_("p",[t._v("重点来了，接着是编写获取目录树的接口了~")]),t._v(" "),_("h2",{attrs:{id:"通过project-id获取所有目录"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#通过project-id获取所有目录"}},[t._v("#")]),t._v(" 通过project_id获取所有目录")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630122017602-image.png",alt:"参数是project_id"}})]),t._v(" "),_("p",[t._v("我们需要一次性拿出"),_("code",[t._v("一个项目")]),t._v("下面的所有目录。")]),t._v(" "),_("h2",{attrs:{id:"编写get-testcase-directory-tree方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写get-testcase-directory-tree方法"}},[t._v("#")]),t._v(" 编写get_testcase_directory_tree方法")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630122120881-image.png",alt:""}})]),t._v(" "),_("p",[t._v("这里稍微有点儿复杂，我们一个一个来分析:")]),t._v(" "),_("ol",[_("li",[t._v("通过项目id获取到所有目录树")]),t._v(" "),_("li",[t._v("创建最终返回结果: ans")]),t._v(" "),_("li",[t._v("创建目录id -> 目录的映射关系")]),t._v(" "),_("li",[t._v("创建父目录 -> 子目录的映射，子目录是一个list")]),t._v(" "),_("li",[t._v("遍历获取到的目录，如果parent为空，说明是根目录，我们直接加到ans之中，否则说明他不是根目录，我们拿到他的parent并写入parent_map之中")]),t._v(" "),_("li",[t._v("最后设置id -> directory的映射")])]),t._v(" "),_("p",[t._v("如果一来，我们通过一次遍历拿到了"),_("code",[t._v("所有根目录")]),t._v("，以及"),_("code",[t._v("根目录有哪些孩子")]),t._v("，"),_("code",[t._v("目录id->目录")]),t._v("的3个重要线索。")]),t._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[t._v("遍历ans，把他们的子子孙孙都塞进children列表里去")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630122384674-image.png",alt:""}})]),t._v(" "),_("p",[t._v("来看看get_directory方法，先通过parent_map拿到当前的父目录下面"),_("code",[t._v("是否还有子目录")]),t._v("->current，如果没有，则说明这一层目录已经没有子目录了，可以return了。")]),t._v(" "),_("p",[t._v("如果有的话，遍历current，也就是"),_("code",[t._v("子目录列表")]),t._v("，接着从ans_map拿到子目录的信息，新建child列表，并把当前子目录的信息添加到父目录下面的children，接着递归继续找"),_("code",[t._v("子目录")]),t._v("的"),_("code",[t._v("子目录")]),t._v("。")]),t._v(" "),_("p",[t._v("如此反复，即可生成一棵树。编写获取目录树的接口:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630122631336-image.png",alt:""}})]),t._v(" "),_("h3",{attrs:{id:"看下最终效果"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#看下最终效果"}},[t._v("#")]),t._v(" 看下最终效果")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-28/1630122614174-image.png",alt:"数据量比较少，后续需要放入redis缓存"}})]),t._v(" "),_("p",[t._v("今天的内容就分享到这儿了，有兴趣的朋友们可以一起动手写起来呀！~")]),t._v(" "),_("p",[t._v("在线体验地址: "),_("a",{attrs:{href:"http://test.pity.fun",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://test.pity.fun"),_("OutboundLink")],1)])])}),[],!1,null,null,null);_.default=a.exports}}]);