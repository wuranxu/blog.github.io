(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{553:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("大家好，我是米洛，求三连！求关注"),s("code",[t._v("米洛的测开日记")]),t._v("!")])]),t._v(" "),s("p",[t._v("如果阅读完毕后想和作者有更多交流，可以点击"),s("code",[t._v("阅读原文")]),t._v("找到底部评论区，给作者留言啦！")]),t._v(" "),s("p",[t._v("项目地址: "),s("a",{attrs:{href:"https://pity.readthedocs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pity.readthedocs.io/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),s("p",[t._v("上一节我们说到了去"),s("code",[t._v("并发执行")]),t._v("用例，我们提供了一个async的接口，利用asyncio达到了提升用例执行速度的作用。")]),t._v(" "),s("h2",{attrs:{id:"今天我们就来完善我们的测试报告相关的功能。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#今天我们就来完善我们的测试报告相关的功能。"}},[t._v("#")]),t._v(" 今天我们就来完善我们的"),s("code",[t._v("测试报告")]),t._v("相关的功能。")]),t._v(" "),s("h3",{attrs:{id:"明确目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#明确目标"}},[t._v("#")]),t._v(" 明确目标")]),t._v(" "),s("p",[t._v("目前对我们来说："),s("code",[t._v("最关键的")]),t._v("就是"),s("code",[t._v("用例可以批量执行")]),t._v("。上一步我们已经完善了，那用例可不能只执行不输出。所以我们今天搞定它！")]),t._v(" "),s("p",[t._v("tips: 最近虽然没更文，但是代码写的进步比较超前了，我也有点"),s("code",[t._v("不太适应")]),t._v("现在的模式。")]),t._v(" "),s("p",[t._v("我们把每次用户的"),s("code",[t._v("执行")]),t._v("，算作一次构建，今天要做的就是生成这样的构建数据。")]),t._v(" "),s("h3",{attrs:{id:"站在巨人的肩膀上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#站在巨人的肩膀上"}},[t._v("#")]),t._v(" 站在巨人的肩膀上")]),t._v(" "),s("p",[t._v("以"),s("code",[t._v("jenkins")]),t._v("为例，它的每一次触发都会生成一个"),s("code",[t._v("构建记录")]),t._v("。")]),t._v(" "),s("p",[t._v("我们有好的产品去对比学习，这样我们就会少走很多"),s("code",[t._v("弯路")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629010592851-image.png",alt:""}})]),t._v(" "),s("p",[t._v("以上图为例，jenkins构建的记录都在这里进行展示，大家可以搜索也可以看到具体的"),s("code",[t._v("执行时间")]),t._v("，最重要的是我们知道执行的"),s("code",[t._v("结果")]),t._v("。(红色代表失败了)")]),t._v(" "),s("h3",{attrs:{id:"表设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表设计"}},[t._v("#")]),t._v(" 表设计")]),t._v(" "),s("p",[t._v("表设计是个老话题了，我们还是拆分3个模块:")]),t._v(" "),s("ul",[s("li",[t._v("通用字段(包括主键，创建更新时间，创建人更新人等)")]),t._v(" "),s("li",[t._v("业务字段")]),t._v(" "),s("li",[t._v("预留字段")])]),t._v(" "),s("div",{staticClass:"language-Python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PityReport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    __tablename__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pity_report'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" primary_key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行人 0则为CPU")]),t._v("\n    executor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 环境")]),t._v("\n    env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 花费时间")]),t._v("\n    cost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 测试集合id，预留字段")]),t._v("\n    plan_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始时间")]),t._v("\n    start_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DATETIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结束时间")]),t._v("\n    finished_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DATETIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 成功数量")]),t._v("\n    success_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    error_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    failed_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    skipped_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("INT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行状态")]),t._v("\n    status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SMALLINT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nullable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0: pending, 1: running, 2: stopped, 3: finished"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# case执行模式")]),t._v("\n    mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SMALLINT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" comment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0: 手动, 1: 自动, 2: 测试集, 3: pipeline, 4: 其他"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    deleted_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DATETIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" success_count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" failed_count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                 error_count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" skipped_count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                 plan_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" finished_at"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" datetime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("executor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" executor\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" env\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" datetime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" success_count\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cost\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("failed_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" failed_count\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" error_count\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("skipped_count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" skipped_count\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" status\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mode\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" status\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plan_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plan_id\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finished_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finished_at\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deleted_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br")])]),s("p",[t._v("表里面注释都写的很清楚，我们来简单说下。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("executor")]),t._v(" "),s("p",[t._v("本次构建触发人，可能是人或者系统（system），这里我叫做CPU。")])]),t._v(" "),s("li",[s("p",[t._v("env")]),t._v(" "),s("p",[t._v("构建执行的环境，与环境表对应。")]),t._v(" "),s("p",[t._v("其他的包括，执行耗时，执行成功失败等数量，开始/结束时间，执行模式大家应该都比较清楚。")])])]),t._v(" "),s("h3",{attrs:{id:"报告表的不同之处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#报告表的不同之处"}},[t._v("#")]),t._v(" 报告表的不同之处")]),t._v(" "),s("p",[t._v("报告表和其他数据不一样的地方在于，我们的"),s("code",[t._v("流程")]),t._v("不一样。一次报告很可能是先读到一部分数据：")]),t._v(" "),s("p",[t._v("比如执行人，开始时间等等。到构建完成了以后，我们才能拿到剩下的数据。最后，我们没有"),s("code",[t._v("手动添加")]),t._v("报告这样的诉求，所以我们"),s("code",[t._v("新增报告")]),t._v("的时候要拆分为2个方法。")]),t._v(" "),s("p",[s("code",[t._v("梳理一下整个过程，insert拿到report_id，并记录开始/执行人相关信息，用例飞速运行，结束后把搜集的数据写回到report_id这条数据。")])]),t._v(" "),s("h2",{attrs:{id:"start方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#start方法"}},[t._v("#")]),t._v(" start方法")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629011942649-image.png",alt:"dao/test_case/TestReport.py"}})]),t._v(" "),s("p",[t._v("新建这样的数据，利用"),s("code",[t._v("aiomysql")]),t._v("进行异步操作。把核心数据传入: "),s("code",[t._v("环境")]),t._v("，"),s("code",[t._v("执行人")]),t._v("，"),s("code",[t._v("模式")]),t._v("。因为我们这里目前还只支持手动执行，所以mode一般写死为"),s("code",[t._v("0")]),t._v("。")]),t._v(" "),s("p",[t._v("其实代码没啥难度，理解就好。简单的说就是新插入一条数据，但是不是"),s("code",[t._v("完整")]),t._v("的数据。")]),t._v(" "),s("h3",{attrs:{id:"update方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#update方法"}},[t._v("#")]),t._v(" update方法")]),t._v(" "),s("p",[t._v("在执行过程中，可能需要修改构建的状态。比如我们构建如果被用户"),s("code",[t._v("手动停止")]),t._v("了，我们需要把报告状态改为"),s("code",[t._v("已停止")]),t._v("，所以这边有个update的方法，一般是用来修改状态的。如果后续还有其他的数据要修改，也可以"),s("code",[t._v("调整一下这个方法")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629012213737-image.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"end方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#end方法"}},[t._v("#")]),t._v(" end方法")]),t._v(" "),s("p",[t._v("当用例结束之后，我们把搜集到的所有数据都回写到这条数据中。利用mysql主键的特性，保证我们每次新增的id都是唯一的，所以数据"),s("code",[t._v("并不会串")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629012274123-image.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"新增并发执行用例方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增并发执行用例方法"}},[t._v("#")]),t._v(" 新增并发执行用例方法")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629012470320-image.png",alt:"新增run_multiple方法"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-15/1629013052388-image.png",alt:"接口实现"}})]),t._v(" "),s("p",[t._v("在Executor类下面编写静态方法: "),s("code",[t._v("run_multiple")]),t._v("。")]),t._v(" "),s("p",[t._v("具体的并发过程和之前差不多，注释已经写的很清楚了，从step1到step5.其他无非是一些获取用例"),s("code",[t._v("执行数据")]),t._v("的信息。")]),t._v(" "),s("p",[t._v("最后为啥需要返回report_id呢，因为前端页面通过report_id可自动到达报告页面。")]),t._v(" "),s("p",[t._v("想象一下:")]),t._v(" "),s("h2",{attrs:{id:"前端通过访问-report-4就可以拿到对应报告的数据-那就打通了整个执行-报告的过程-虽然目前还没有自动执行那一步。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端通过访问-report-4就可以拿到对应报告的数据-那就打通了整个执行-报告的过程-虽然目前还没有自动执行那一步。"}},[t._v("#")]),t._v(" 前端通过访问: "),s("code",[t._v("/report/4")]),t._v("就可以拿到对应报告的数据，那就打通了整个执行->报告的过程，虽然目前还没有"),s("code",[t._v("自动执行那一步")]),t._v("。")]),t._v(" "),s("p",[t._v("今天的内容就到这里结束了，下一篇讲编写构建历史页面，类似于jenkins"),s("code",[t._v("左侧构建记录")]),t._v("。")])])}),[],!1,null,null,null);s.default=e.exports}}]);