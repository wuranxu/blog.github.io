(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{486:function(e,t,_){"use strict";_.r(t);var v=_(2),a=Object(v.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("blockquote",[t("p",[e._v("大家好~我是"),t("code",[e._v("米洛")]),e._v("！"),t("br"),e._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的"),t("code",[e._v("教程")]),e._v("，希望大家多多支持。"),t("br"),e._v("\n欢迎关注我的公众号"),t("code",[e._v("米洛的测开日记")]),e._v("，一起交流学习!")])]),e._v(" "),t("h3",{attrs:{id:"回顾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[e._v("#")]),e._v(" 回顾")]),e._v(" "),t("p",[e._v("上一节我们编写了"),t("code",[e._v("接口")]),e._v("，也就是一次性"),t("code",[e._v("插入")]),e._v("全部用例数据的接口。但只是后端有了对应的改造，那前端我们还是得动手的。")]),e._v(" "),t("p",[e._v("由于前端比较复杂，我这就只说一些思路吧，当然不可否认的是，在这个过程中前端代码已经"),t("code",[e._v("烂透了")]),e._v("。有一种屎山堆屎的感觉，但，凑合改改吧，一定要把机会留给下次。")]),e._v(" "),t("p",[e._v("下次一定~~~")]),e._v(" "),t("h3",{attrs:{id:"改造前端思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#改造前端思路"}},[e._v("#")]),e._v(" 改造前端思路")]),e._v(" "),t("p",[e._v("改造前端，首先我们的前端是由"),t("code",[e._v("TestCaseComponent")]),e._v("组件+TestCaseBottom等组件组成，以前的逻辑是，在TestCaseComponent里面通过一个参数，判断是"),t("code",[e._v("添加")]),e._v("还是"),t("code",[e._v("编辑")]),e._v("模式，但现在不一样了，我们可以单独抽出一个组件，比如叫"),t("code",[e._v("AddTestCaseComponent.jsx")]),e._v("。里面只需要处理添加的逻辑即可，但由于大部分组件还是抄的"),t("code",[e._v("TestCaseComponent")]),e._v("，所以其实"),t("code",[e._v("代码重复率")]),e._v("较高，不过由于时间关系，秉着"),t("code",[e._v("能用就行")]),e._v("的朴实观点，我们先暂时copy一份，并精简之。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/10bd5ff3-d936-480e-bdd9-34e15164e918.png",alt:""}})]),e._v(" "),t("p",[e._v("接着的4个tab，可就比较繁琐了。我们需要为这些组件准备一个createMode的字段，默认为"),t("code",[e._v("false")]),e._v("。如果为true，我们则需要走不同的逻辑。来看看之前的逻辑:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("测试数据")]),e._v(" "),t("ol",[t("li",[e._v("添加:")])]),e._v(" "),t("p",[e._v("添加时绑定case_id，并且把测试数据加到case_id上。那编辑模式的时候呢？我们只能临时缓存一份测试数据（是不带case_id的，因为case还没创建)")]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[e._v("编辑:")])]),e._v(" "),t("p",[e._v("编辑的话，原先是根据id进行修改，现在由于测试数据没有入库，所以只能根据数组的索引来修改，非常难受，但也没办法。")]),e._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[e._v("删除:")])]),e._v(" "),t("p",[e._v("原先需要直接根据id删除，现在需要删除临时数据里对应的数据。")]),e._v(" "),t("p",[e._v("有了测试数据的经验，我想其他的断言/前后置条件遇到的问题也就"),t("code",[e._v("迎刃而解")]),e._v("了。那最后我们会把所有的数据统一汇总，制造出我们需要的模板:")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/a05fc7cc-b093-44c1-89ab-d037445044bf.png",alt:""}})]),e._v(" "),t("p",[e._v("然后拼凑参数，发送给后端即可。")]),e._v(" "),t("h3",{attrs:{id:"关于调试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于调试"}},[e._v("#")]),e._v(" 关于调试")]),e._v(" "),t("p",[e._v("调试功能比较复杂，是根据所有未落库的数据执行case，这个需要"),t("code",[e._v("后端")]),e._v("支持。暂时我们能够新增即可，未来的调试还会支持变量的替换，肯定是要做的。")]),e._v(" "),t("h3",{attrs:{id:"关于改动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于改动"}},[e._v("#")]),e._v(" 关于改动")]),e._v(" "),t("p",[e._v("改动的地方很多很复杂，说实话我的"),t("code",[e._v("心很乱")]),e._v("。为了方便，大家就去github对照改动看个究竟吧。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/wuranxu/pityWeb/commit/a19686bfeb91820d830e12543e98132ce2f5df5c",target:"_blank",rel:"noopener noreferrer"}},[e._v("改动详情"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("当然，改的越多（bug越多），dddd，遇到可以及时留言或者提issue，感激不尽~")]),e._v(" "),t("h3",{attrs:{id:"串联起来"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#串联起来"}},[e._v("#")]),e._v(" 串联起来")]),e._v(" "),t("p",[e._v("在做了一些调整以后，我们把整体串联起来，就写个简单的case吧:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/d65cecf0-1628-45fe-b636-9ec8b8b303ac.gif",alt:""}})]),e._v(" "),t("p",[e._v("可以看到，速度还阔以，我们进去case编辑看看:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/01b42dcb-c761-4d2e-b9cc-16ea2c359f92.png",alt:""}})]),e._v(" "),t("p",[e._v("基本没差，那就说明我们的"),t("code",[e._v("合并")]),e._v("提交奏效了。感兴趣的朋友可以去github看看改造，说实话不太建议看，实在是shit一坨。= =")]),e._v(" "),t("h3",{attrs:{id:"修复bug"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修复bug"}},[e._v("#")]),e._v(" 修复bug")]),e._v(" "),t("p",[e._v("在编码过程中，仍然发现不少bug，我们来一个个处理:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("无法批量删除case的bug")]),e._v(" "),t("p",[e._v("原因: case如果有测试数据的话，测试数据表是没有填写__fields__等字段的，导致没获取到对应字段的改动，所以我们加上即可。")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/574c3b57-f9f1-437b-add6-33dbbc8f0a8b.png",alt:""}})]),e._v(" "),t("ul",[t("li",[t("p",[e._v("批量删除不同步，没有做事务处理")]),e._v(" "),t("p",[e._v("看看之前的批量删除case:")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/aa5fb642-94ae-4c14-b488-76914ecad49f.png",alt:""}})]),e._v(" "),t("p",[e._v("因为删除测试数据的时候失败了，就导致case虽然删除了，但是"),t("code",[e._v("测试数据")]),e._v("没删除（怪尴尬的），所以我们还是采用事务的方式:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/41b74ab6-5abd-4514-9991-f0138814f375.png",alt:""}})]),e._v(" "),t("p",[e._v("先调整批量删除的方法，再改写删除部分:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/b2c4cd37-a4aa-442e-a062-5ff6c23cf2aa.png",alt:""}})]),e._v(" "),t("ul",[t("li",[e._v("如果python方法执行的时候没有返回值，报错的bug")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://files.mdnice.com/user/11504/d2854e89-0126-4954-910c-bdd3ddafb1ac.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"这里用-get替代了-取key-value-好处是没有设置返回值的时候不会因为key-error导致case执行失败。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#这里用-get替代了-取key-value-好处是没有设置返回值的时候不会因为key-error导致case执行失败。"}},[e._v("#")]),e._v(" 这里用.get替代了[]取key-value，好处是没有设置"),t("code",[e._v("返回值")]),e._v("的时候不会因为key error导致case执行失败。")]),e._v(" "),t("p",[e._v("今天的内容就到这里啦，下一节是什么，暂时还不知道。")])])}),[],!1,null,null,null);t.default=a.exports}}]);