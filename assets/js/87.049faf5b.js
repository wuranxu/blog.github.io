(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{499:function(t,a,s){"use strict";s.r(a);var v=s(2),_=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("大家好~我是"),a("code",[t._v("米洛")]),t._v("！"),a("br"),t._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的"),a("code",[t._v("教程")]),t._v("，希望大家多多支持。"),a("br"),t._v("\n欢迎关注我的公众号"),a("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),a("h3",{attrs:{id:"回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),a("p",[t._v("上一节我们成功"),a("code",[t._v("录制")]),t._v("了接口请求，俗话说: "),a("code",[t._v("温故而知新")]),t._v("。还记得我们之前用JSONPath重构过我们的"),a("code",[t._v("出参数据")]),t._v("吗？")]),t._v(" "),a("p",[t._v("没错，我们今天要继续把JSONPath发挥到项目中.")]),t._v(" "),a("h3",{attrs:{id:"断言中的路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#断言中的路径"}},[t._v("#")]),t._v(" 断言中的路径")]),t._v(" "),a("p",[t._v("在接口测试中，断言经常需要展示JSON的具体节点(断言为什么不一致，所以需要展示完整路径)，来看看我们目前是怎么做的:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610202018.png",alt:""}})]),t._v(" "),a("p",[t._v("可以看到，断言效果"),a("code",[t._v("一塌糊涂")]),t._v("，"),a("code",[t._v("/0")]),t._v("这种显示方式，和我们之前的"),a("code",[t._v("取参")]),t._v("/"),a("code",[t._v("JSONPath")]),t._v("格格不入，那如果是这样的形式呢?")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 在预期结果中不存在 ❌\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("虽然看起来没有好很多，但是实际上，我们统一了"),a("code",[t._v("路径")]),t._v("显示法则。这个举动的意义在pity中不亚于秦国统一度量衡。")]),t._v(" "),a("h3",{attrs:{id:"改造"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改造"}},[t._v("#")]),t._v(" 改造")]),t._v(" "),a("p",[t._v("我们进入app/utils/json_compare.py文件，首页我们要调整开始路径，从"),a("code",[t._v("/")]),t._v("改为"),a("code",[t._v("$")]),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610202924.png",alt:""}})]),t._v(" "),a("p",[t._v("这样的话，起始路径就满足了JSONPath。")]),t._v(" "),a("p",[t._v("接着我们在每次"),a("code",[t._v("断言失败")]),t._v("后都加入一个标志: 【❌】，红色比较显眼，能一眼看到是错误。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610203051.png",alt:""}})]),t._v(" "),a("p",[t._v("类似于上图这样。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610203124.png",alt:""}})]),t._v(" "),a("p",[t._v("接着我们把用/连接2个路径的代码，改成"),a("code",[t._v(".")]),t._v("，也别忘了断言失败后加【❌】哦。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610203233.png",alt:""}})]),t._v(" "),a("p",[t._v("而数组我们一般在JSONPath里面用[数组索引]表示，所以我们把/0需要改成[0]")]),t._v(" "),a("p",[t._v("顺手，我们也把其他断言比如"),a("code",[t._v("等于")]),t._v(", "),a("code",[t._v("不等于")]),t._v("给改改（在末尾加标识）")]),t._v(" "),a("h3",{attrs:{id:"来看看最后的效果图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#来看看最后的效果图"}},[t._v("#")]),t._v(" 来看看最后的效果图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610204323.png",alt:""}})]),t._v(" "),a("p",[t._v("先不谈论效果是否比之前好，还是那句话，这是很有意义的一件事。")]),t._v(" "),a("h3",{attrs:{id:"为mock配置http代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为mock配置http代理"}},[t._v("#")]),t._v(" 为Mock配置HTTP代理")]),t._v(" "),a("p",[t._v("我们知道，后续如果要做Mock功能的话，就需要经过一层mitmproxy"),a("code",[t._v("代理")]),t._v("。所以我们需要改造我们的http客户端:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610205708.png",alt:""}})]),t._v(" "),a("p",[t._v("我们首先根据是否开启了Mock设置代理的地址，接着在request的时候带入这个proxy参数即可。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.pity.fun/picture/20220610205823.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"这个效果就和我们windows机器开启代理-aiohttp的http请求都会经常这层代理-也就能为mock做铺垫了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这个效果就和我们windows机器开启代理-aiohttp的http请求都会经常这层代理-也就能为mock做铺垫了"}},[t._v("#")]),t._v(" 这个效果就和我们windows机器开启代理，aiohttp的http请求都会经常这层代理，也就能为mock做铺垫了~")]),t._v(" "),a("p",[t._v("今天的内容就介绍到这里，下一节我们来编写har转pity用例相关部分，我们会分2步，先将har转换为RequestInfo数组，后面就是通用的部分：")]),t._v(" "),a("p",[t._v("将一组RequestInfo转为pity用例（这块会复杂一些），加油~")])])}),[],!1,null,null,null);a.default=_.exports}}]);