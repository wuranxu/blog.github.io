(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{543:function(t,e,_){"use strict";_.r(e);var r=_(2),v=Object(r.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"测试平台系列-38-接入github第三方登录-下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试平台系列-38-接入github第三方登录-下"}},[t._v("#")]),t._v(" 测试平台系列(38) 接入github第三方登录(下)")]),t._v(" "),e("blockquote",[e("p",[t._v("大家好，这里是米洛，一个想和大家一起分享"),e("code",[t._v("测试开发")]),t._v("相关的技术，面试经验和成长经历的博主！")])]),t._v(" "),e("h2",{attrs:{id:"欢迎大家关注我的公众号-米洛的测开日记。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#欢迎大家关注我的公众号-米洛的测开日记。"}},[t._v("#")]),t._v(" 欢迎大家关注我的公众号: "),e("code",[t._v("米洛的测开日记")]),t._v("。")]),t._v(" "),e("p",[t._v("上篇我们想好了具体的思路，这篇就来实现之。")]),t._v(" "),e("h3",{attrs:{id:"实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),e("p",[t._v("其实后端要做的部分很简单，只需要完成后面2步即可，即生成token和获取用户信息。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("编写register_for_github方法")]),t._v(" "),e("p",[t._v("当从github获取到用户信息以后，写入我们自己的用户表，如果有则更新用户信息，如果没有则新增一条记录。")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627108184550-image.png",alt:""}})]),t._v(" "),e("p",[t._v("先查询到email和username都匹配的用户，如果有，我们就更新用户的昵称和头像字段，并更新他的"),e("code",[t._v("最后登录时间")]),t._v("。")]),t._v(" "),e("p",[t._v("如果没有该用户，我们就新生成一个"),e("code",[t._v("用户")]),t._v("。这里随机了几位数字加盐，保证用户的密码是随机的，如果通过github登录的用户，"),e("code",[t._v("基本上不太容易试出他在测试平台用户表的密码")]),t._v("。")]),t._v(" "),e("ul",[e("li",[t._v("编写github登录接口")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627108689354-image.png",alt:""}})]),t._v(" "),e("p",[t._v("请求参数为code，这里用到了requests的Session类，因为此处需要发送2次http请求。")]),t._v(" "),e("ol",[e("li",[t._v("获取access_token")])]),t._v(" "),e("p",[t._v("url: https://github.com/login/oauth/access_token")]),t._v(" "),e("p",[t._v("method: GET/POST都可以")]),t._v(" "),e("p",[t._v("参数: code，clientid和secret，也就是前文要求记录的2个字段")]),t._v(" "),e("p",[t._v("返回数据是这样的:")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627109241501-image.png",alt:""}})]),t._v(" "),e("p",[t._v("一串很普通的文本，我们需要从里面拿到"),e("code",[t._v("access_token")]),t._v("。")]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("获取用户信息")])]),t._v(" "),e("p",[t._v("url: https://api.github.com/user")]),t._v(" "),e("p",[t._v("method: GET")]),t._v(" "),e("p",[t._v('headers: {"Authrozation": "token '),e("code",[t._v("刚才生成的token")]),t._v('"}')]),t._v(" "),e("p",[t._v("这样就能拿到用户信息了:")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://static.pity.fun/picture/2021-7-24/1627109186280-image.png",alt:""}})]),t._v(" "),e("p",[t._v("可以看到里面有login(登录名)，email(邮箱)，name(昵称)，其他有用的信息我们可以取"),e("code",[t._v("avatar_url")]),t._v("，方便我们能直接拿对方的头像来展示。")]),t._v(" "),e("h3",{attrs:{id:"前端部分"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端部分"}},[t._v("#")]),t._v(" 前端部分")]),t._v(" "),e("p",[t._v("前端部分我已经实现了，大概思路是提供"),e("code",[t._v("github登录的按钮")]),t._v("，当用户进入页面的时候判断url里面是否包含"),e("code",[t._v("?code=")]),t._v(", 如果有则说明是github登录成功后的回调事件，再将code解析后调用上面编写的login接口，其他逻辑与普通用户登录一致。")]),t._v(" "),e("p",[t._v("大家有兴趣可以研究下具体的实现，写的比较糙，可以通过"),e("code",[t._v("提交记录")]),t._v("来看到对应的改动~")]),t._v(" "),e("p",[t._v("github提速可以参考这个，亲测有效:")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/107334179",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zhuanlan.zhihu.com/p/107334179"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("在线演示地址: "),e("a",{attrs:{href:"http://47.112.32.195/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://47.112.32.195/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("前端代码仓库: "),e("a",{attrs:{href:"https://github.com/wuranxu/pityWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pityWeb"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("后端代码仓库: "),e("a",{attrs:{href:"https://github.com/wuranxu/pity",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wuranxu/pity"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=v.exports}}]);