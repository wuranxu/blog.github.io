(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{547:function(_,v,t){"use strict";t.r(v);var e=t(2),a=Object(e.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("blockquote",[v("p",[_._v("大家好~我是"),v("code",[_._v("米洛")]),_._v("！"),v("br"),v("br"),_._v("\n这是一个完整的"),v("code",[_._v("接口测试平台系列教程")]),_._v("，希望能和大家一起学习，从0到1打造一个开源平台。"),v("br"),_._v(" "),v("br"),_._v("\n欢迎关注我的公众号"),v("code",[_._v("米洛的测开日记")]),_._v("，获取最新文章教程!")])]),_._v(" "),v("h3",{attrs:{id:"回顾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[_._v("#")]),_._v(" 回顾")]),_._v(" "),v("p",[_._v("上一篇我们已经"),v("code",[_._v("基本结束")]),_._v("了对测试报告相关的处理工作，其实博主最近在考虑怎么去优化用例编写/运行相关的地方，因为发现之前写的过于辣鸡了，用例还是不能"),v("code",[_._v("完全依附")]),_._v("于项目，得有自己的生存之道呀！")]),_._v(" "),v("h2",{attrs:{id:"于是我决定把项目和用例在页面上进行拆分-但是仍然保持树的形式。目前还没有想到很好的ui展示效果-想到的话也得周末花时间去做了-所以我们先做数据库相关的数据构造器工作。"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#于是我决定把项目和用例在页面上进行拆分-但是仍然保持树的形式。目前还没有想到很好的ui展示效果-想到的话也得周末花时间去做了-所以我们先做数据库相关的数据构造器工作。"}},[_._v("#")]),_._v(" 于是我决定把"),v("code",[_._v("项目")]),_._v("和用例在页面上进行拆分，但是仍然保持树的形式。目前还没有想到很好的UI展示效果，想到的话也得周末花时间去做了，所以我们先做数据库相关的"),v("code",[_._v("数据构造器")]),_._v("工作。")]),_._v(" "),v("h3",{attrs:{id:"为什么要做这块"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#为什么要做这块"}},[_._v("#")]),_._v(" 为什么要做这块？")]),_._v(" "),v("p",[_._v("我们知道，在接口测试中，经常要拿数据库的数据进行"),v("code",[_._v("断言操作")]),_._v("或者"),v("code",[_._v("查询数据")]),_._v("，可能有一些同学不会去db里面进行校验，这个争议咱们先不管，但我是支持去db里面校验数据的。")]),_._v(" "),v("p",[_._v("那么操作db，就得有db的一些连接信息。因为本人从未用过Oracle，所以很礼貌地拒绝支持"),v("code",[_._v("Oracle")]),_._v("。")]),_._v(" "),v("p",[_._v("选定好常见的关系型数据库: Mysql+Postgresql即可。我们不但有sql，还会支持"),v("code",[_._v("Redis")]),_._v("。")]),_._v(" "),v("h3",{attrs:{id:"本节内容"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#本节内容"}},[_._v("#")]),_._v(" 本节内容")]),_._v(" "),v("ul",[v("li",[_._v("设计好数据表存放的核心信息")]),_._v(" "),v("li",[_._v("完成数据库配置的"),v("code",[_._v("增删改查")]),_._v("功能")])]),_._v(" "),v("h2",{attrs:{id:"设计数据库配置表"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#设计数据库配置表"}},[_._v("#")]),_._v(" 设计数据库配置表")]),_._v(" "),v("p",[_._v("首先给它取个名字: "),v("code",[_._v("pity_database_info")]),_._v("，一目了然可以知道它是数据库配置相关的表。")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("id")])]),_._v(" "),v("li",[v("p",[v("code",[_._v("env")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("sql_type")]),_._v(" (数据库类型, 0: mysql 1:postgres)")])]),_._v(" "),v("li",[v("p",[v("code",[_._v("name")]),_._v("(数据库配置的名称，比如: 订单表)")])]),_._v(" "),v("li",[v("p",[v("code",[_._v("host")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("port")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("username")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("password")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("database")])])]),_._v(" "),v("li",[v("p",[_._v("create_user")])]),_._v(" "),v("li",[v("p",[_._v("update_user")])]),_._v(" "),v("li",[v("p",[_._v("created_at")])]),_._v(" "),v("li",[v("p",[_._v("updated_at")])]),_._v(" "),v("li",[v("p",[_._v("deleted_at")]),_._v(" "),v("p",[_._v("基本上我们通过host:port/database@username:password就可以连接上咱们的数据库，能连上了，咱们还怕操作不了数据库吗？")])])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629387521588-image.png",alt:"最终代码如图，可以看到字段定义一目了然"}})]),_._v(" "),v("h3",{attrs:{id:"编写dbconfigdao-py"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写dbconfigdao-py"}},[_._v("#")]),_._v(" 编写DbConfigDao.py")]),_._v(" "),v("p",[_._v("首先编写"),v("code",[_._v("查询功能")]),_._v("，我们可以根据"),v("code",[_._v("env环境")]),_._v(","),v("code",[_._v("name别名")]),_._v(","),v("code",[_._v("database数据库名")]),_._v("3个维度来查询，至于后续需不需要host，待定，要加也很方便。")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629387638412-image.png",alt:"代码如图所示"}})]),_._v(" "),v("p",[_._v("注意，不论是我们从"),v("code",[_._v("Flask")]),_._v("切换到了"),v("code",[_._v("FastApi")]),_._v("，还是我们从同步切换到"),v("code",[_._v("异步")]),_._v("，确实都需要一个过程。但大家也不要惊慌，其实对我们来说，异步是一个"),v("code",[_._v("提速")]),_._v("的过程。")]),_._v(" "),v("p",[_._v("重点是掌握async/await的写法，去掉这2个关键字之后，有没有发现异步和同步代码基本一致？所以，我们要克服一下，未来异步必定是"),v("code",[_._v("Python")]),_._v("的趋势。")]),_._v(" "),v("p",[_._v("query是咱们的查询条件，当name存在，就以它为查询条件。简单解释下: "),v("code",[_._v("if name")])]),_._v(" "),v("p",[_._v("在Python里面，如果if后的对象不是bool对象的话，会自动进行"),v("code",[_._v("转义")]),_._v("，包括while也是。")]),_._v(" "),v("p",[_._v("比如大家熟悉的"),v("code",[_._v("while 1:")]),_._v(",之所以能一直循环下去，是因为1被转义为了True，效果等同于"),v("code",[_._v("while True:")]),_._v("，这样判断"),v("code",[_._v("比较简洁")]),_._v("，但存在一些"),v("code",[_._v("陷阱")]),_._v("。")]),_._v(" "),v("p",[_._v("接着说这个功能，选择好对象的查询条件了之后，我们就调用session.execute方法，查找出数据，最后返回。")]),_._v(" "),v("p",[_._v("如果遇到"),v("code",[_._v("异常")]),_._v("，我们直接抛出，给router处理。")]),_._v(" "),v("h2",{attrs:{id:"编写新增-删除-修改功能"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写新增-删除-修改功能"}},[_._v("#")]),_._v(" 编写新增/删除/修改功能")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388069578-image.png",alt:"新增/编辑"}})]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388081538-image.png",alt:"删除"}})]),_._v(" "),v("p",[_._v("其实要注意的点是，我们使用了"),v("code",[_._v("async with session.begin()")]),_._v("，并在代码块里面继续操作。")]),_._v(" "),v("p",[_._v("这里"),v("code",[_._v("博主")]),_._v("还没有完全去研究，只是知道需要这么使用，大胆揣测一下是因为with...begin方法结束后会"),v("code",[_._v("自动提交")]),_._v("数据库的变更，但不确定是不是这样，有兴趣的朋友可以去研究下。")]),_._v(" "),v("h3",{attrs:{id:"编写router"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编写router"}},[_._v("#")]),_._v(" 编写Router")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388235059-image.png",alt:"router层比较简单，基本就是调用dao层方法即可，只需要包装下try catch"}})]),_._v(" "),v("p",[_._v("这边我封装了专门的Response，这样以后就不需要一直手写"),v("code",[_._v('dict(code=0,msg="success")')]),_._v("这样的返回了。")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388297995-image.png",alt:"具体实现"}})]),_._v(" "),v("h3",{attrs:{id:"测试一下"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#测试一下"}},[_._v("#")]),_._v(" 测试一下")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388327640-image.png",alt:"查询/新增/编辑/删除都没问题"}})]),_._v(" "),v("p",[_._v("后端这块内容并没有结束，目前我们只是能够把数据库配置管理起来，还达不到使用的效果。")]),_._v(" "),v("p",[v("code",[_._v("下一篇")]),_._v("将介绍如何"),v("code",[_._v("在线执行SQL并返回")]),_._v("，并用于case数据构造器之中。篇幅可能会比较长，而我也需要做一部分"),v("code",[_._v("前端")]),_._v("的内容。")]),_._v(" "),v("h2",{attrs:{id:""}},[v("a",{staticClass:"header-anchor",attrs:{href:"#"}},[_._v("#")]),_._v(" "),v("img",{attrs:{src:"https://static.pity.fun/picture/2021-8-19/1629388463418-image.png",alt:"对应的数据库配置页面会在这儿，只有super idol有权限"}})]),_._v(" "),v("p",[_._v("今天的内容到这儿就结束啦，感谢大家的"),v("code",[_._v("观看")]),_._v("。如果大家感兴趣的话，可以和我一起敲起来。我也会尽快给一个"),v("code",[_._v("可用的版本")]),_._v("。")]),_._v(" "),v("p",[_._v("最后，感谢"),v("code",[_._v("测试开发干货")]),_._v("的支持，"),v("code",[_._v("饭佬牛逼，热饭神教牛逼")]),_._v("！")])])}),[],!1,null,null,null);v.default=a.exports}}]);