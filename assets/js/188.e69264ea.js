(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{600:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("大家好~我是"),s("code",[t._v("米洛")]),t._v("！"),s("br"),t._v("\n我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的"),s("code",[t._v("教程")]),t._v("，希望大家多多支持。"),s("br"),t._v("\n欢迎关注我的公众号"),s("code",[t._v("米洛的测开日记")]),t._v("，获取最新文章教程!")])]),t._v(" "),s("h3",{attrs:{id:"回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回顾"}},[t._v("#")]),t._v(" 回顾")]),t._v(" "),s("p",[t._v("上一节我们初步发送了测试邮件，由于定时任务的存在，导致我的邮箱还一直有收到每天测试计划的"),s("code",[t._v("执行记录")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637759985-image.png",alt:"image.png"}})]),t._v(" "),s("p",[t._v("但它总归是一个半成品，只有空荡荡的文字信息，所以我们还是得适当对他美化一下。")]),t._v(" "),s("h3",{attrs:{id:"成果展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#成果展示"}},[t._v("#")]),t._v(" 成果展示")]),t._v(" "),s("p",[t._v("功夫不负有心人，忙碌了1个多小时的"),s("code",[t._v("米师傅")]),t._v("终于搞出了像样点的邮件报告:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637766242164-image.png",alt:"怎么样，效果还凑合吧"}})]),t._v(" "),s("p",[t._v("当然，这里只有样式哈，(因为数据我暂时是写死的)。")]),t._v(" "),s("h3",{attrs:{id:"开始研究-卷王模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始研究-卷王模式"}},[t._v("#")]),t._v(" 开始研究（卷王模式）")]),t._v(" "),s("p",[t._v("其实有时候我一直在想，如果没有"),s("code",[t._v("antd")]),t._v("和"),s("code",[t._v("element-ui")]),t._v("，那我写的东西该多么"),s("code",[t._v("丑陋")]),t._v("。")]),t._v(" "),s("p",[t._v("这其实也说明了，本人前端功底真的是太不扎实了，也只有用这样的组件才能"),s("code",[t._v("拯救自己")]),t._v("了。")]),t._v(" "),s("p",[t._v("好了，认清现实以后，我不打算自己手撸css样式了。于是我开始找有没有啥好看的"),s("code",[t._v("邮件模板")]),t._v("，你别说，还真给我找到了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637766057506-image.png",alt:""}})]),t._v(" "),s("p",[t._v("看了一下，是"),s("code",[t._v("某鹅云")]),t._v("的邮件模板，看起来还是很好看的。作者给出了对应的源码:")]),t._v(" "),s("p",[s("strong",[t._v("emmm，源码贴了以后效果不好，有需要的可以私信我。")])]),t._v(" "),s("p",[t._v("想起来我还没解释为什么要手撸css，因为在邮件里，虽然支持你使用"),s("code",[t._v("html")]),t._v("作为正文，但是它有一些"),s("code",[t._v("限制")]),t._v("。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("无法使用js")]),t._v(" "),s("p",[t._v("所以点击事件我们用链接来完成")])]),t._v(" "),s("li",[s("p",[t._v("只对行内样式能友好支持")]),t._v(" "),s("p",[t._v("这2点就很让人难受了，所以我这边就打算借鉴他人的代码，在他们基础上"),s("code",[t._v("修改")]),t._v("。")])])]),t._v(" "),s("h3",{attrs:{id:"接下来干嘛"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接下来干嘛"}},[t._v("#")]),t._v(" 接下来干嘛")]),t._v(" "),s("p",[t._v("拿到这块代码以后，首先我想的是把它改成jinja2的模板代码，预置对应的话术，在需要动态展示的地方用"),s("code",[t._v("｛｛变量｝｝")]),t._v("进行替换。相信大家写过旧时代，前后端一体web系统的时候都用过template，也就对这种方式（模板引擎）很熟悉。")]),t._v(" "),s("p",[t._v("我们通过jinja2生成html，发送html邮件到对应的接收人就好了。")]),t._v(" "),s("p",[s("strong",[t._v("但html里面样式虽然正常，到了邮件又会怎么样呢？我们试试看")])]),t._v(" "),s("h3",{attrs:{id:"调整样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整样式"}},[t._v("#")]),t._v(" 调整样式")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637767889622-image.png",alt:"到这个地步就差不多了"}})]),t._v(" "),s("p",[t._v("可以看到里面有很多变量，到时候都会通过"),s("code",[t._v("jinja2")]),t._v("传递进去。")]),t._v(" "),s("p",[t._v("然后我为了测试效果，先写死了数据:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637767947861-image.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"用yagmail测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用yagmail测试"}},[t._v("#")]),t._v(" 用yagmail测试")]),t._v(" "),s("p",[t._v("由于yagmail很易用，所以我们之前都是用它来发送邮件。那么它发html邮件效果会咋样呢?")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637768026515-image.png",alt:"这是真实的效果，可以看到，惨不忍睹"}})]),t._v(" "),s("p",[t._v("但这怎么能摧毁我的斗志呢？")]),t._v(" "),s("p",[t._v("于是我决定试试最原始的"),s("code",[t._v("smtplib")]),t._v("，说实话，现在不查资料我完全不会用的一个库:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.pity.fun/picture/2021-11-24/1637768524442-image.png",alt:""}})]),t._v(" "),s("p",[t._v("发现样式没问题，但要点击"),s("code",[t._v("显示图片")]),t._v("才能展示图片，这个显然在可以接受的范围，因为我看阿里云的图片也被屏蔽了。zzz")]),t._v(" "),s("p",[t._v("所以我们还是采用"),s("code",[t._v("smtplib")]),t._v("来发邮件吧~~~")]),t._v(" "),s("p",[t._v("最后附上粗略版的发邮件代码，备个份。")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" smtplib\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MIMEText\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("header "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Header\n\nsender "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx@126.com'")]),t._v("\npassword"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"客户端token"')]),t._v("\nreceivers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx@qq.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收邮件，可设置为你的QQ邮箱或者其他邮箱")]),t._v("\n\nmail_msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""html代码"""')]),t._v("\nmessage "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MIMEText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mail_msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmessage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'From'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wuranxu1993@126.com'")]),t._v("\nmessage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'To'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsubject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Python SMTP 邮件测试'")]),t._v("\nmessage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Subject'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("subject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    smtp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" smtplib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SMTP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    smtp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp.126.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 我们用set_debuglevel(1)就可以打印出和SMTP服务器交互的所有信息。")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# smtp.set_debuglevel(1)")]),t._v("\n    smtp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("login"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    smtp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendmail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receivers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br")])]),s("p",[t._v("下一节咱们直接完成"),s("code",[t._v("邮件通知")]),t._v("这块内容，敬请期待。")])])}),[],!1,null,null,null);s.default=e.exports}}]);